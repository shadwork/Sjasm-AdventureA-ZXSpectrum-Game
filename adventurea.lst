0001   0000                                                         DEVICE ZXSPECTRUM48
0002   0000             
0003   0000                                                         include defines.asm
0001+  0000             
0002+  0000             
0003+  0000             	define CLR_BLACK %000000
0004+  0000             	define CLR_BLUE %000001
0005+  0000             	define CLR_RED %000010
0006+  0000             	define CLR_MAGENTA %000011
0007+  0000             	define CLR_GREEN %000100
0008+  0000             	define CLR_CYAN %000101
0009+  0000             	define CLR_WHITE %000111
0010+  0000             
0011+  0000             	define CLR_BRIGHT %1000000
0012+  0000             
0013+  0000               MACRO COLOR ink, paper
0014+  0000~                LD A,(ink + paper<<3) 
0015+  0000               ENDM
0016+  0000             
0004   0000             
0005   0000                                                         define COMMAND_GET 0x0D
0006   0000                                                         define ITEM_BOOT 0x10
0007   0000             
0008   0000             	                                        define VAR_FLAG_CANT_DO IX-0x8
0009   0000                                                         define VAR_PROC_PARAM IX-0x7
0010   0000             	                                        define VAR_MORE_PARSING IX-0x6
0011   0000             	                                        define VAR_PROC IX-0x5
0012   0000             	                                        define VAR_CMD_FIRST IX-0x4
0013   0000                                                         define VAR_CMD_SECOND IX-0x3
0014   0000             	                                        define VAR_TEMP IX-0x2
0015   0000             	                                        define VAR_CURRENT_ROOM IX-0x1
0016   0000             	                                        define VAR_START_GAME IX+0x0    
0017   0000                                                         define VAR_ITEMS_COUNT IX+0x1
0018   0000             	                                        define VAR_START_C IX+0x2    
0019   0000                                                         define VAR_LIGHT IX+0x3   
0020   0000                                                         define VAR_START_E IX+0x4                                                                                                                             
0021   0000             
0022   0000                                                         module GAME
0023   0000                                                         org 0x5d40
0024   5D40 00                                                      db 0x00; IX-8 VAR_FLAG_CANT_DO
0025   5D41 00          VAR_PROC_PARAM_ADDR:                           db 0x00; IX-7
0026   5D42 00                                                      db 0x00; IX-6
0027   5D43 00          VAR_PROC_ADDR:                               db 0x00; IX-5
0028   5D44 00          VAR_CMD_FIRST_ADDR:                          db 0x00; IX-4 
0029   5D45 00          VAR_CMD_SECOND_ADDR:                         db 0x00; IX-3
0030   5D46 00          SAVE_BUFFER_PART1:                           db 0x00; IX-2 VAR_TEMP                               
0031   5D47 00          CURRENT_ROOM:                                db 0x00; IX-1 VAR_CURRENT_ROOM
0032   5D48             BUFFER:                                      ; clear on init 0x1e length = 30
0033   5D48 CD                                                      db 0xCD ; IX+0 VAR_START
0034   5D49 42                                                      db 0x42 ; IX+1 VAR_ITEMS_COUNT
0035   5D4A 6F                                                      db 0x6F ; IX+2 
0036   5D4B CD                                                      db 0xCD ; IX+3 
0037   5D4C 50                                                      db 0x50 ; IX+4
0038   5D4D 72                                                      db 0x72 ; IX+5 start some table 
0039   5D4E CD                                                      db 0xCD
0040   5D4F 00                                                      db 0x00
0041   5D50 55                                                      db 0x55
0042   5D51 C3                                                      db 0xC3
0043   5D52 27                                                      db 0x27
0044   5D53 64                                                      db 0x64
0045   5D54 E3                                                      db 0xE3
0046   5D55 F3                                                      db 0xF3
0047   5D56 D5                                                      db 0xD5
0048   5D57 C5                                                      db 0xC5
0049   5D58 DD                                                      db 0xDD
0050   5D59 E5                                                      db 0xE5
0051   5D5A E5                                                      db 0xE5
0052   5D5B DD                                                      db 0xDD
0053   5D5C 21                                                      db 0x21
0054   5D5D 5F                                                      db 0x5F
0055   5D5E 72                                                      db 0x72
0056   5D5F C9                                                      db 0xC9
0057   5D60 32                                                      db 0x32
0058   5D61 0F                                                      db 0x0F
0059   5D62 76                                                      db 0x76
0060   5D63 F1                                                      db 0xF1
0061   5D64 DD                                                      db 0xDD
0062   5D65 E1                                                      db 0xE1
0063   5D66 C1 D1       VAR_CMD_BUF0:                                dw 0xd1c1
0064   5D68 E1 F5       VAR_CMD_BUF1:                                dw 0xf5e1
0065   5D6A 00 00       VAR_SCORE:                                   dw 0x0000
0066   5D6C 21 48 5D    ENTRY_POINT:                                 LD HL,BUFFER
0067   5D6F 06 1E                                                   LD B,0x1e
0068   5D71 36 00       CLEAR_BUFFER:                                LD (HL),0x0
0069   5D73 23                                                      INC HL
0070   5D74 10 FB                                                   DJNZ CLEAR_BUFFER
0071   5D76 21 00 00                                                LD HL,0x0
0072   5D79 22 6A 5D                                                LD (VAR_SCORE),HL
0073   5D7C CD A9 65                                                CALL GAME_INIT
0074   5D7F 21 9C 6D                                                LD HL,ITEMS_BY_ROOM_TABLE_INIT ;copy from
0075   5D82 11 B9 6D                                                LD DE,ITEMS_BY_ROOM_TABLE ;copy to
0076   5D85 01 1D 00                                                LD BC,0x1d ;copy size
0077   5D88 ED B0                                                   LDIR
0078   5D8A DD 21 48 5D                                             LD IX,BUFFER
0079   5D8E DD 36 FF 00                                             LD (VAR_CURRENT_ROOM),0x0 ; starting from room 0
0080   5D92 E5                                                      PUSH HL
0081   5D93 18 19                                                   JR ASK_RESTORE_GAME
0082   5D95             TEXT_RESTORE_GAME:                           db "WANT TO RESTORE A GAME?\r",0
0082   5D95 57414E5420544F20524553544F524520412047414D453F0D00
0083   5DAE 21 95 5D    ASK_RESTORE_GAME:                            LD HL,TEXT_RESTORE_GAME 
0084   5DB1 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0085   5DB4 E1                                                      POP HL
0086   5DB5 CD 38 67                                                CALL WAIT_KEY
0087   5DB8 FE 59                                                   CP 'Y'
0088   5DBA CC 6D 65                                                CALL Z,GAME_RESTORED
0089   5DBD CD 9F 67    ENTER_NEW_ROOM:                              CALL INIT_SCREEN
0090   5DC0 AF                                                      XOR A
0091   5DC1 DD BE 00                                                CP (VAR_START_GAME) ; zero here from start
0092   5DC4 28 45                                                   JR Z,PRINT_ROOM
0093   5DC6 DD BE 03                                                CP (VAR_LIGHT)
0094   5DC9 28 03                                                   JR Z,LIGHT_CHECK
0095   5DCB DD 35 03                                                DEC (VAR_LIGHT)
0096   5DCE 3A B9 6D    LIGHT_CHECK:                                 LD A,(ITEMS_BY_ROOM_TABLE) ; starting with 0x05
0097   5DD1 DD BE FF                                                CP (VAR_CURRENT_ROOM)
0098   5DD4 28 35                                                   JR Z,PRINT_ROOM
0099   5DD6 E5                                                      PUSH HL
0100   5DD7 18 20                                                   JR STATE_DARK
0101   5DD9             TEXT_EVERYTHING_DARK:                        db "EVERYTHING IS DARK.I CANT SEE.\r",0
0101   5DD9 45564552595448494E47204953204441524B2E492043414E54205345452E0D00
0102   5DF9 21 D9 5D    STATE_DARK:                                  LD HL,TEXT_EVERYTHING_DARK 
0103   5DFC CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0104   5DFF E1                                                      POP HL
0105   5E00 AF                                                      XOR A
0106   5E01 DD BE 04                                                CP (VAR_START_E) ; 0x50 started = 80
0107   5E04 28 03                                                   JR Z,LAB_ram_5e09
0108   5E06 DD 35 04                                                DEC (VAR_START_E)
0109   5E09 18 60       LAB_ram_5e09:                                JR PARSE_DEFAULTS
0110   5E0B 11 AD 67    PRINT_ROOM:                                  LD DE,ROOM_DESC_POINTER 
0111   5E0E DD 6E FF                                                LD L,(VAR_CURRENT_ROOM)
0112   5E11 26 00                                                   LD H,0x0
0113   5E13 29                                                      ADD HL,HL
0114   5E14 19                                                      ADD HL,DE
0115   5E15 5E                                                      LD E,(HL) 
0116   5E16 23                                                      INC HL
0117   5E17 56                                                      LD D,(HL)
0118   5E18 EB                                                      EX DE,HL
0119   5E19 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0120   5E1C DD 36 FE 00                                             LD (VAR_TEMP),0x0
0121   5E20 21 B9 6D                                                LD HL,ITEMS_BY_ROOM_TABLE
0122   5E23 0E 00                                                   LD C,0x0 ; from first item
0123   5E25 7E          PRINT_ITEMS:                                 LD A,(HL)
0124   5E26 FE FF                                                   CP 0xff ;end of items
0125   5E28 28 41                                                   JR Z,PARSE_DEFAULTS ; no item left - jump to input
0126   5E2A DD BE FF                                                CP (VAR_CURRENT_ROOM)
0127   5E2D 20 38                                                   JR NZ,NEXT_ROOM_FOR_ITEM
0128   5E2F AF                                                      XOR A ; room is found
0129   5E30 DD BE FE                                                CP (VAR_TEMP) 
0130   5E33 20 1F                                                   JR NZ,PRINT_NEXT_ITEM
0131   5E35 E5                                                      PUSH HL
0132   5E36 18 12                                                   JR PRINT_ASLO_SEE
0133   5E38             TEXT_ALSO_SEE:                               db "I CAN ALSO SEE :\r",0
0133   5E38 492043414E20414C534F20534545203A0D00
0134   5E4A 21 38 5E    PRINT_ASLO_SEE:                              LD HL,TEXT_ALSO_SEE 
0135   5E4D CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0136   5E50 E1                                                      POP HL
0137   5E51 DD 34 FE                                                INC (VAR_TEMP)
0138   5E54 E5          PRINT_NEXT_ITEM:                             PUSH HL
0139   5E55 21 D6 6D                                                LD HL,ITEM_DESC_POINTER 
0140   5E58 06 00                                                   LD B,0x0
0141   5E5A 09                                                      ADD HL,BC
0142   5E5B 09                                                      ADD HL,BC
0143   5E5C 5E                                                      LD E,(HL) 
0144   5E5D 23                                                      INC HL
0145   5E5E 56                                                      LD D,(HL)
0146   5E5F EB                                                      EX DE,HL
0147   5E60 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0148   5E63 CD DF BF                                                CALL SCREEN.PRINT_CR
0149   5E66 E1                                                      POP HL
0150   5E67 23          NEXT_ROOM_FOR_ITEM:                          INC HL
0151   5E68 0C                                                      INC C
0152   5E69 18 BA                                                   JR PRINT_ITEMS
0153   5E6B 21 42 7E    PARSE_DEFAULTS:                              LD HL,DEFAULT_TABLE 
0154   5E6E C3 48 5F                                                JP PARSE_PROC
0155   5E71 C1          CMD_TELL_ME:                                 POP BC
0156   5E72 E1                                                      POP HL
0157   5E73 AF                                                      XOR A
0158   5E74 DD BE 02                                                CP (VAR_START_C)
0159   5E77 28 03                                                   JR Z,LAB_ram_5e7c
0160   5E79 DD 35 02                                                DEC (VAR_START_C)
0161   5E7C DD BE 05    LAB_ram_5e7c:                                CP (IX+0x5)
0162   5E7F 28 03                                                   JR Z,LAB_ram_5e84
0163   5E81 DD 35 05                                                DEC (IX+0x5)
0164   5E84 18 15       LAB_ram_5e84:                                JR LAB_ram_5e9b
0165   5E86             TEXT_TELL_ME:                                db "TELL ME WHAT TO DO \r",0
0165   5E86 54454C4C204D45205748415420544F20444F200D00
0166   5E9B 21 86 5E    LAB_ram_5e9b:                                LD HL,TEXT_TELL_ME 
0167   5E9E CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0168   5EA1 CD E1 60                                                CALL READ_LINE
0169   5EA4 DD 36 F8 00                                             LD (VAR_FLAG_CANT_DO),0x0
0170   5EA8 CD 1B 65    SKIP_SPACES:                                 CALL CMD_DECODE
0171   5EAB 32 44 5D                                                LD (VAR_CMD_FIRST_ADDR),A
0172   5EAE FE FF                                                   CP 0xff
0173   5EB0 20 3A                                                   JR NZ,KNOW_COMMAND
0174   5EB2 7E                                                      LD A,(HL) ; pointed to input buffer
0175   5EB3 FE 0D                                                   CP 0xd ; just first char is enter
0176   5EB5 28 03                                                   JR Z,UNKNOWN_COMMAND
0177   5EB7 B7                                                      OR A
0178   5EB8 20 1F                                                   JR NZ,LOOP_SPACES
0179   5EBA E5          UNKNOWN_COMMAND:                             PUSH HL 
0180   5EBB 18 13                                                   JR LAB_ram_5ed0
0181   5EBD             TEXT_DONT_UNDERSTAND:                        db "I DONT UNDERSTAND\r",0
0181   5EBD 4920444F4E5420554E4445525354414E440D00
0182   5ED0 21 BD 5E    LAB_ram_5ed0:                                LD HL,TEXT_DONT_UNDERSTAND 
0183   5ED3 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0184   5ED6 E1                                                      POP HL
0185   5ED7 18 92                                                   JR PARSE_DEFAULTS
0186   5ED9 7E          LOOP_SPACES:                                 LD A,(HL)                                            
0187   5EDA FE 20                                                   CP ' ' ; is it space ?
0188   5EDC 20 03                                                   JR NZ,CHAR_IS_FOUND
0189   5EDE 23                                                      INC HL
0190   5EDF 18 C7                                                   JR SKIP_SPACES
0191   5EE1 FE 00       CHAR_IS_FOUND:                               CP 0x0
0192   5EE3 28 D5                                                   JR Z,UNKNOWN_COMMAND
0193   5EE5 FE 0D                                                   CP 0xd
0194   5EE7 28 D1                                                   JR Z,UNKNOWN_COMMAND
0195   5EE9 23                                                      INC HL
0196   5EEA 18 ED                                                   JR LOOP_SPACES
0197   5EEC DD 36 FD FF KNOW_COMMAND:                                LD (VAR_CMD_SECOND),0xff
0198   5EF0 7E          SEARCH_SECOND_CMD:                           LD A,(HL)                                            
0199   5EF1 FE 20                                                   CP ' '
0200   5EF3 28 0D                                                   JR Z,CMD_NEXT_WORD
0201   5EF5 FE 00                                                   CP 0x0
0202   5EF7 CA 1D 5F                                                JP Z,CMD_PARCE_COMPLETE
0203   5EFA FE 0D                                                   CP 0xd
0204   5EFC CA 1D 5F                                                JP Z,CMD_PARCE_COMPLETE
0205   5EFF 23                                                      INC HL
0206   5F00 18 EE                                                   JR SEARCH_SECOND_CMD
0207   5F02 23          CMD_NEXT_WORD:                               INC HL
0208   5F03 CD 1B 65                                                CALL CMD_DECODE
0209   5F06 32 45 5D                                                LD (VAR_CMD_SECOND_ADDR),A
0210   5F09 FE FF                                                   CP 0xff
0211   5F0B 20 10                                                   JR NZ,CMD_PARCE_COMPLETE
0212   5F0D 7E          ITERATE_END_LINE:                            LD A,(HL) 
0213   5F0E                                                         
0214   5F0E FE 00                                                   CP 0x0
0215   5F10 28 0B                                                   JR Z,CMD_PARCE_COMPLETE
0216   5F12 FE 0D                                                   CP 0xd
0217   5F14 28 07                                                   JR Z,CMD_PARCE_COMPLETE
0218   5F16 FE 20                                                   CP 0x20
0219   5F18 28 E8                                                   JR Z,CMD_NEXT_WORD
0220   5F1A 23                                                      INC HL
0221   5F1B 18 F0                                                   JR ITERATE_END_LINE
0222   5F1D 16 00       CMD_PARCE_COMPLETE:                          LD D,0x0
0223   5F1F DD 5E FF                                                LD E,(VAR_CURRENT_ROOM)
0224   5F22 21 0D 78                                                LD HL,ROOM_NAV_POINTER 
0225   5F25 19                                                      ADD HL,DE
0226   5F26 19                                                      ADD HL,DE
0227   5F27 5E                                                      LD E,(HL)
0228   5F28 23                                                      INC HL
0229   5F29 56                                                      LD D,(HL)
0230   5F2A EB                                                      EX DE,HL
0231   5F2B 7E          NAV_SEARCH_LOOP:                             LD A,(HL)
0232   5F2C FE FF                                                   CP 0xff
0233   5F2E 28 11                                                   JR Z,NAVIGATION_LIST_END
0234   5F30 DD BE FC                                                CP (VAR_CMD_FIRST)
0235   5F33 20 08                                                   JR NZ,NEXT_CMD_IN_ROOM
0236   5F35 23                                                      INC HL
0237   5F36 7E                                                      LD A,(HL)
0238   5F37 DD 77 FF                                                LD (VAR_CURRENT_ROOM),A
0239   5F3A C3 BD 5D                                                JP ENTER_NEW_ROOM
0240   5F3D 23          NEXT_CMD_IN_ROOM:                            INC HL
0241   5F3E 23                                                      INC HL
0242   5F3F 18 EA                                                   JR NAV_SEARCH_LOOP
0243   5F41 21 E6 73    NAVIGATION_LIST_END:                         LD HL,ACTION_TABLE ; command parce here is continued
0244   5F44 DD 36 FA 00                                             LD (VAR_MORE_PARSING),0x0
0245   5F48 7E          PARSE_PROC:                                  LD A,(HL) ; pointed to DEFAULT_TABLE  or ACTION_TABLE = ff from start                      
0246   5F49 B7                                                      OR A
0247   5F4A 20 74                                                   JR NZ,ACTION_FOUND
0248   5F4C DD BE FA                                                CP (VAR_MORE_PARSING) ; DEFAULT_TABLE ends with 0
0249   5F4F C2 6B 5E                                                JP NZ,PARSE_DEFAULTS 
0250   5F52 DD 7E FC                                                LD A,(VAR_CMD_FIRST) 
0251   5F55 FE 0D                                                   CP 0xd
0252   5F57 38 3C                                                   JR C,PRINT_CANT_GO ; 0xd > first command - all moves under 0xd
0253   5F59 DD 7E F8                                                LD A,(VAR_FLAG_CANT_DO)
0254   5F5C B7                                                      OR A
0255   5F5D 20 15                                                   JR NZ,CANT_DO_YET ; 
0256   5F5F E5                                                      PUSH HL                                             
0257   5F60 18 08                                                   JR PRINT_CANT
0258   5F62             TEXT_I_CANT:                                 db "I CANT\r",0
0258   5F62 492043414E540D00
0259   5F6A 21 62 5F    PRINT_CANT:                                  LD HL,TEXT_I_CANT 
0260   5F6D CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0261   5F70 E1                                                      POP HL
0262   5F71 C3 6B 5E                                                JP PARSE_DEFAULTS
0263   5F74 E5          CANT_DO_YET:                                 PUSH HL                                             
0264   5F75 18 14                                                   JR PRINT_CANT_DO_YET
0265   5F77             TEXT_I_CANT_DO_YET:                          db "I CANT DO THAT YET\r",0
0265   5F77 492043414E5420444F2054484154205945540D00
0266   5F8B 21 77 5F    PRINT_CANT_DO_YET:                           LD HL,TEXT_I_CANT_DO_YET 
0267   5F8E CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0268   5F91 E1                                                      POP HL
0269   5F92 C3 6B 5E                                                JP PARSE_DEFAULTS
0270   5F95 E5          PRINT_CANT_GO:                               PUSH HL  
0271   5F96 18 1D                                                   JR PRINT_CANT_GO_TEXT
0272   5F98             TEXT_I_CANT_GO:                              db "I CANT GO IN THAT DIRECTION\r",0
0272   5F98 492043414E5420474F20494E205448415420444952454354494F4E0D00
0273   5FB5 21 98 5F    PRINT_CANT_GO_TEXT:                          LD HL,TEXT_I_CANT_GO 
0274   5FB8 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0275   5FBB E1                                                      POP HL
0276   5FBC C3 6B 5E                                                JP PARSE_DEFAULTS
0277   5FBF 00                                                      NOP
0278   5FC0 FE FF       ACTION_FOUND:                                CP 0xff ; start value ff
0279   5FC2 28 0C                                                   JR Z,CMD_FIRST_FOUND
0280   5FC4 DD BE FC                                                CP (VAR_CMD_FIRST)
0281   5FC7 28 07                                                   JR Z,CMD_FIRST_FOUND
0282   5FC9 11 06 00    CMD_NEXT_BLOCK:                              LD DE,0x6 ; next block 
0283   5FCC 19                                                      ADD HL,DE
0284   5FCD C3 48 5F                                                JP PARSE_PROC ; if not ff and not first command - then next 
0285   5FD0 23          CMD_FIRST_FOUND:                             INC HL ; 
0286   5FD1 7E                                                      LD A,(HL) 
0287   5FD2 FE FF                                                   CP 0xff
0288   5FD4 28 08                                                   JR Z,CMD_SECOND_FOUND
0289   5FD6 DD BE FD                                                CP (VAR_CMD_SECOND)
0290   5FD9 28 03                                                   JR Z,CMD_SECOND_FOUND
0291   5FDB 2B                                                      DEC HL
0292   5FDC 18 EB                                                   JR CMD_NEXT_BLOCK
0293   5FDE 23          CMD_SECOND_FOUND:                            INC HL
0294   5FDF 4E                                                      LD C,(HL) 
0295   5FE0 23                                                      INC HL
0296   5FE1 46                                                      LD B,(HL) ; first value in BC - VALIDATOR0 or 
0297   5FE2 23                                                      INC HL
0298   5FE3 0A          NEXT_VALIDATOR:                              LD A,(BC) 
0299   5FE4 FE FF                                                   CP 0xff
0300   5FE6 CA AF 60                                                JP Z,VALIDATION_COMPLETE
0301   5FE9 32 43 5D                                                LD (VAR_PROC_ADDR),A ; first [0] = 6,5,1,5,6,ff
0302   5FEC 03                                                      INC BC
0303   5FED 0A                                                      LD A,(BC) 
0304   5FEE 32 41 5D                                                LD (VAR_PROC_PARAM_ADDR),A ; second [1] = 5
0305   5FF1 E5                                                      PUSH HL ; hl pointed to ACTION0
0306   5FF2 21 9D 60                                                LD HL,PROC_POINTER 
0307   5FF5 16 00                                                   LD D,0x0
0308   5FF7 DD 5E FB                                                LD E,(VAR_PROC)
0309   5FFA 19                                                      ADD HL,DE
0310   5FFB 19                                                      ADD HL,DE
0311   5FFC 5E                                                      LD E,(HL) 
0312   5FFD 23                                                      INC HL
0313   5FFE 56                                                      LD D,(HL)
0314   5FFF EB                                                      EX DE,HL
0315   6000 E9                                                      JP (HL) ; jump to pointer PROC06, in BC second element
0316   6001 3A 41 5D    PROC_00:                                     LD A,(VAR_PROC_PARAM_ADDR) ; verify if current room
0317   6004 DD BE FF                                                CP (VAR_CURRENT_ROOM)
0318   6007 28 5A                                                   JR Z,PROCS_RET
0319   6009 E1          PROC_NEXT:                                   POP HL
0320   600A 23                                                      INC HL
0321   600B 23                                                      INC HL
0322   600C DD 36 F8 01                                             LD (VAR_FLAG_CANT_DO),1
0323   6010 C3 48 5F                                                JP PARSE_PROC
0324   6013 21 B9 6D    PROC_01:                                     LD HL,ITEMS_BY_ROOM_TABLE ; is item available
0325   6016 16 00                                                   LD D,0x0
0326   6018 DD 5E F9                                                LD E,(VAR_PROC_PARAM)
0327   601B 19                                                      ADD HL,DE
0328   601C 7E                                                      LD A,(HL)
0329   601D DD BE FF                                                CP (VAR_CURRENT_ROOM) ; if item in current room
0330   6020 28 41                                                   JR Z,PROCS_RET
0331   6022 FE FD                                                   CP 0xfd ; or item in pocket or wear
0332   6024 30 3D                                                   JR NC,PROCS_RET
0333   6026 18 E1                                                   JR PROC_NEXT
0334   6028 ED 5F       PROC_02:                                     LD A,R ; randoms
0335   602A DD 96 F9                                                SUB (VAR_PROC_PARAM)
0336   602D 38 34                                                   JR C,PROCS_RET
0337   602F 18 D8                                                   JR PROC_NEXT
0338   6031 21 B9 6D    PROC_03:                                     LD HL,ITEMS_BY_ROOM_TABLE ; is item here
0339   6034 16 00                                                   LD D,0x0
0340   6036 DD 5E F9                                                LD E,(VAR_PROC_PARAM)
0341   6039 19                                                      ADD HL,DE
0342   603A 7E                                                      LD A,(HL)
0343   603B DD BE FF                                                CP (VAR_CURRENT_ROOM)
0344   603E 28 C9                                                   JR Z,PROC_NEXT
0345   6040 FE FD                                                   CP 0xfd 
0346   6042 30 C5                                                   JR NC,PROC_NEXT
0347   6044 18 1D                                                   JR PROCS_RET
0348   6046 21 B9 6D    PROC_04:                                     LD HL,ITEMS_BY_ROOM_TABLE ; is item weared
0349   6049 16 00                                                   LD D,0x0
0350   604B DD 5E F9                                                LD E,(VAR_PROC_PARAM)
0351   604E 19                                                      ADD HL,DE
0352   604F 7E                                                      LD A,(HL)
0353   6050 FE FD                                                   CP 0xfd
0354   6052 28 0F                                                   JR Z,PROCS_RET
0355   6054 18 B3                                                   JR PROC_NEXT
0356   6056 21 48 5D    PROC_05:                                     LD HL,BUFFER ; two params compare with zero
0357   6059 16 00                                                   LD D,0x0
0358   605B DD 5E F9                                                LD E,(VAR_PROC_PARAM)
0359   605E 19                                                      ADD HL,DE
0360   605F 7E                                                      LD A,(HL)
0361   6060 B7                                                      OR A
0362   6061 28 A6                                                   JR Z,PROC_NEXT
0363   6063 E1          PROCS_RET:                                   POP HL
0364   6064 03                                                      INC BC
0365   6065 C3 E3 5F                                                JP NEXT_VALIDATOR
0366   6068 03          PROC_06:                                     INC BC ; three params compare with third param
0367   6069 0A                                                      LD A,(BC) ; third element 6,5,1,5,6,ff
0368   606A 21 48 5D                                                LD HL,BUFFER
0369   606D 16 00                                                   LD D,0x0
0370   606F DD 5E F9                                                LD E,(VAR_PROC_PARAM)
0371   6072 19                                                      ADD HL,DE
0372   6073 BE                                                      CP (HL) ; compared by IX
0373   6074 20 93                                                   JR NZ,PROC_NEXT ; next is triggered
0374   6076 18 EB                                                   JR PROCS_RET
0375   6078 21 48 5D    PROC_07:                                     LD HL,BUFFER ; is in table zero
0376   607B 16 00                                                   LD D,0x0
0377   607D DD 5E F9                                                LD E,(VAR_PROC_PARAM)
0378   6080 19                                                      ADD HL,DE
0379   6081 7E                                                      LD A,(HL)
0380   6082 B7                                                      OR A
0381   6083 C2 09 60                                                JP NZ,PROC_NEXT
0382   6086 18 DB                                                   JR PROCS_RET
0383   6088 21 B9 6D    PROC_08:                                     LD HL,ITEMS_BY_ROOM_TABLE ; is item in inventory of weared
0384   608B 16 00                                                   LD D,0x0
0385   608D DD 5E F9                                                LD E,(VAR_PROC_PARAM)
0386   6090 19                                                      ADD HL,DE
0387   6091 7E                                                      LD A,(HL)
0388   6092 FE FE                                                   CP 0xfe
0389   6094 28 CD                                                   JR Z,PROCS_RET
0390   6096 FE FD                                                   CP 0xfd
0391   6098 28 C9                                                   JR Z,PROCS_RET
0392   609A C3 09 60                                                JP PROC_NEXT
0393   609D 01 60       PROC_POINTER:                                dw PROC_00
0394   609F 13 60                                                   dw PROC_01
0395   60A1 28 60                                                   dw PROC_02
0396   60A3 31 60                                                   dw PROC_03
0397   60A5 46 60                                                   dw PROC_04
0398   60A7 56 60                                                   dw PROC_05
0399   60A9 68 60                                                   dw PROC_06
0400   60AB 78 60                                                   dw PROC_07
0401   60AD 88 60                                                   dw PROC_08
0402   60AF 4E          VALIDATION_COMPLETE:                         LD C,(HL) ; second param
0403   60B0 23                                                      INC HL
0404   60B1 46                                                      LD B,(HL)
0405   60B2 23                                                      INC HL
0406   60B3 DD 36 FA 01                                             LD (VAR_MORE_PARSING),1
0407   60B7 0A          NEXT_COMMAND:                                LD A,(BC)             
0408   60B8 FE FF                                                   CP 0xff
0409   60BA CA 48 5F                                                JP Z,PARSE_PROC
0410   60BD 32 43 5D                                                LD (VAR_PROC_ADDR),A
0411   60C0 03                                                      INC BC
0412   60C1 0A                                                      LD A,(BC) 
0413   60C2 32 41 5D                                                LD (VAR_PROC_PARAM_ADDR),A
0414   60C5 E5                                                      PUSH HL 
0415   60C6 C5                                                      PUSH BC 
0416   60C7 21 08 61                                                LD HL,CMD_POINTER 
0417   60CA 16 00                                                   LD D,0x0
0418   60CC DD 5E FB                                                LD E,(VAR_PROC)
0419   60CF 19                                                      ADD HL,DE
0420   60D0 19                                                      ADD HL,DE
0421   60D1 5E                                                      LD E,(HL) 
0422   60D2 23                                                      INC HL
0423   60D3 56                                                      LD D,(HL)
0424   60D4 EB                                                      EX DE,HL
0425   60D5 E9                                                      JP (HL)
0426   60D6 21 B9 6D    SUB_ram_60d6:                                LD HL,ITEMS_BY_ROOM_TABLE
0427   60D9 06 00                                                   LD B,0x0
0428   60DB DD 4E F9                                                LD C,(VAR_PROC_PARAM)
0429   60DE 09                                                      ADD HL,BC
0430   60DF 7E                                                      LD A,(HL)
0431   60E0 C9                                                      RET
0432   60E1 21 E7 60    READ_LINE:                                   LD HL,LINE_BUFFER 
0433   60E4 C3 69 67                                                JP READ_LINE_START
0434   60E7 B3          LINE_BUFFER:                                 db 0xB3
0435   60E8 B2                                                      db 0xB2
0436   60E9 B8                                                      db 0xB8
0437   60EA 20                                                      db 0x20
0438   60EB 09                                                      db 0x09
0439   60EC 52                                                      db 0x52
0440   60ED 45                                                      db 0x45
0441   60EE 54                                                      db 0x54
0442   60EF 0D                                                      db 0x0D
0443   60F0 B0                                                      db 0xB0
0444   60F1 B0                                                      db 0xB0
0445   60F2 B3                                                      db 0xB3
0446   60F3 B3                                                      db 0xB3
0447   60F4 B0                                                      db 0xB0
0448   60F5 20                                                      db 0x20
0449   60F6 09                                                      db 0x09
0450   60F7 45                                                      db 0x45
0451   60F8 4E                                                      db 0x4E
0452   60F9 44                                                      db 0x44
0453   60FA 09                                                      db 0x09
0454   60FB 4D                                                      db 0x4D
0455   60FC 41                                                      db 0x41
0456   60FD 49                                                      db 0x49
0457   60FE 4E                                                      db 0x4E
0458   60FF 0D                                                      db 0x0D
0459   6100 1A                                                      db 0x1A
0460   6101 4C                                                      db 0x4C
0461   6102 4C                                                      db 0x4C
0462   6103 09                                                      db 0x09
0463   6104 47                                                      db 0x47
0464   6105 45                                                      db 0x45
0465   6106 54                                                      db 0x54
0466   6107 42                                                      db 0x42
0467   6108 3A 61       CMD_POINTER:                                 dw CMD_INVENTORY
0468   610A D7 61                                                   dw CMD_NOT_WEARING
0469   610C 37 62                                                   dw CMD_CANT_CARRY
0470   610E B8 62                                                   dw CMD_DONT_HAVE
0471   6110 EF 62                                                   dw CMD_ALREADY_WEAR
0472   6112 45 63                                                   dw CMD_DEATH
0473   6114 58 63                                                   dw CMD_LOOK_AROUND
0474   6116 5D 63                                                   dw CMD_NOTHING
0475   6118 62 63                                                   dw CMD_6362
0476   611A 6A 63                                                   dw CMD_636a
0477   611C 77 63                                                   dw CMD_6377
0478   611E 88 63                                                   dw CMD_6388
0479   6120 92 63                                                   dw CMD_END
0480   6122 95 63                                                   dw CMD_OK
0481   6124 A8 63                                                   dw CMD_SAVE
0482   6126 92 64                                                   dw CMD_6492
0483   6128 A6 64                                                   dw CMD_64a6
0484   612A B6 64                                                   dw CMD_64b6
0485   612C C9 64                                                   dw CMD_SCORE
0486   612E F8 64                                                   dw CMD_GAME
0487   6130 C4 64                                                   dw CMD_LOOP
0488   6132 71 5E                                                   dw CMD_TELL_ME
0489   6134 C4 64                                                   dw CMD_LOOP
0490   6136 C4 64                                                   dw CMD_LOOP
0491   6138 C4 64                                                   dw CMD_LOOP
0492   613A E5          CMD_INVENTORY:                               PUSH HL
0493   613B 18 1F                                                   JR LAB_ram_615c
0494   613D             TEXT_HAVE_WITH_ME:                           db "I HAVE WITH ME THE FOLLOWING:\r",0
0494   613D 4920484156452057495448204D452054484520464F4C4C4F57494E473A0D00
0495   615C 21 3D 61    LAB_ram_615c:                                LD HL,TEXT_HAVE_WITH_ME 
0496   615F CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0497   6162 E1                                                      POP HL
0498   6163 DD 36 FE 00                                             LD (VAR_TEMP),0x0
0499   6167 21 B9 6D                                                LD HL,ITEMS_BY_ROOM_TABLE
0500   616A 0E 00                                                   LD C,0x0
0501   616C 7E          LOOP_INVENTORY:                              LD A,(HL)
0502   616D FE FF                                                   CP 0xff ; ff - end of items
0503   616F 28 42                                                   JR Z,INVENTORY_EMPTY
0504   6171 FE FD                                                   CP 0xfd
0505   6173 38 3A                                                   JR C,NEXT_SCAN_ITEM ; fe - in inventory
0506   6175 DD 36 FE 01                                             LD (VAR_TEMP),0x1
0507   6179 E5                                                      PUSH HL
0508   617A 21 D6 6D                                                LD HL,ITEM_DESC_POINTER 
0509   617D 06 00                                                   LD B,0x0
0510   617F 09                                                      ADD HL,BC
0511   6180 09                                                      ADD HL,BC
0512   6181 5E                                                      LD E,(HL) 
0513   6182 23                                                      INC HL
0514   6183 56                                                      LD D,(HL)
0515   6184 EB                                                      EX DE,HL
0516   6185 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0517   6188 E1                                                      POP HL
0518   6189 7E                                                      LD A,(HL)
0519   618A FE FD                                                   CP 0xfd ; fd - weared item
0520   618C 20 1E                                                   JR NZ,ITEM_NOT_WEARED
0521   618E E5                                                      PUSH HL
0522   618F 21 98 61                                                LD HL,TEXT_WHICH_I_AM_WEARING 
0523   6192 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0524   6195 E1                                                      POP HL
0525   6196 18 14                                                   JR ITEM_NOT_WEARED
0526   6198             TEXT_WHICH_I_AM_WEARING:                     db " WHICH I AM WEARING",0
0526   6198 205748494348204920414D2057454152494E4700
0527   61AC CD DF BF    ITEM_NOT_WEARED:                             CALL SCREEN.PRINT_CR
0528   61AF 23          NEXT_SCAN_ITEM:                              INC HL
0529   61B0 0C                                                      INC C
0530   61B1 18 B9                                                   JR LOOP_INVENTORY
0531   61B3 AF          INVENTORY_EMPTY:                             XOR A
0532   61B4 DD BE FE                                                CP (VAR_TEMP)
0533   61B7 C2 C4 64                                                JP NZ,CMD_LOOP
0534   61BA E5                                                      PUSH HL
0535   61BB 18 10                                                   JR LAB_ram_61cd
0536   61BD             TEXT_NOTHING:                                db "NOTHING AT ALL\r",0
0536   61BD 4E4F5448494E4720415420414C4C0D00
0537   61CD 21 BD 61    LAB_ram_61cd:                                LD HL,TEXT_NOTHING 
0538   61D0 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0539   61D3 E1                                                      POP HL
0540   61D4 C3 C4 64                                                JP CMD_LOOP
0541   61D7 CD D6 60    CMD_NOT_WEARING:                             CALL SUB_ram_60d6
0542   61DA FE FD                                                   CP 0xfd
0543   61DC 28 22                                                   JR Z,LAB_ram_6200
0544   61DE E5                                                      PUSH HL
0545   61DF 18 15                                                   JR LAB_ram_61f6
0546   61E1             TEXT_NOT_WEARING:                            db "I AM NOT WEARING IT\r",0
0546   61E1 4920414D204E4F542057454152494E472049540D00
0547   61F6 21 E1 61    LAB_ram_61f6:                                LD HL,TEXT_NOT_WEARING 
0548   61F9 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0549   61FC E1                                                      POP HL
0550   61FD C3 C4 64                                                JP CMD_LOOP
0551   6200 DD 7E 01    LAB_ram_6200:                                LD A,(VAR_ITEMS_COUNT)
0552   6203 FE 06                                                   CP 0x6
0553   6205 20 28                                                   JR NZ,LAB_ram_622f
0554   6207 E5                                                      PUSH HL
0555   6208 18 1B                                                   JR LAB_ram_6225
0556   620A             TEXT_HAND_FULL:                              db "I CANT. MY HANDS ARE FULL\r",0
0556   620A 492043414E542E204D592048414E4453204152452046554C4C0D00
0557   6225 21 0A 62    LAB_ram_6225:                                LD HL,TEXT_HAND_FULL 
0558   6228 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0559   622B E1                                                      POP HL
0560   622C C3 C4 64                                                JP CMD_LOOP
0561   622F 36 FE       LAB_ram_622f:                                LD (HL),0xfe
0562   6231 DD 34 01                                                INC (VAR_ITEMS_COUNT)
0563   6234 C3 82 63                                                JP CMD_ENDED
0564   6237 DD 7E 01    CMD_CANT_CARRY:                              LD A,(VAR_ITEMS_COUNT)
0565   623A FE 06                                                   CP 0x6 ; max items in inventory
0566   623C 20 24                                                   JR NZ,SPACE_IS_ENOUGH
0567   623E E5                                                      PUSH HL
0568   623F 18 17                                                   JR LAB_ram_6258
0569   6241             TEXT_CANT_CARRY:                             db "I CANT CARRY ANY MORE\r",0
0569   6241 492043414E5420434152525920414E59204D4F52450D00
0570   6258 21 41 62    LAB_ram_6258:                                LD HL,TEXT_CANT_CARRY 
0571   625B CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0572   625E E1                                                      POP HL
0573   625F C3 C4 64                                                JP CMD_LOOP
0574   6262 CD D6 60    SPACE_IS_ENOUGH:                             CALL SUB_ram_60d6
0575   6265 DD BE FF                                                CP (VAR_CURRENT_ROOM)
0576   6268 20 08                                                   JR NZ,LAB_ram_6272
0577   626A 36 FE                                                   LD (HL),0xfe
0578   626C DD 34 01                                                INC (VAR_ITEMS_COUNT)
0579   626F C3 82 63                                                JP CMD_ENDED
0580   6272 FE FD       LAB_ram_6272:                                CP 0xfd
0581   6274 28 22                                                   JR Z,LAB_ram_6298
0582   6276 FE FE                                                   CP 0xfe
0583   6278 28 1E                                                   JR Z,LAB_ram_6298
0584   627A 21 83 62                                                LD HL,TEXT_I_DONT_SEE 
0585   627D CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0586   6280 C3 C4 64                                                JP CMD_LOOP
0587   6283             TEXT_I_DONT_SEE:                             db "I DON'T SEE IT HERE\r",0
0587   6283 4920444F4E27542053454520495420484552450D00
0588   6298 E5          LAB_ram_6298:                                PUSH HL
0589   6299 18 13                                                   JR LAB_ram_62ae
0590   629B             TEXT_ALREADY_HAVE:                           db "I ALREADY HAVE IT\r",0
0590   629B 4920414C524541445920484156452049540D00
0591   62AE 21 9B 62    LAB_ram_62ae:                                LD HL,TEXT_ALREADY_HAVE 
0592   62B1 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0593   62B4 E1                                                      POP HL
0594   62B5 C3 C4 64                                                JP CMD_LOOP
0595   62B8 CD D6 60    CMD_DONT_HAVE:                               CALL SUB_ram_60d6
0596   62BB DD BE FF                                                CP (VAR_CURRENT_ROOM)
0597   62BE 20 1D                                                   JR NZ,LAB_ram_62dd
0598   62C0 E5          LAB_ram_62c0:                                PUSH HL
0599   62C1 18 10                                                   JR LAB_ram_62d3
0600   62C3             TEXT_I_DONT_HAVE:                            db "I DONT HAVE IT\r",0
0600   62C3 4920444F4E5420484156452049540D00
0601   62D3 21 C3 62    LAB_ram_62d3:                                LD HL,TEXT_I_DONT_HAVE 
0602   62D6 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0603   62D9 E1                                                      POP HL
0604   62DA C3 C4 64                                                JP CMD_LOOP
0605   62DD FE FD       LAB_ram_62dd:                                CP 0xfd
0606   62DF 28 07                                                   JR Z,LAB_ram_62e8
0607   62E1 FE FE                                                   CP 0xfe
0608   62E3 20 DB                                                   JR NZ,LAB_ram_62c0
0609   62E5 DD 35 01                                                DEC (VAR_ITEMS_COUNT)
0610   62E8 DD 7E FF    LAB_ram_62e8:                                LD A,(VAR_CURRENT_ROOM)
0611   62EB 77                                                      LD (HL),A
0612   62EC C3 82 63                                                JP CMD_ENDED
0613   62EF CD D6 60    CMD_ALREADY_WEAR:                            CALL SUB_ram_60d6
0614   62F2 FE FE                                                   CP 0xfe
0615   62F4 20 08                                                   JR NZ,LAB_ram_62fe
0616   62F6 36 FD                                                   LD (HL),0xfd
0617   62F8 DD 35 01                                                DEC (VAR_ITEMS_COUNT)
0618   62FB C3 82 63                                                JP CMD_ENDED
0619   62FE FE FD       LAB_ram_62fe:                                CP 0xfd
0620   6300 20 26                                                   JR NZ,LAB_ram_6328
0621   6302 E5                                                      PUSH HL
0622   6303 18 19                                                   JR LAB_ram_631e
0623   6305             TEXT_ALREADY_WEAR:                           db "I AM ALREADY WEARING IT\r",0
0623   6305 4920414D20414C52454144592057454152494E472049540D00
0624   631E 21 05 63    LAB_ram_631e:                                LD HL,TEXT_ALREADY_WEAR 
0625   6321 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0626   6324 E1                                                      POP HL
0627   6325 C3 C4 64                                                JP CMD_LOOP
0628   6328 E5          LAB_ram_6328:                                PUSH HL
0629   6329 18 10                                                   JR LAB_ram_633b
0630   632B             TEXT_I_DONT_HAVE_IT:                         db "I DONT HAVE IT\r",0
0630   632B 4920444F4E5420484156452049540D00
0631   633B 21 2B 63    LAB_ram_633b:                                LD HL,TEXT_I_DONT_HAVE_IT 
0632   633E CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0633   6341 E1                                                      POP HL
0634   6342 C3 C4 64                                                JP CMD_LOOP
0635   6345 21 A1 78    CMD_DEATH:                              LD HL,ACTION_POINTER 
0636   6348 06 00                                                   LD B,0x0
0637   634A DD 4E F9                                                LD C,(VAR_PROC_PARAM)
0638   634D 09                                                      ADD HL,BC
0639   634E 09                                                      ADD HL,BC
0640   634F 5E                                                      LD E,(HL) 
0641   6350 23                                                      INC HL
0642   6351 56                                                      LD D,(HL)
0643   6352 EB                                                      EX DE,HL
0644   6353 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0645   6356 18 2A                                                   JR CMD_ENDED
0646   6358 C1          CMD_LOOK_AROUND:                             POP BC
0647   6359 E1                                                      POP HL
0648   635A C3 BD 5D                                                JP ENTER_NEW_ROOM
0649   635D C1          CMD_NOTHING:                                 POP BC
0650   635E E1                                                      POP HL
0651   635F C3 6B 5E                                                JP PARSE_DEFAULTS
0652   6362 DD 7E F9    CMD_6362:                                    LD A,(VAR_PROC_PARAM)
0653   6365 DD 77 FF                                                LD (VAR_CURRENT_ROOM),A
0654   6368 18 18                                                   JR CMD_ENDED
0655   636A 21 48 5D    CMD_636a:                                    LD HL,BUFFER
0656   636D 06 00                                                   LD B,0x0
0657   636F DD 4E F9                                                LD C,(VAR_PROC_PARAM)
0658   6372 09                                                      ADD HL,BC
0659   6373 36 FF                                                   LD (HL),0xff
0660   6375 18 0B                                                   JR CMD_ENDED
0661   6377 21 48 5D    CMD_6377:                                    LD HL,BUFFER
0662   637A 06 00                                                   LD B,0x0
0663   637C DD 4E F9                                                LD C,(VAR_PROC_PARAM)
0664   637F 09                                                      ADD HL,BC
0665   6380 36 00                                                   LD (HL),0x0
0666   6382 C1          CMD_ENDED:                                   POP BC
0667   6383 E1                                                      POP HL
0668   6384 03                                                      INC BC
0669   6385 C3 B7 60                                                JP NEXT_COMMAND
0670   6388 CD D6 60    CMD_6388:                                    CALL SUB_ram_60d6
0671   638B 23                                                      INC HL
0672   638C 46                                                      LD B,(HL)
0673   638D 77                                                      LD (HL),A
0674   638E 2B                                                      DEC HL
0675   638F 70                                                      LD (HL),B
0676   6390 18 F0                                                   JR CMD_ENDED
0677   6392 C3 3F 64    CMD_END:                                     JP TRY_AGAIN
0678   6395 E5          CMD_OK:                                      PUSH HL
0679   6396 18 06                                                   JR LAB_ram_639e
0680   6398             TEXT_OK:                                     db "OK..\r",0
0680   6398 4F4B2E2E0D00
0681   639E 21 98 63    LAB_ram_639e:                                LD HL,TEXT_OK 
0682   63A1 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0683   63A4 E1                                                      POP HL
0684   63A5 C3 C4 64                                                JP CMD_LOOP
0685   63A8 E5          CMD_SAVE:                                    PUSH HL
0686   63A9 18 1F                                                   JR LAB_ram_63ca
0687   63AB             TEXT_WANT_SAVE:                              db "DO YOU WANT TO SAVE THE GAME?\r",0
0687   63AB 444F20594F552057414E5420544F2053415645205448452047414D453F0D00
0688   63CA 21 AB 63    LAB_ram_63ca:                                LD HL,TEXT_WANT_SAVE 
0689   63CD CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0690   63D0 E1                                                      POP HL
0691   63D1 CD 38 67                                                CALL WAIT_KEY
0692   63D4 FE 59                                                   CP 0x59
0693   63D6 20 67                                                   JR NZ,TRY_AGAIN
0694   63D8 DD E5                                                   PUSH IX
0695   63DA DD 21 46 5D                                             LD IX,SAVE_BUFFER_PART1
0696   63DE 11 2B 00                                                LD DE,0x2b
0697   63E1 E5                                                      PUSH HL
0698   63E2 18 10                                                   JR LAB_ram_63f4
0699   63E4             TEXT_READY_TYPE:                             db "READY CASSETTE\r",0
0699   63E4 52454144592043415353455454450D00
0700   63F4 21 E4 63    LAB_ram_63f4:                                LD HL,TEXT_READY_TYPE 
0701   63F7 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0702   63FA E1                                                      POP HL
0703   63FB CD 38 67                                                CALL WAIT_KEY
0704   63FE 3E FF                                                   LD A,0xff
0705   6400 37                                                      SCF
0706   6401 CD C2 04                                                CALL 0x04c2
0707   6404 DD 21 B9 6D                                             LD IX,ITEMS_BY_ROOM_TABLE
0708   6408 11 1D 00                                                LD DE,0x1d
0709   640B 3E FF                                                   LD A,0xff
0710   640D 37                                                      SCF
0711   640E CD C2 04                                                CALL 0x04c2
0712   6411 DD E1                                                   POP IX
0713   6413 E5                                                      PUSH HL
0714   6414 18 1A                                                   JR LAB_ram_6430
0715   6416             TEXT_CONTINUE:                               db "DO YOU WISH TO CONTINUE?\r",0
0715   6416 444F20594F55205749534820544F20434F4E54494E55453F0D00
0716   6430 21 16 64    LAB_ram_6430:                                LD HL,TEXT_CONTINUE 
0717   6433 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0718   6436 E1                                                      POP HL
0719   6437 CD 38 67                                                CALL WAIT_KEY
0720   643A FE 59                                                   CP 0x59
0721   643C CA C4 64                                                JP Z,CMD_LOOP
0722   643F E5          TRY_AGAIN:                                   PUSH HL
0723   6440 18 1B                                                   JR LAB_ram_645d
0724   6442             TEXT_TRY_AGAIN:                              db "DO YOU WISH TO TRY AGAIN?\r",0
0724   6442 444F20594F55205749534820544F2054525920414741494E3F0D00
0725   645D 21 42 64    LAB_ram_645d:                                LD HL,TEXT_TRY_AGAIN 
0726   6460 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0727   6463 E1                                                      POP HL
0728   6464 E5          CHECK_YES_NO:                                PUSH HL
0729   6465 18 12                                                   JR LAB_ram_6479
0730   6467             TEXT_ANSWER:                                 db "ANSWER YES OR NO\r",0
0730   6467 414E5357455220594553204F52204E4F0D00
0731   6479 21 67 64    LAB_ram_6479:                                LD HL,TEXT_ANSWER 
0732   647C CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0733   647F E1                                                      POP HL
0734   6480 CD 38 67                                                CALL WAIT_KEY
0735   6483 00                                                      NOP
0736   6484 00                                                      NOP
0737   6485 00                                                      NOP
0738   6486 FE 59                                                   CP 0x59
0739   6488 CA 6C 5D                                                JP Z,ENTRY_POINT
0740   648B FE 4E                                                   CP 0x4e
0741   648D CA 00 00                                                JP Z,0x0000
0742   6490 18 D2                                                   JR CHECK_YES_NO
0743   6492 C1          CMD_6492:                                    POP BC
0744   6493 03                                                      INC BC
0745   6494 C5                                                      PUSH BC
0746   6495 0A                                                      LD A,(BC)
0747   6496 32 43 5D                                                LD (VAR_PROC_ADDR),A
0748   6499 21 48 5D                                                LD HL,BUFFER
0749   649C 06 00                                                   LD B,0x0
0750   649E DD 4E F9                                                LD C,(VAR_PROC_PARAM)
0751   64A1 09                                                      ADD HL,BC
0752   64A2 77                                                      LD (HL),A
0753   64A3 C3 82 63                                                JP CMD_ENDED
0754   64A6 21 B9 6D    CMD_64a6:                                    LD HL,ITEMS_BY_ROOM_TABLE
0755   64A9 06 00                                                   LD B,0x0
0756   64AB DD 4E F9                                                LD C,(VAR_PROC_PARAM)
0757   64AE 09                                                      ADD HL,BC
0758   64AF DD 7E FF                                                LD A,(VAR_CURRENT_ROOM)
0759   64B2 77                                                      LD (HL),A
0760   64B3 C3 82 63                                                JP CMD_ENDED
0761   64B6 21 B9 6D    CMD_64b6:                                    LD HL,ITEMS_BY_ROOM_TABLE
0762   64B9 06 00                                                   LD B,0x0
0763   64BB DD 4E F9                                                LD C,(VAR_PROC_PARAM)
0764   64BE 09                                                      ADD HL,BC
0765   64BF 36 FC                                                   LD (HL),0xfc
0766   64C1 C3 82 63                                                JP CMD_ENDED
0767   64C4 C1          CMD_LOOP:                                    POP BC
0768   64C5 E1                                                      POP HL
0769   64C6 C3 6B 5E                                                JP PARSE_DEFAULTS
0770   64C9 3A 6A 5D    CMD_SCORE:                                   LD A,(VAR_SCORE)
0771   64CC 47                                                      LD B,A
0772   64CD 3A 41 5D                                                LD A,(VAR_PROC_PARAM_ADDR)
0773   64D0 80                                                      ADD A,B
0774   64D1 27                                                      DAA
0775   64D2 32 6A 5D                                                LD (VAR_SCORE),A
0776   64D5 E1                                                      POP HL
0777   64D6 23                                                      INC HL
0778   64D7 E5                                                      PUSH HL
0779   64D8 3A 6B 5D                                                LD A,(VAR_SCORE+1)
0780   64DB 8E                                                      ADC A,(HL)
0781   64DC 27                                                      DAA
0782   64DD 32 6B 5D                                                LD (VAR_SCORE+1),A
0783   64E0 C3 82 63                                                JP CMD_ENDED
0784   64E3             TEXT_SCORE:                                  db "YOU HAVE A SCORE OF ",0
0784   64E3 594F55204841564520412053434F5245204F462000
0785   64F8 21 E3 64    CMD_GAME:                                    LD HL,TEXT_SCORE 
0786   64FB CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0787   64FE 3A 6B 5D                                                LD A,(VAR_SCORE+1)
0788   6501 CD 12 65                                                CALL PRINT_SCORE
0789   6504 3A 6A 5D                                                LD A,(VAR_SCORE)
0790   6507 CD 12 65                                                CALL PRINT_SCORE
0791   650A CD DF BF                                                CALL SCREEN.PRINT_CR
0792   650D C1                                                      POP BC
0793   650E E1                                                      POP HL
0794   650F C3 B7 60                                                JP NEXT_COMMAND
0795   6512 F5          PRINT_SCORE:                                 PUSH AF
0796   6513 1F                                                      RRA
0797   6514 1F                                                      RRA
0798   6515 1F                                                      RRA
0799   6516 1F                                                      RRA
0800   6517 CD D5 BF                                                CALL SCREEN.PRINT_DIGIT
0801   651A F1                                                      POP AF
0802   651B             
0803   651B E5          CMD_DECODE:                                  PUSH HL ; HL pointed to input buffer, command code return in A, ff - command not found HL not changed
0804   651C 21 20 20                                                LD HL,0x2020 ; two spaces
0805   651F 22 66 5D                                                LD (VAR_CMD_BUF0),HL 
0806   6522 22 68 5D                                                LD (VAR_CMD_BUF1),HL 
0807   6525 E1                                                      POP HL
0808   6526 11 66 5D                                                LD DE,VAR_CMD_BUF0 
0809   6529 06 04                                                   LD B,0x4 ; cmd length
0810   652B 7E          CMD_COPY_LOOP:                               LD A,(HL)
0811   652C FE 20                                                   CP 0x20
0812   652E 28 0D                                                   JR Z,LABEL_LINE_DELIM
0813   6530 FE 00                                                   CP 0x0
0814   6532 28 09                                                   JR Z,LABEL_LINE_DELIM
0815   6534 FE 0D                                                   CP 0xd
0816   6536 28 05                                                   JR Z,LABEL_LINE_DELIM
0817   6538 12                                                      LD (DE),A 
0818   6539 23                                                      INC HL
0819   653A 13                                                      INC DE
0820   653B 10 EE                                                   DJNZ CMD_COPY_LOOP
0821   653D E5          LABEL_LINE_DELIM:                            PUSH HL
0822   653E 21 09 70                                                LD HL,COMMAND_LIST 
0823   6541 3E FF                                                   LD A,0xff
0824   6543 F5                                                      PUSH AF
0825   6544 DD 36 FE 00 CMD_NEXT_COMMAND:                            LD (VAR_TEMP),0x0 ; equal
0826   6548 06 04                                                   LD B,0x4
0827   654A 11 66 5D                                                LD DE,VAR_CMD_BUF0 
0828   654D 7E          CMD_CP_LOOP:                                 LD A,(HL) 
0829   654E                                                         
0830   654E FE FF                                                   CP 0xff
0831   6550 28 15                                                   JR Z,CMD_LIST_ENDED
0832   6552 1A                                                      LD A,(DE) 
0833   6553 BE                                                      CP (HL) 
0834   6554 28 04                                                   JR Z,LAB_ram_6564
0835   6556 DD 36 FE 01                                             LD (VAR_TEMP),0x1 ; not equal
0836   655A 23          LAB_ram_6564:                                INC HL
0837   655B 13                                                      INC DE
0838   655C 10 EF                                                   DJNZ CMD_CP_LOOP
0839   655E AF                                                      XOR A
0840   655F DD BE FE                                                CP (VAR_TEMP) 
0841   6562 20 06                                                   JR NZ,CMD_NOT_EQUAL
0842   6564 F1                                                      POP AF
0843   6565 7E                                                      LD A,(HL) 
0844   6566 F5                                                      PUSH AF
0845   6567 F1          CMD_LIST_ENDED:                              POP AF
0846   6568 E1                                                      POP HL
0847   6569 C9                                                      RET ; command code returned in A
0848   656A 23          CMD_NOT_EQUAL:                               INC HL
0849   656B 18 D7                                                   JR CMD_NEXT_COMMAND
0850   656D E5          GAME_RESTORED:                               PUSH HL
0851   656E 18 10                                                   JR LAB_ram_658a
0852   6570             TEXT_READY_CASSETE:                          db "READY CASSETTE\r",0
0852   6570 52454144592043415353455454450D00
0853   6580 21 70 65    LAB_ram_658a:                                LD HL,TEXT_READY_CASSETE 
0854   6583 CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0855   6586 E1                                                      POP HL
0856   6587 CD 38 67                                                CALL WAIT_KEY
0857   658A DD E5                                                   PUSH IX
0858   658C DD 21 46 5D                                             LD IX,SAVE_BUFFER_PART1
0859   6590 11 29 00                                                LD DE,0x29 ;size of save
0860   6593 3E FF                                                   LD A,0xff
0861   6595 37                                                      SCF
0862   6596 CD 56 05                                                CALL 0x0556
0863   6599 DD 21 B9 6D                                             LD IX,ITEMS_BY_ROOM_TABLE
0864   659D 11 1D 00                                                LD DE,0x1d ;size of game state
0865   65A0 3E FF                                                   LD A,0xff
0866   65A2 37                                                      SCF
0867   65A3 CD 56 05                                                CALL 0x0556
0868   65A6 DD E1                                                   POP IX
0869   65A8 C9                                                      RET
0870   65A9 CD 9F 67    GAME_INIT:                                   CALL INIT_SCREEN
0871   65AC 21 B5 65                                                LD HL,TEXT_WELCOME 
0872   65AF CD 34 BF                                                CALL SCREEN.PRINT_TEXT_WRAP
0873   65B2 C3 38 67                                                JP WAIT_KEY
0874   65B5             TEXT_WELCOME:                                db "WELCOME TO ADVENTURE 'A'\rTHE PLANET OF DEATH\r\rIN THIS ADVENTURE YOU FIND YOUR"
0874   65B5 57454C434F4D4520544F20414456454E54555245202741270D54484520504C41
0874   65D5 4E4554204F462044454154480D0D494E205448495320414456454E5455524520
0874   65F5 594F552046494E4420594F5552
0875   6602                                                         db "SELF STRANDED ON AN ALIEN PLANET. YOUR AIM IS TO ESCAPE FROM THIS PLANET BY FIND"
0875   6602 53454C4620535452414E444544204F4E20414E20414C49454E20504C414E4554
0875   6622 2E20594F55522041494D20495320544F204553434150452046524F4D20544849
0875   6642 5320504C414E45542042592046494E44
0876   6652                                                         db "ING YOUR, NOW CAPTURED AND DISABLED, SPACE SHIP\rYOU WILL MEET VARIOUS HAZARDS A"
0876   6652 494E4720594F55522C204E4F5720434150545552454420414E44204449534142
0876   6672 4C45442C20535041434520534849500D594F552057494C4C204D454554205641
0876   6692 52494F55532048415A415244532041
0877   66A1                                                         db "ND DANGERS ON YOUR ADVENTURE, SOME NATURAL, SOME NOT, ALL OF WHICH YOU MUST OVER"
0877   66A1 4E442044414E47455253204F4E20594F555220414456454E545552452C20534F
0877   66C1 4D45204E41545552414C2C20534F4D45204E4F542C20414C4C204F4620574849
0877   66E1 434820594F55204D555354204F564552
0878   66F1                                                         db "COME TO SUCCEED\r\rGOOD LUCK, YOU WILL NEED IT!\r\rPRESS ANY KEY TO START\r",0
0878   66F1 434F4D4520544F20535543434545440D0D474F4F44204C55434B2C20594F5520
0878   6711 57494C4C204E454544204954210D0D505245535320414E59204B455920544F20
0878   6731 53544152540D00
0879   6738 AF          WAIT_KEY:                                    XOR A
0880   6739 32 ED BB                                                LD (KEYBOARD.LASTK),A
0881   673C 3A ED BB    WRONG_KEY:                                   LD A,(KEYBOARD.LASTK)
0882   673F B7                                                      OR A
0883   6740 28 FA                                                   JR Z,WRONG_KEY
0884   6742 FE 90                                                   CP 0x90 ;
0885   6744 30 F6                                                   JR NC,WRONG_KEY
0886   6746 FE 0C                                                   CP 0xc ; "Form Feed" - next CR
0887   6748 38 F2                                                   JR C,WRONG_KEY
0888   674A FE 60                                                   CP 0x60 ; "`"
0889   674C D8                                                      RET C
0890   674D D6 20                                                   SUB 0x20 ; lower to caps
0891   674F C9                                                      RET
0892   6750 D5                                                      db 0xD5
0893   6751 57                                                      db 0x57
0894   6752 3E                                                      db 0x3E
0895   6753 7F                                                      db 0x7F
0896   6754 DB                                                      db 0xDB
0897   6755 FE                                                      db 0xFE
0898   6756 1F                                                      db 0x1F
0899   6757 38                                                      db 0x38
0900   6758 0D                                                      db 0x0D
0901   6759 3E                                                      db 0x3E
0902   675A FE                                                      db 0xFE
0903   675B DB                                                      db 0xDB
0904   675C FE                                                      db 0xFE
0905   675D 1F                                                      db 0x1F
0906   675E 38                                                      db 0x38
0907   675F 06                                                      db 0x06
0908   6760 3E                                                      db 0x3E
0909   6761 01                                                      db 0x01
0910   6762 B7                                                      db 0xB7
0911   6763 7A          LAB_ram_6787:                                LD A,D
0912   6764 D1                                                      POP DE
0913   6765 C9                                                      RET
0914   6766 AF                                                      XOR A
0915   6767 18 FA                                                   JR LAB_ram_6787
0916   6769 E5          READ_LINE_START:                             PUSH HL
0917   676A 06 20                                                   LD B,0x20
0918   676C 36 00       INPUT_LINE_LOOP:                             LD (HL),0x0
0919   676E CD 38 67                                                CALL WAIT_KEY
0920   6771 FE 0C                                                   CP 0xc ; delete
0921   6773 20 18                                                   JR NZ,INPUT_CHAR
0922   6775 3E 20                                                   LD A,0x20
0923   6777 B8                                                      CP B
0924   6778 28 F2                                                   JR Z,INPUT_LINE_LOOP
0925   677A 04                                                      INC B
0926   677B 2B                                                      DEC HL
0927   677C 3E 08       INPUT_LINE_FULL:                             LD A,0x8
0928   677E CD E7 BF                                                CALL SCREEN.PRINT_CHAR
0929   6781 3E 20                                                   LD A,0x20
0930   6783 CD E7 BF                                                CALL SCREEN.PRINT_CHAR
0931   6786 3E 08                                                   LD A,0x8
0932   6788 CD E7 BF                                                CALL SCREEN.PRINT_CHAR
0933   678B 18 DF                                                   JR INPUT_LINE_LOOP
0934   678D CD E7 BF    INPUT_CHAR:                                  CALL SCREEN.PRINT_CHAR
0935   6790 FE 0D                                                   CP 0xd
0936   6792 28 09                                                   JR Z,INPUT_END_LINE
0937   6794 04                                                      INC B
0938   6795 05                                                      DEC B
0939   6796 28 E4                                                   JR Z,INPUT_LINE_FULL
0940   6798 05                                                      DEC B
0941   6799 77                                                      LD (HL),A
0942   679A 23                                                      INC HL
0943   679B 18 CF                                                   JR INPUT_LINE_LOOP
0944   679D E1          INPUT_END_LINE:                              POP HL
0945   679E C9                                                      RET
0946   679F E5          INIT_SCREEN:                                 PUSH HL
0947   67A0 D5                                                      PUSH DE
0948   67A1 C5                                                      PUSH BC
0949   67A2 F5                                                      PUSH AF
0950   67A3 3E 04                                                   LD A, CLR_BLACK<<3 | CLR_GREEN
0951   67A5 CD 13 BF                                                CALL SCREEN.CLEAR
0952   67A8 F1                                                      POP AF
0953   67A9 C1                                                      POP BC
0954   67AA D1                                                      POP DE
0955   67AB E1                                                      POP HL
0956   67AC C9                                                      RET
0957   67AD D9 67       ROOM_DESC_POINTER:                           dw PLACE_MOUNTAIN_PLATEA 
0958   67AF 3E 68                                                   dw PLACE_EDGE_OF_A_DEEP_PIT 
0959   67B1 75 68                                                   dw PLACE_DAMP_LIMESTONE_CAVE 
0960   67B3 EB 68                                                   dw PLACE_DENSE_FOREST 
0961   67B5 4A 69                                                   dw PLACE_BESIDE_A_LAKE 
0962   67B7 95 69                                                   dw PLACE_STRANGE_HOUSE 
0963   67B9 C7 69                                                   dw PLACE_OLD_SHED 
0964   67BB F4 69                                                   dw PLACE_MAZE 
0965   67BD F4 69                                                   dw PLACE_MAZE 
0966   67BF F4 69                                                   dw PLACE_MAZE 
0967   67C1 F4 69                                                   dw PLACE_MAZE 
0968   67C3 22 6A                                                   dw PLACE_ICE_CAVERN 
0969   67C5 56 6A                                                   dw PLACE_QUIET_CAVERN 
0970   67C7 92 6A                                                   dw PLACE_WIND_TUNNEL 
0971   67C9 ED 6A                                                   dw PLACE_COMPUTER_ROOM 
0972   67CB 4C 6B                                                   dw PLACE_PASSAGE 
0973   67CD BF 6B                                                   dw PLACE_LARGE_HANGER 
0974   67CF 24 6C                                                   dw PLACE_TALL_LIFT 
0975   67D1 64 6C                                                   dw PLACE_LIFT_CONTROL_ROOM 
0976   67D3 EF 6C                                                   dw PLACE_PRISON_CELL 
0977   67D5 06 6D                                                   dw PLACE_SPACE_SHIP 
0978   67D7 00 00                                                   dw 0x0000
0979   67D9             PLACE_MOUNTAIN_PLATEA:                       db "I AM ON A MOUNTAIN PLATEAU\rTO THE NORTH THERE IS A STEEP CLIFF\rOBVIOUS EXITS A"
0979   67D9 4920414D204F4E2041204D4F554E5441494E20504C41544541550D544F205448
0979   67F9 45204E4F525448205448455245204953204120535445455020434C4946460D4F
0979   6819 4256494F55532045584954532041
0980   6827                                                         db "RE DOWN,EAST AND WEST\r",0
0980   6827 524520444F574E2C4541535420414E4420574553540D00
0981   683E             PLACE_EDGE_OF_A_DEEP_PIT:                    db "I AM AT THE EDGE OF A DEEP PIT\rOBVIOUS EXITS ARE EAST\r",0
0981   683E 4920414D204154205448452045444745204F4620412044454550205049540D4F
0981   685E 4256494F55532045584954532041524520454153540D00
0982   6875             PLACE_DAMP_LIMESTONE_CAVE:                   db "I AM IN A DAMP LIMESTONE CAVE WITH STALACTITES HANGING DOWN.\rTHE EXIT IS TO THE"
0982   6875 4920414D20494E20412044414D50204C494D4553544F4E452043415645205749
0982   6895 5448205354414C414354495445532048414E47494E4720444F574E2E0D544845
0982   68B5 204558495420495320544F20544845
0983   68C4                                                         db " WEST\rTHERE IS A PASSAGE TO THE NORTH\r",0
0983   68C4 20574553540D54484552452049532041205041535341474520544F2054484520
0983   68E4 4E4F5254480D00
0984   68EB             PLACE_DENSE_FOREST:                          db "I AM IN A DENSE FOREST\rTHERE IS A ROPE HANGING FROM ONE TREE\rOBVIOUS EXITS ARE"
0984   68EB 4920414D20494E20412044454E534520464F524553540D544845524520495320
0984   690B 4120524F50452048414E47494E472046524F4D204F4E4520545245450D4F4256
0984   692B 494F555320455849545320415245
0985   6939                                                         db " SOUTH AND WEST\r",0
0985   6939 20534F55544820414E4420574553540D00
0986   694A             PLACE_BESIDE_A_LAKE:                         db "I AM BESIDE A LAKE\rEXITS ARE EAST AND NORTH.THERE IS A RAVINE TO THE WEST\r",0
0986   694A 4920414D204245534944452041204C414B450D45584954532041524520454153
0986   696A 5420414E44204E4F5254482E5448455245204953204120524156494E4520544F
0986   698A 2054484520574553540D00
0987   6995             PLACE_STRANGE_HOUSE:                         db "I AM IN A STRANGE HOUSE\rTHE DOOR IS TO THE NORTH\r",0
0987   6995 4920414D20494E204120535452414E474520484F5553450D54484520444F4F52
0987   69B5 20495320544F20544845204E4F5254480D00
0988   69C7             PLACE_OLD_SHED:                              db "I AM IN AN OLD SHED\rTHE EXIT IS TO THE EAST\r",0
0988   69C7 4920414D20494E20414E204F4C4420534845440D544845204558495420495320
0988   69E7 544F2054484520454153540D00
0989   69F4             PLACE_MAZE:                                  db "I AM IN A MAZE.THERE ARE PASSAGES EVERYWHERE\r",0
0989   69F4 4920414D20494E2041204D415A452E5448455245204152452050415353414745
0989   6A14 5320455645525957484552450D00
0990   6A22             PLACE_ICE_CAVERN:                            db "I AM IN AN ICE CAVERN\rTHERE IS AN EXIT TO THE EAST\r",0
0990   6A22 4920414D20494E20414E204943452043415645524E0D54484552452049532041
0990   6A42 4E204558495420544F2054484520454153540D00
0991   6A56             PLACE_QUIET_CAVERN:                          db "I AM IN A QUIET CAVERN\rTHERE ARE EXITS WEST,EAST AND SOUTH\r",0
0991   6A56 4920414D20494E20412051554945542043415645524E0D544845524520415245
0991   6A76 20455849545320574553542C4541535420414E4420534F5554480D00
0992   6A92             PLACE_WIND_TUNNEL:                           db "I AM IN A WIND TUNNEL\rTHERE IS A CLOSED DOOR AT THE END\rTHERE IS ALSO AN EXIT "
0992   6A92 4920414D20494E20412057494E442054554E4E454C0D54484552452049532041
0992   6AB2 20434C4F53454420444F4F522041542054484520454E440D5448455245204953
0992   6AD2 20414C534F20414E204558495420
0993   6AE0                                                         db "TO THE WEST\r",0
0993   6AE0 544F2054484520574553540D00
0994   6AED             PLACE_COMPUTER_ROOM:                         db "I AM IN A ROOM WITH A COMPUTER IN\rTHE COMPUTER IS WORKING AND HAS A KEYBOARD\rT"
0994   6AED 4920414D20494E204120524F4F4D2057495448204120434F4D50555445522049
0994   6B0D 4E0D54484520434F4D505554455220495320574F524B494E4720414E44204841
0994   6B2D 532041204B4559424F4152440D54
0995   6B3B                                                         db "HE EXIT IS WEST\r",0
0995   6B3B 4845204558495420495320574553540D00
0996   6B4C             PLACE_PASSAGE:                               db "I AM IN A PASSAGE\rTHERE IS A FORCE FIELD TO THE SOUTH : BEWARE OF SECURITY\rTHE"
0996   6B4C 4920414D20494E204120504153534147450D5448455245204953204120464F52
0996   6B6C 4345204649454C4420544F2054484520534F555448203A20424557415245204F
0996   6B8C 462053454355524954590D544845
0997   6B9A                                                         db "RE ARE EXITS TO NORTH,EAST AND WEST\r",0
0997   6B9A 52452041524520455849545320544F204E4F5254482C4541535420414E442057
0997   6BBA 4553540D00
0998   6BBF             PLACE_LARGE_HANGER:                          db "I AM IN A LARGE HANGER\rTHERE IS A LOCKED DOOR TO THE WEST\rTHERE ARE ALSO EXITS"
0998   6BBF 4920414D20494E2041204C415247452048414E4745520D544845524520495320
0998   6BDF 41204C4F434B454420444F4F5220544F2054484520574553540D544845524520
0998   6BFF 41524520414C534F204558495453
0999   6C0D                                                         db " EAST,NORTH AND SOUTH\r",0
0999   6C0D 20454153542C4E4F52544820414E4420534F5554480D00
1000   6C24             PLACE_TALL_LIFT:                             db "I AM IN A TALL LIFT.THE BUTTONS ARE VERY HIGH\rTHE EXIT IS WEST\r",0
1000   6C24 4920414D20494E20412054414C4C204C4946542E54484520425554544F4E5320
1000   6C44 415245205645525920484947480D544845204558495420495320574553540D00
1001   6C64             PLACE_LIFT_CONTROL_ROOM:                     db "I AM IN THE LIFT CONTROL ROOM\rTHERE ARE THREE SWITCHES ON THE WALL.THEY ARE ALL"
1001   6C64 4920414D20494E20544845204C49465420434F4E54524F4C20524F4F4D0D5448
1001   6C84 45524520415245205448524545205357495443484553204F4E20544845205741
1001   6CA4 4C4C2E544845592041524520414C4C
1002   6CB3                                                         db " OFF\rA SIGN SAYS : 5,4 NO DUSTY BIN RULES\rTHE EXIT IS EAST\r",0
1002   6CB3 204F46460D41205349474E2053415953203A20352C34204E4F20445553545920
1002   6CD3 42494E2052554C45530D544845204558495420495320454153540D00
1003   6CEF             PLACE_PRISON_CELL:                           db "I AM IN A PRISON CELL\r",0
1003   6CEF 4920414D20494E204120505249534F4E2043454C4C0D00
1004   6D06             PLACE_SPACE_SHIP:                            db "I AM IN A SPACE SHIP.THERE IS NO VISIBLE EXIT\rTHERE IS A SMALL OPEN WINDOW IN T"
1004   6D06 4920414D20494E204120535041434520534849502E5448455245204953204E4F
1004   6D26 2056495349424C4520455849540D5448455245204953204120534D414C4C204F
1004   6D46 50454E2057494E444F5720494E2054
1005   6D55                                                         db "HE SIDE\rTHERE ARE ALSO TWO BUTTONS,ONE MARKED MAIN AND THE OTHER AUX.\r",0
1005   6D55 484520534944450D54484552452041524520414C534F2054574F20425554544F
1005   6D75 4E532C4F4E45204D41524B4544204D41494E20414E4420544845204F54484552
1005   6D95 204155582E0D00
1006   6D9C             ITEMS_BY_ROOM_TABLE_INIT:                             
1007   6D9C 05                                                      db 0x05 ; value = room number, where item is placed
1008   6D9D 11                                                      db 0x11
1009   6D9E 0E                                                      db 0x0E
1010   6D9F 06                                                      db 0x06
1011   6DA0 11                                                      db 0x11
1012   6DA1 FC                                                      db 0xFC
1013   6DA2 FC                                                      db 0xFC
1014   6DA3 0C                                                      db 0x0C
1015   6DA4 FC                                                      db 0xFC
1016   6DA5 0D                                                      db 0x0D
1017   6DA6 FC                                                      db 0xFC
1018   6DA7 05                                                      db 0x05
1019   6DA8 FC                                                      db 0xFC
1020   6DA9 FC                                                      db 0xFC
1021   6DAA 0B                                                      db 0x0B
1022   6DAB FC                                                      db 0xFC
1023   6DAC 0C                                                      db 0x0C
1024   6DAD FC                                                      db 0xFC
1025   6DAE 13                                                      db 0x13
1026   6DAF FC                                                      db 0xFC
1027   6DB0 13                                                      db 0x13
1028   6DB1 FC                                                      db 0xFC
1029   6DB2 10                                                      db 0x10
1030   6DB3 10                                                      db 0x10
1031   6DB4 00                                                      db 0x00
1032   6DB5 01                                                      db 0x01
1033   6DB6 02                                                      db 0x02
1034   6DB7 0F                                                      db 0x0F
1035   6DB8 FF                                                      db 0xFF
1036   6DB9 00          ITEMS_BY_ROOM_TABLE:                         ds 0x1d ; current state of items
1037   6DD6             
1038   6DD6 10 6E       ITEM_DESC_POINTER:                           dw OBJECT_A_PAIR_OF_BOOTS 
1039   6DD8 20 6E                                                   dw OBJECT_A_STARTER_MOTOR 
1040   6DDA 30 6E                                                   dw OBJECT_A_KEY 
1041   6DDC 36 6E                                                   dw OBJECT_A_LASER_GUN 
1042   6DDE 42 6E                                                   dw OBJECT_AN_OUT_OF_ORDER_SIGN 
1043   6DE0 57 6E                                                   dw OBJECT_A_METAL_BAR 
1044   6DE2 63 6E                                                   dw OBJECT_A_GOLD_COIN 
1045   6DE4 6F 6E                                                   dw OBJECT_A_MIRROR 
1046   6DE6 78 6E                                                   dw OBJECT_BROKEN_GLASS 
1047   6DE8 85 6E                                                   dw OBJECT_A_PAIR_OF_SLIMY_GLOVES 
1048   6DEA 9C 6E                                                   dw OBJECT_A_ROPE 
1049   6DEC A3 6E                                                   dw OBJECT_A_FLOOR_BOARD 
1050   6DEE B1 6E                                                   dw OBJECT_A_BROKEN_FLOOR_BOARD 
1051   6DF0 C6 6E                                                   dw OBJECT_STALACTITES 
1052   6DF2 D2 6E                                                   dw OBJECT_A_BLOCK_OF_ICE 
1053   6DF4 E1 6E                                                   dw OBJECT_A_POOL_OF_WATER 
1054   6DF6 F1 6E                                                   dw OBJECT_A_SMALL_GREEN_MAN_SLEEPING 
1055   6DF8 1A 6F                                                   dw OBJECT_A_SLEEPING_GREEN_MAN 
1056   6DFA 2F 6F                                                   dw OBJECT_A_LOCKED_DOOR 
1057   6DFC 3D 6F                                                   dw OBJECT_AN_OPEN_DOOR 
1058   6DFE 4A 6F                                                   dw OBJECT_A_BARRED_WINDOW 
1059   6E00 5A 6F                                                   dw OBJECT_A_HOLE_IN_THE_WALL 
1060   6E02 6D 6F                                                   dw OBJECT_A_SMALL_BUT_POWERFULL_SPACE_SHIP 
1061   6E04 8E 6F                                                   dw OBJECT_A_SLEEPING_SECURITY_MAN 
1062   6E06 A6 6F                                                   dw OBJECT_A_PIECE_OF_SHARP_FLINT 
1063   6E08 BD 6F                                                   dw OBJECT_SOME_STONES 
1064   6E0A C9 6F                                                   dw OBJECT_A_DRAWING_ON_THE_WALL 
1065   6E0C DF 6F                                                   dw OBJECT_A_LOUDSPEAKER_WITH_DANCE_MUSIC 
1066   6E0E 00 00                                                   dw 0x0000
1067   6E10             OBJECT_A_PAIR_OF_BOOTS:                      db "A PAIR OF BOOTS",0
1067   6E10 412050414952204F4620424F4F545300
1068   6E20             OBJECT_A_STARTER_MOTOR:                      db "A STARTER MOTOR",0
1068   6E20 412053544152544552204D4F544F5200
1069   6E30             OBJECT_A_KEY:                                db "A KEY",0
1069   6E30 41204B455900
1070   6E36             OBJECT_A_LASER_GUN:                          db "A LASER GUN",0
1070   6E36 41204C415345522047554E00
1071   6E42             OBJECT_AN_OUT_OF_ORDER_SIGN:                 db "AN OUT OF ORDER SIGN",0
1071   6E42 414E204F5554204F46204F52444552205349474E00
1072   6E57             OBJECT_A_METAL_BAR:                          db "A METAL BAR",0
1072   6E57 41204D4554414C2042415200
1073   6E63             OBJECT_A_GOLD_COIN:                          db "A GOLD COIN",0
1073   6E63 4120474F4C4420434F494E00
1074   6E6F             OBJECT_A_MIRROR:                             db "A MIRROR",0
1074   6E6F 41204D4952524F5200
1075   6E78             OBJECT_BROKEN_GLASS:                         db "BROKEN GLASS",0
1075   6E78 42524F4B454E20474C41535300
1076   6E85             OBJECT_A_PAIR_OF_SLIMY_GLOVES:               db "A PAIR OF SLIMY GLOVES",0
1076   6E85 412050414952204F4620534C494D5920474C4F56455300
1077   6E9C             OBJECT_A_ROPE:                               db "A ROPE",0
1077   6E9C 4120524F504500
1078   6EA3             OBJECT_A_FLOOR_BOARD:                        db "A FLOOR BOARD",0
1078   6EA3 4120464C4F4F5220424F41524400
1079   6EB1             OBJECT_A_BROKEN_FLOOR_BOARD:                 db "A BROKEN FLOOR BOARD",0
1079   6EB1 412042524F4B454E20464C4F4F5220424F41524400
1080   6EC6             OBJECT_STALACTITES:                          db "STALACTITES",0
1080   6EC6 5354414C4143544954455300
1081   6ED2             OBJECT_A_BLOCK_OF_ICE:                       db "A BLOCK OF ICE",0
1081   6ED2 4120424C4F434B204F462049434500
1082   6EE1             OBJECT_A_POOL_OF_WATER:                      db "A POOL OF WATER",0
1082   6EE1 4120504F4F4C204F4620574154455200
1083   6EF1             OBJECT_A_SMALL_GREEN_MAN_SLEEPING:           db "A SMALL GREEN MAN SLEEPING ON THE MIRROR",0
1083   6EF1 4120534D414C4C20475245454E204D414E20534C454550494E47204F4E205448
1083   6F11 45204D4952524F5200
1084   6F1A             OBJECT_A_SLEEPING_GREEN_MAN:                 db "A SLEEPING GREEN MAN",0
1084   6F1A 4120534C454550494E4720475245454E204D414E00
1085   6F2F             OBJECT_A_LOCKED_DOOR:                        db "A LOCKED DOOR",0
1085   6F2F 41204C4F434B454420444F4F5200
1086   6F3D             OBJECT_AN_OPEN_DOOR:                         db "AN OPEN DOOR",0
1086   6F3D 414E204F50454E20444F4F5200
1087   6F4A             OBJECT_A_BARRED_WINDOW:                      db "A BARRED WINDOW",0
1087   6F4A 41204241525245442057494E444F5700
1088   6F5A             OBJECT_A_HOLE_IN_THE_WALL:                   db "A HOLE IN THE WALL",0
1088   6F5A 4120484F4C4520494E205448452057414C4C00
1089   6F6D             OBJECT_A_SMALL_BUT_POWERFULL_SPACE_SHIP:     db "A SMALL BUT POWERFULL SPACE SHIP",0
1089   6F6D 4120534D414C4C2042555420504F57455246554C4C2053504143452053484950
1089   6F8D 00
1090   6F8E             OBJECT_A_SLEEPING_SECURITY_MAN:              db "A SLEEPING SECURITY MAN",0
1090   6F8E 4120534C454550494E47205345435552495459204D414E00
1091   6FA6             OBJECT_A_PIECE_OF_SHARP_FLINT:               db "A PIECE OF SHARP FLINT",0
1091   6FA6 41205049454345204F4620534841525020464C494E5400
1092   6FBD             OBJECT_SOME_STONES:                          db "SOME STONES",0
1092   6FBD 534F4D452053544F4E455300
1093   6FC9             OBJECT_A_DRAWING_ON_THE_WALL:                db "A DRAWING ON THE WALL",0
1093   6FC9 412044524157494E47204F4E205448452057414C4C00
1094   6FDF             OBJECT_A_LOUDSPEAKER_WITH_DANCE_MUSIC:       db "A LOUDSPEAKER WITH DANCE MUSIC COMING OUT",0
1094   6FDF 41204C4F5544535045414B455220574954482044414E4345204D555349432043
1094   6FFF 4F4D494E47204F555400
1095   7009 44 4F 57 4E COMMAND_LIST:                                db "DOWN"
1096   700D 01                                                      db 0x01
1097   700E 44 20 20 20                                             db "D   "
1098   7012 01                                                      db 0x01
1099   7013 4E 4F 52 54                                             db "NORT"
1100   7017 02                                                      db 0x02
1101   7018 4E 20 20 20                                             db "N   "
1102   701C 02                                                      db 0x02
1103   701D 53 4F 55 54                                             db "SOUT"
1104   7021 03                                                      db 0x03
1105   7022 53 20 20 20                                             db "S   "
1106   7026 03                                                      db 0x03
1107   7027 45 41 53 54                                             db "EAST"
1108   702B 04                                                      db 0x04
1109   702C 45 20 20 20                                             db "E   "
1110   7030 04                                                      db 0x04
1111   7031 57 45 53 54                                             db "WEST"
1112   7035 05                                                      db 0x05
1113   7036 57 20 20 20                                             db "W   "
1114   703A 05                                                      db 0x05
1115   703B 47 45 54 20                                             db "GET "
1116   703F 0D                                                      db COMMAND_GET
1117   7040 50 49 43 4B                                             db "PICK"
1118   7044 0D                                                      db COMMAND_GET
1119   7045 44 52 4F 50                                             db "DROP"
1120   7049 0E                                                      db 0x0E
1121   704A 50 55 54 20                                             db "PUT "
1122   704E 0E                                                      db 0x0E
1123   704F 46 49 52 45                                             db "FIRE"
1124   7053 0F                                                      db 0x0F
1125   7054 53 48 4F 4F                                             db "SHOO"
1126   7058 0F                                                      db 0x0F
1127   7059 42 4F 4F 54                                             db "BOOT"
1128   705D 10                                                      db 0x10
1129   705E 53 54 41 52                                             db "STAR"
1130   7062 11                                                      db 0x11
1131   7063 4D 4F 54 4F                                             db "MOTO"
1132   7067 11                                                      db 0x11
1133   7068 4B 45 59 20                                             db "KEY "
1134   706C 12                                                      db 0x12
1135   706D 4C 41 53 45                                             db "LASE"
1136   7071 13                                                      db 0x13
1137   7072 47 55 4E 20                                             db "GUN "
1138   7076 13                                                      db 0x13
1139   7077 55 53 45 44                                             db "USED"
1140   707B 14                                                      db 0x14
1141   707C 42 41 52 20                                             db "BAR "
1142   7080 15                                                      db 0x15
1143   7081 42 41 52 53                                             db "BARS"
1144   7085 15                                                      db 0x15
1145   7086 47 4F 4C 44                                             db "GOLD"
1146   708A 16                                                      db 0x16
1147   708B 43 4F 49 4E                                             db "COIN"
1148   708F 16                                                      db 0x16
1149   7090 4D 49 52 52                                             db "MIRR"
1150   7094 17                                                      db 0x17
1151   7095 42 52 4F 4B                                             db "BROK"
1152   7099 18                                                      db 0x18
1153   709A 47 4C 4F 56                                             db "GLOV"
1154   709E 19                                                      db 0x19
1155   709F 52 4F 50 45                                             db "ROPE"
1156   70A3 1A                                                      db 0x1A
1157   70A4 46 4C 4F 4F                                             db "FLOO"
1158   70A8 1B                                                      db 0x1B
1159   70A9 42 4F 41 52                                             db "BOAR"
1160   70AD 1B                                                      db 0x1B
1161   70AE 50 4C 41 4E                                             db "PLAN"
1162   70B2 1B                                                      db 0x1B
1163   70B3 53 54 41 4C                                             db "STAL"
1164   70B7 1C                                                      db 0x1C
1165   70B8 42 4C 4F 43                                             db "BLOC"
1166   70BC 1D                                                      db 0x1D
1167   70BD 49 43 45 20                                             db "ICE "
1168   70C1 1D                                                      db 0x1D
1169   70C2 50 4F 4F 4C                                             db "POOL"
1170   70C6 1E                                                      db 0x1E
1171   70C7 57 41 54 45                                             db "WATE"
1172   70CB 1E                                                      db 0x1E
1173   70CC 4C 41 4B 45                                             db "LAKE"
1174   70D0 1E                                                      db 0x1E
1175   70D1 53 4C 45 45                                             db "SLEE"
1176   70D5 1F                                                      db 0x1F
1177   70D6 47 52 45 45                                             db "GREE"
1178   70DA 1F                                                      db 0x1F
1179   70DB 4D 41 4E 20                                             db "MAN "
1180   70DF 1F                                                      db 0x1F
1181   70E0 44 4F 4F 52                                             db "DOOR"
1182   70E4 20                                                      db 0x20
1183   70E5 4F 50 45 4E                                             db "OPEN"
1184   70E9 21                                                      db 0x21
1185   70EA 55 4E 4C 4F                                             db "UNLO"
1186   70EE 21                                                      db 0x21
1187   70EF 57 49 4E 44                                             db "WIND"
1188   70F3 22                                                      db 0x22
1189   70F4 53 4D 41 4C                                             db "SMAL"
1190   70F8 23                                                      db 0x23
1191   70F9 53 50 41 43                                             db "SPAC"
1192   70FD 23                                                      db 0x23
1193   70FE 53 48 49 50                                             db "SHIP"
1194   7102 23                                                      db 0x23
1195   7103 53 45 43 55                                             db "SECU"
1196   7107 24                                                      db 0x24
1197   7108 46 4C 49 4E                                             db "FLIN"
1198   710C 25                                                      db 0x25
1199   710D 53 54 4F 4E                                             db "STON"
1200   7111 26                                                      db 0x26
1201   7112 44 52 41 57                                             db "DRAW"
1202   7116 27                                                      db 0x27
1203   7117 48 45 4C 50                                             db "HELP"
1204   711B 28                                                      db 0x28
1205   711C 49 4E 56 45                                             db "INVE"
1206   7120 29                                                      db 0x29
1207   7121 49 20 20 20                                             db "I   "
1208   7125 29                                                      db 0x29
1209   7126 51 55 49 54                                             db "QUIT"
1210   712A 2A                                                      db 0x2A
1211   712B 53 54 4F 50                                             db "STOP"
1212   712F 2A                                                      db 0x2A
1213   7130 41 42 4F 52                                             db "ABOR"
1214   7134 2A                                                      db 0x2A
1215   7135 59 45 53 20                                             db "YES "
1216   7139 2B                                                      db 0x2B
1217   713A 59 20 20 20                                             db "Y   "
1218   713E 2B                                                      db 0x2B
1219   713F 4E 4F 20 20                                             db "NO  "
1220   7143 2C                                                      db 0x2C
1221   7144 43 4F 4D 50                                             db "COMP"
1222   7148 2D                                                      db 0x2D
1223   7149 4B 45 59 42                                             db "KEYB"
1224   714D 2D                                                      db 0x2D
1225   714E 54 59 50 45                                             db "TYPE"
1226   7152 2E                                                      db 0x2E
1227   7153 54 55 52 4E                                             db "TURN"
1228   7157 2F                                                      db 0x2F
1229   7158 48 41 4E 44                                             db "HAND"
1230   715C 30                                                      db 0x30
1231   715D 4B 49 4C 4C                                             db "KILL"
1232   7161 31                                                      db 0x31
1233   7162 44 41 4E 43                                             db "DANC"
1234   7166 32                                                      db 0x32
1235   7167 57 41 4C 54                                             db "WALT"
1236   716B 32                                                      db 0x32
1237   716C 52 45 4D 4F                                             db "REMO"
1238   7170 33                                                      db 0x33
1239   7171 4B 49 43 4B                                             db "KICK"
1240   7175 34                                                      db 0x34
1241   7176 42 52 45 41                                             db "BREA"
1242   717A 34                                                      db 0x34
1243   717B 48 49 54 20                                             db "HIT "
1244   717F 34                                                      db 0x34
1245   7180 42 41 4E 47                                             db "BANG"
1246   7184 34                                                      db 0x34
1247   7185 42 52 49 42                                             db "BRIB"
1248   7189 35                                                      db 0x35
1249   718A 55 53 45 20                                             db "USE "
1250   718E 36                                                      db 0x36
1251   718F 57 49 54 48                                             db "WITH"
1252   7193 36                                                      db 0x36
1253   7194 50 55 53 48                                             db "PUSH"
1254   7198 37                                                      db 0x37
1255   7199 54 48 52 45                                             db "THRE"
1256   719D 38                                                      db 0x38
1257   719E 33 20 20 20                                             db "3   "
1258   71A2 38                                                      db 0x38
1259   71A3 54 57 4F 20                                             db "TWO "
1260   71A7 39                                                      db 0x39
1261   71A8 32 20 20 20                                             db "2   "
1262   71AC 39                                                      db 0x39
1263   71AD 4F 4E 45 20                                             db "ONE "
1264   71B1 3A                                                      db 0x3A
1265   71B2 31 20 20 20                                             db "1   "
1266   71B6 3A                                                      db 0x3A
1267   71B7 4D 45 4E 44                                             db "MEND"
1268   71BB 3B                                                      db 0x3B
1269   71BC 46 49 58 20                                             db "FIX "
1270   71C0 3B                                                      db 0x3B
1271   71C1 52 45 50 41                                             db "REPA"
1272   71C5 3B                                                      db 0x3B
1273   71C6 46 4F 55 52                                             db "FOUR"
1274   71CA 3C                                                      db 0x3C
1275   71CB 34 20 20 20                                             db "4   "
1276   71CF 3C                                                      db 0x3C
1277   71D0 4C 4F 4F 4B                                             db "LOOK"
1278   71D4 3D                                                      db 0x3D
1279   71D5 53 54 41 4E                                             db "STAN"
1280   71D9 3E                                                      db 0x3E
1281   71DA 54 52 45 45                                             db "TREE"
1282   71DE 3F                                                      db 0x3F
1283   71DF 43 55 54 20                                             db "CUT "
1284   71E3 40                                                      db 0x40
1285   71E4 53 41 57 20                                             db "SAW "
1286   71E8 40                                                      db 0x40
1287   71E9 57 45 41 52                                             db "WEAR"
1288   71ED 41                                                      db 0x41
1289   71EE 43 52 4F 53                                             db "CROS"
1290   71F2 42                                                      db 0x42
1291   71F3 4A 55 4D 50                                             db "JUMP"
1292   71F7 43                                                      db 0x43
1293   71F8 52 41 56 49                                             db "RAVI"
1294   71FC 44                                                      db 0x44
1295   71FD 55 50 20 20                                             db "UP  "
1296   7201 45                                                      db 0x45
1297   7202 55 20 20 20                                             db "U   "
1298   7206 45                                                      db 0x45
1299   7207 43 4C 49 4D                                             db "CLIM"
1300   720B 45                                                      db 0x45
1301   720C 46 55 53 45                                             db "FUSE"
1302   7210 46                                                      db 0x46
1303   7211 52 45 44 45                                             db "REDE"
1304   7215 47                                                      db 0x47
1305   7216 52 20 20 20                                             db "R   "
1306   721A 47                                                      db 0x47
1307   721B 4D 41 49 4E                                             db "MAIN"
1308   721F 48                                                      db 0x48
1309   7220 41 55 58 20                                             db "AUX "
1310   7224 49                                                      db 0x49
1311   7225 46 49 45 4C                                             db "FIEL"
1312   7229 4A                                                      db 0x4A
1313   722A 53 48 49 45                                             db "SHIE"
1314   722E 4A                                                      db 0x4A
1315   722F FF                                                      db 0xFF
1316   7230 FF          BYTE_ram_72b7:                               db 0xFF
1317   7231 01          VALID_GET_BOOT:                              db 0x01 ; PROC_01
1318   7232 00                                                      db 0x00 ; with zero
1319   7233 FF                                                      db 0xFF
1320   7234 01          BYTE_ram_72bb:                               db 0x01
1321   7235 01                                                      db 0x01
1322   7236 FF                                                      db 0xFF
1323   7237 01          BYTE_ram_72be:                               db 0x01
1324   7238 02                                                      db 0x02
1325   7239 FF                                                      db 0xFF
1326   723A 01          BYTE_ram_72c1:                               db 0x01
1327   723B 03                                                      db 0x03
1328   723C FF                                                      db 0xFF
1329   723D 01          BYTE_ram_72c4:                               db 0x01
1330   723E 05                                                      db 0x05
1331   723F FF                                                      db 0xFF
1332   7240 01          BYTE_ram_72c7:                               db 0x01
1333   7241 06                                                      db 0x06
1334   7242 FF                                                      db 0xFF
1335   7243 01          BYTE_ram_72ca:                               db 0x01
1336   7244 07                                                      db 0x07
1337   7245 03                                                      db 0x03
1338   7246 10                                                      db 0x10
1339   7247 FF                                                      db 0xFF
1340   7248 01          BYTE_ram_72cf:                               db 0x01
1341   7249 08                                                      db 0x08
1342   724A FF                                                      db 0xFF
1343   724B 01          BYTE_ram_72d2:                               db 0x01
1344   724C 09                                                      db 0x09
1345   724D FF                                                      db 0xFF
1346   724E 01          BYTE_ram_72d5:                               db 0x01
1347   724F 0A                                                      db 0x0A
1348   7250 FF                                                      db 0xFF
1349   7251 01          BYTE_ram_72d8:                               db 0x01
1350   7252 0B                                                      db 0x0B
1351   7253 FF                                                      db 0xFF
1352   7254 01          BYTE_ram_72db:                               db 0x01
1353   7255 0C                                                      db 0x0C
1354   7256 FF                                                      db 0xFF
1355   7257 01          BYTE_ram_72de:                               db 0x01
1356   7258 0D                                                      db 0x0D
1357   7259 FF                                                      db 0xFF
1358   725A 01          BYTE_ram_72e1:                               db 0x01
1359   725B 0E                                                      db 0x0E
1360   725C FF                                                      db 0xFF
1361   725D 01          BYTE_ram_72e4:                               db 0x01
1362   725E 18                                                      db 0x18
1363   725F FF                                                      db 0xFF
1364   7260 01          BYTE_ram_72e7:                               db 0x01
1365   7261 19                                                      db 0x19
1366   7262 FF                                                      db 0xFF
1367   7263 01          BYTE_ram_72ea:                               db 0x01
1368   7264 07                                                      db 0x07
1369   7265 FF                                                      db 0xFF
1370   7266 00          BYTE_ram_72ed:                               db 0x00
1371   7267 02                                                      db 0x02
1372   7268 FF                                                      db 0xFF
1373   7269 00          BYTE_ram_72f0:                               db 0x00
1374   726A 02                                                      db 0x02
1375   726B 01                                                      db 0x01
1376   726C 0E                                                      db 0x0E
1377   726D FF                                                      db 0xFF
1378   726E 00          BYTE_ram_72f5:                               db 0x00
1379   726F 03                                                      db 0x03
1380   7270 FF                                                      db 0xFF
1381   7271 00          BYTE_ram_72f8:                               db 0x00
1382   7272 03                                                      db 0x03
1383   7273 01                                                      db 0x01
1384   7274 18                                                      db 0x18
1385   7275 FF                                                      db 0xFF
1386   7276 00          BYTE_ram_72fd:                               db 0x00
1387   7277 04                                                      db 0x04
1388   7278 FF                                                      db 0xFF
1389   7279 00          BYTE_ram_7300:                               db 0x00
1390   727A 06                                                      db 0x06
1391   727B FF                                                      db 0xFF
1392   727C 00          BYTE_ram_7303:                               db 0x00
1393   727D 04                                                      db 0x04
1394   727E 01                                                      db 0x01
1395   727F 0B                                                      db 0x0B
1396   7280 FF                                                      db 0xFF
1397   7281 00          BYTE_ram_7308:                               db 0x00
1398   7282 06                                                      db 0x06
1399   7283 01                                                      db 0x01
1400   7284 0B                                                      db 0x0B
1401   7285 FF                                                      db 0xFF
1402   7286 00          BYTE_ram_730d:                               db 0x00
1403   7287 0B                                                      db 0x0B
1404   7288 FF                                                      db 0xFF
1405   7289 00          BYTE_ram_7310:                               db 0x00
1406   728A 0B                                                      db 0x0B
1407   728B 08                                                      db 0x08
1408   728C 0E                                                      db 0x0E
1409   728D FF                                                      db 0xFF
1410   728E 01          BYTE_ram_7315:                               db 0x01
1411   728F 10                                                      db 0x10
1412   7290 01                                                      db 0x01
1413   7291 09                                                      db 0x09
1414   7292 04                                                      db 0x04
1415   7293 09                                                      db 0x09
1416   7294 FF                                                      db 0xFF
1417   7295 01          BYTE_ram_731c:                               db 0x01
1418   7296 10                                                      db 0x10
1419   7297 01                                                      db 0x01
1420   7298 09                                                      db 0x09
1421   7299 FF                                                      db 0xFF
1422   729A 01          BYTE_ram_7321:                               db 0x01
1423   729B 10                                                      db 0x10
1424   729C FF                                                      db 0xFF
1425   729D 01          BYTE_ram_7324:                               db 0x01
1426   729E 11                                                      db 0x11
1427   729F FF                                                      db 0xFF
1428   72A0 01          BYTE_ram_7327:                               db 0x01
1429   72A1 07                                                      db 0x07
1430   72A2 03                                                      db 0x03
1431   72A3 10                                                      db 0x10
1432   72A4 FF                                                      db 0xFF
1433   72A5 01          BYTE_ram_732c:                               db 0x01
1434   72A6 10                                                      db 0x10
1435   72A7 FF                                                      db 0xFF
1436   72A8 01          BYTE_ram_732f:                               db 0x01
1437   72A9 10                                                      db 0x10
1438   72AA 01                                                      db 0x01
1439   72AB 03                                                      db 0x03
1440   72AC FF                                                      db 0xFF
1441   72AD 01          BYTE_ram_7334:                               db 0x01
1442   72AE 11                                                      db 0x11
1443   72AF 01                                                      db 0x01
1444   72B0 03                                                      db 0x03
1445   72B1 08                                                      db 0x08
1446   72B2 11                                                      db 0x11
1447   72B3 FF                                                      db 0xFF
1448   72B4 01          BYTE_ram_733b:                               db 0x01
1449   72B5 11                                                      db 0x11
1450   72B6 01                                                      db 0x01
1451   72B7 03                                                      db 0x03
1452   72B8 FF                                                      db 0xFF
1453   72B9 00          BYTE_ram_7340:                               db 0x00
1454   72BA 0E                                                      db 0x0E
1455   72BB FF                                                      db 0xFF
1456   72BC 00          BYTE_ram_7343:                               db 0x00
1457   72BD 0F                                                      db 0x0F
1458   72BE FF                                                      db 0xFF
1459   72BF 00          BYTE_ram_7346:                               db 0x00
1460   72C0 0F                                                      db 0x0F
1461   72C1 07                                                      db 0x07
1462   72C2 07                                                      db 0x07
1463   72C3 01                                                      db 0x01
1464   72C4 03                                                      db 0x03
1465   72C5 FF                                                      db 0xFF
1466   72C6 05          BYTE_ram_734d:                               db 0x05
1467   72C7 07                                                      db 0x07
1468   72C8 07                                                      db 0x07
1469   72C9 08                                                      db 0x08
1470   72CA 00                                                      db 0x00
1471   72CB 0F                                                      db 0x0F
1472   72CC 01                                                      db 0x01
1473   72CD 03                                                      db 0x03
1474   72CE FF                                                      db 0xFF
1475   72CF 05          BYTE_ram_7356:                               db 0x05
1476   72D0 08                                                      db 0x08
1477   72D1 00                                                      db 0x00
1478   72D2 0F                                                      db 0x0F
1479   72D3 01                                                      db 0x01
1480   72D4 03                                                      db 0x03
1481   72D5 FF                                                      db 0xFF
1482   72D6 00          BYTE_ram_735d:                               db 0x00
1483   72D7 0F                                                      db 0x0F
1484   72D8 08                                                      db 0x08
1485   72D9 07                                                      db 0x07
1486   72DA 05                                                      db 0x05
1487   72DB 08                                                      db 0x08
1488   72DC FF                                                      db 0xFF
1489   72DD 00          BYTE_ram_7364:                               db 0x00
1490   72DE 0F                                                      db 0x0F
1491   72DF FF                                                      db 0xFF
1492   72E0 00          BYTE_ram_7367:                               db 0x00
1493   72E1 10                                                      db 0x10
1494   72E2 FF                                                      db 0xFF
1495   72E3 00          BYTE_ram_736a:                               db 0x00
1496   72E4 10                                                      db 0x10
1497   72E5 01                                                      db 0x01
1498   72E6 02                                                      db 0x02
1499   72E7 FF                                                      db 0xFF
1500   72E8 00          BYTE_ram_736f:                               db 0x00
1501   72E9 10                                                      db 0x10
1502   72EA 01                                                      db 0x01
1503   72EB 03                                                      db 0x03
1504   72EC FF                                                      db 0xFF
1505   72ED 00          BYTE_ram_7374:                               db 0x00
1506   72EE 13                                                      db 0x13
1507   72EF FF                                                      db 0xFF
1508   72F0 02          ACTION_GET_BOOT:                             db 0x02 ; cmd CMD_CANT_CARRY
1509   72F1 00                                                      db 0x00 ; item 0 - OBJECT_A_PAIR_OF_BOOTS
1510   72F2 0D                                                      db 0x0D ; CMD_OK
1511   72F3 02          BYTE_ram_737a:                               db 0x02
1512   72F4 01                                                      db 0x01
1513   72F5 0D                                                      db 0x0D
1514   72F6 02          BYTE_ram_737d:                               db 0x02
1515   72F7 02                                                      db 0x02
1516   72F8 0D                                                      db 0x0D
1517   72F9 02          BYTE_ram_7380:                               db 0x02
1518   72FA 03                                                      db 0x03
1519   72FB 0D                                                      db 0x0D
1520   72FC 02          BYTE_ram_7383:                               db 0x02
1521   72FD 05                                                      db 0x05
1522   72FE 0D                                                      db 0x0D
1523   72FF 02          BYTE_ram_7386:                               db 0x02
1524   7300 06                                                      db 0x06
1525   7301 0D                                                      db 0x0D
1526   7302 02          BYTE_ram_7389:                               db 0x02
1527   7303 07                                                      db 0x07
1528   7304 0D                                                      db 0x0D
1529   7305 02          BYTE_ram_738c:                               db 0x02
1530   7306 08                                                      db 0x08
1531   7307 0D                                                      db 0x0D
1532   7308 02          BYTE_ram_738f:                               db 0x02
1533   7309 09                                                      db 0x09
1534   730A 0D                                                      db 0x0D
1535   730B 02          BYTE_ram_7392:                               db 0x02
1536   730C 0A                                                      db 0x0A
1537   730D 0D                                                      db 0x0D
1538   730E 02          BYTE_ram_7395:                               db 0x02
1539   730F 0B                                                      db 0x0B
1540   7310 0D                                                      db 0x0D
1541   7311 02          BYTE_ram_7398:                               db 0x02
1542   7312 0C                                                      db 0x0C
1543   7313 0D                                                      db 0x0D
1544   7314 02          BYTE_ram_739b:                               db 0x02
1545   7315 0D                                                      db 0x0D
1546   7316 0D                                                      db 0x0D
1547   7317 02          BYTE_ram_739e:                               db 0x02
1548   7318 0E                                                      db 0x0E
1549   7319 0F                                                      db 0x0F
1550   731A 02                                                      db 0x02
1551   731B 09                                                      db 0x09
1552   731C 0D                                                      db 0x0D
1553   731D 02          BYTE_ram_73a4:                               db 0x02
1554   731E 18                                                      db 0x18
1555   731F 0D                                                      db 0x0D
1556   7320 02          BYTE_ram_73a7:                               db 0x02
1557   7321 19                                                      db 0x19
1558   7322 0D                                                      db 0x0D
1559   7323 00          BYTE_ram_73aa:                               db 0x00
1560   7324 07                                                      db 0x07
1561   7325 0E          BYTE_ram_73ac:                               db 0x0E
1562   7326 03          BYTE_ram_73ad:                               db 0x03
1563   7327 00                                                      db 0x00
1564   7328 0D                                                      db 0x0D
1565   7329 03          BYTE_ram_73b0:                               db 0x03
1566   732A 01                                                      db 0x01
1567   732B 0D                                                      db 0x0D
1568   732C 03          BYTE_ram_73b3:                               db 0x03
1569   732D 02                                                      db 0x02
1570   732E 0D                                                      db 0x0D
1571   732F 03          BYTE_ram_73b6:                               db 0x03
1572   7330 03                                                      db 0x03
1573   7331 0D                                                      db 0x0D
1574   7332 03          BYTE_ram_73b9:                               db 0x03
1575   7333 05                                                      db 0x05
1576   7334 0D                                                      db 0x0D
1577   7335 03          BYTE_ram_73bc:                               db 0x03
1578   7336 06                                                      db 0x06
1579   7337 0D                                                      db 0x0D
1580   7338 03          BYTE_ram_73bf:                               db 0x03
1581   7339 07                                                      db 0x07
1582   733A 0D                                                      db 0x0D
1583   733B 03          BYTE_ram_73c2:                               db 0x03
1584   733C 08                                                      db 0x08
1585   733D 0D                                                      db 0x0D
1586   733E 03          BYTE_ram_73c5:                               db 0x03
1587   733F 09                                                      db 0x09
1588   7340 0D                                                      db 0x0D
1589   7341 03          BYTE_ram_73c8:                               db 0x03
1590   7342 0A                                                      db 0x0A
1591   7343 0D                                                      db 0x0D
1592   7344 03          BYTE_ram_73cb:                               db 0x03
1593   7345 0B                                                      db 0x0B
1594   7346 0D                                                      db 0x0D
1595   7347 03          BYTE_ram_73ce:                               db 0x03
1596   7348 0C                                                      db 0x0C
1597   7349 0D                                                      db 0x0D
1598   734A 03          BYTE_ram_73d1:                               db 0x03
1599   734B 0D                                                      db 0x0D
1600   734C 0D                                                      db 0x0D
1601   734D 03          BYTE_ram_73d4:                               db 0x03
1602   734E 0E                                                      db 0x0E
1603   734F 0D                                                      db 0x0D
1604   7350 03          BYTE_ram_73d7:                               db 0x03
1605   7351 18                                                      db 0x18
1606   7352 0D                                                      db 0x0D
1607   7353 03          BYTE_ram_73da:                               db 0x03
1608   7354 19                                                      db 0x19
1609   7355 0D                                                      db 0x0D
1610   7356 05          BYTE_ram_73dd:                               db 0x05
1611   7357 00                                                      db 0x00
1612   7358 07                                                      db 0x07
1613   7359 05          BYTE_ram_73e0:                               db 0x05
1614   735A 01                                                      db 0x01
1615   735B 07                                                      db 0x07
1616   735C 10          BYTE_ram_73e3:                               db 0x10
1617   735D 0D                                                      db 0x0D
1618   735E 05                                                      db 0x05
1619   735F 02                                                      db 0x02
1620   7360 07                                                      db 0x07
1621   7361 05          BYTE_ram_73e8:                               db 0x05
1622   7362 03                                                      db 0x03
1623   7363 07                                                      db 0x07
1624   7364 10          BYTE_ram_73eb:                               db 0x10
1625   7365 0A                                                      db 0x0A
1626   7366 05                                                      db 0x05
1627   7367 02                                                      db 0x02
1628   7368 07                                                      db 0x07
1629   7369 04          BYTE_ram_73f0:                               db 0x04
1630   736A 00                                                      db 0x00
1631   736B 0D                                                      db 0x0D
1632   736C 01          BYTE_ram_73f3:                               db 0x01
1633   736D 00                                                      db 0x00
1634   736E 0D                                                      db 0x0D
1635   736F 05          BYTE_ram_73f6:                               db 0x05
1636   7370 03                                                      db 0x03
1637   7371 07                                                      db 0x07
1638   7372 08          BYTE_ram_73f9:                               db 0x08
1639   7373 06                                                      db 0x06
1640   7374 06                                                      db 0x06
1641   7375 08          BYTE_ram_73fc:                               db 0x08
1642   7376 04                                                      db 0x04
1643   7377 11                                                      db 0x11
1644   7378 0B                                                      db 0x0B
1645   7379 10                                                      db 0x10
1646   737A 0C                                                      db 0x0C
1647   737B 06                                                      db 0x06
1648   737C 05          BYTE_ram_7403:                               db 0x05
1649   737D 04                                                      db 0x04
1650   737E 0C                                                      db 0x0C
1651   737F 08          BYTE_ram_7406:                               db 0x08
1652   7380 0C                                                      db 0x0C
1653   7381 03                                                      db 0x03
1654   7382 0E                                                      db 0x0E
1655   7383 0B                                                      db 0x0B
1656   7384 0E                                                      db 0x0E
1657   7385 0F                                                      db 0x0F
1658   7386 02                                                      db 0x02
1659   7387 07                                                      db 0x07
1660   7388 06                                                      db 0x06
1661   7389 02          BYTE_ram_7410:                               db 0x02
1662   738A 10                                                      db 0x10
1663   738B 0B                                                      db 0x0B
1664   738C 10                                                      db 0x10
1665   738D 05                                                      db 0x05
1666   738E 05                                                      db 0x05
1667   738F 0F                                                      db 0x0F
1668   7390 05                                                      db 0x05
1669   7391 0A                                                      db 0x0A
1670   7392 0A                                                      db 0x0A
1671   7393 06                                                      db 0x06
1672   7394 07                                                      db 0x07
1673   7395 02          BYTE_ram_741c:                               db 0x02
1674   7396 10                                                      db 0x10
1675   7397 0B                                                      db 0x0B
1676   7398 10                                                      db 0x10
1677   7399 0D                                                      db 0x0D
1678   739A 03          BYTE_ram_7421:                               db 0x03
1679   739B 11                                                      db 0x11
1680   739C 0D                                                      db 0x0D
1681   739D 02          BYTE_ram_7424:                               db 0x02
1682   739E 07                                                      db 0x07
1683   739F 0D                                                      db 0x0D
1684   73A0 02          BYTE_ram_7427:                               db 0x02
1685   73A1 08                                                      db 0x08
1686   73A2 0D                                                      db 0x0D
1687   73A3 03          BYTE_ram_742a:                               db 0x03
1688   73A4 07                                                      db 0x07
1689   73A5 0D                                                      db 0x0D
1690   73A6 03          BYTE_ram_742d:                               db 0x03
1691   73A7 08                                                      db 0x08
1692   73A8 0D                                                      db 0x0D
1693   73A9 05          BYTE_ram_7430:                               db 0x05
1694   73AA 03                                                      db 0x03
1695   73AB 07                                                      db 0x07
1696   73AC 11          BYTE_ram_7433:                               db 0x11
1697   73AD 10                                                      db 0x10
1698   73AE 0B                                                      db 0x0B
1699   73AF 07                                                      db 0x07
1700   73B0 05                                                      db 0x05
1701   73B1 06                                                      db 0x06
1702   73B2 05                                                      db 0x05
1703   73B3 07                                                      db 0x07
1704   73B4 07                                                      db 0x07
1705   73B5 05          BYTE_ram_743c:                               db 0x05
1706   73B6 26                                                      db 0x26
1707   73B7 07                                                      db 0x07
1708   73B8 11          BYTE_ram_743f:                               db 0x11
1709   73B9 11                                                      db 0x11
1710   73BA 05                                                      db 0x05
1711   73BB 06                                                      db 0x06
1712   73BC 07                                                      db 0x07
1713   73BD 05          BYTE_ram_7444:                               db 0x05
1714   73BE 08                                                      db 0x08
1715   73BF 07                                                      db 0x07
1716   73C0 09          BYTE_ram_7447:                               db 0x09
1717   73C1 07                                                      db 0x07
1718   73C2 05                                                      db 0x05
1719   73C3 09                                                      db 0x09
1720   73C4 07                                                      db 0x07
1721   73C5 09          BYTE_ram_744c:                               db 0x09
1722   73C6 08                                                      db 0x08
1723   73C7 05                                                      db 0x05
1724   73C8 09                                                      db 0x09
1725   73C9 07                                                      db 0x07
1726   73CA 05          BYTE_ram_7451:                               db 0x05
1727   73CB 0A                                                      db 0x0A
1728   73CC 07                                                      db 0x07
1729   73CD 08          BYTE_ram_7454:                               db 0x08
1730   73CE 10                                                      db 0x10
1731   73CF 0F                                                      db 0x0F
1732   73D0 02                                                      db 0x02
1733   73D1 09                                                      db 0x09
1734   73D2 06                                                      db 0x06
1735   73D3 05          BYTE_ram_745a:                               db 0x05
1736   73D4 0B                                                      db 0x0B
1737   73D5 08                                                      db 0x08
1738   73D6 13                                                      db 0x13
1739   73D7 06                                                      db 0x06
1740   73D8 08          BYTE_ram_745f:                               db 0x08
1741   73D9 12                                                      db 0x12
1742   73DA 06                                                      db 0x06
1743   73DB 11          BYTE_ram_7462:                               db 0x11
1744   73DC 17                                                      db 0x17
1745   73DD 0D                                                      db 0x0D
1746   73DE 05          BYTE_ram_7465:                               db 0x05
1747   73DF 0C                                                      db 0x0C
1748   73E0 07                                                      db 0x07
1749   73E1 0B          BYTE_ram_7468:                               db 0x0B
1750   73E2 14                                                      db 0x14
1751   73E3 10                                                      db 0x10
1752   73E4 05                                                      db 0x05
1753   73E5 06                                                      db 0x06
1754   73E6 0D          ACTION_TABLE:                                db COMMAND_GET
1755   73E7 10                                                      db ITEM_BOOT
1756   73E8 31 72                                                   dw VALID_GET_BOOT 
1757   73EA F0 72                                                   dw ACTION_GET_BOOT 
1758   73EC 0D                                                      db COMMAND_GET
1759   73ED 11                                                      db 0x11
1760   73EE 34 72                                                   dw BYTE_ram_72bb 
1761   73F0 F3 72                                                   dw BYTE_ram_737a 
1762   73F2 0D                                                      db COMMAND_GET
1763   73F3 12                                                      db 0x12
1764   73F4 37 72                                                   dw BYTE_ram_72be 
1765   73F6 F6 72                                                   dw BYTE_ram_737d 
1766   73F8 0D                                                      db COMMAND_GET
1767   73F9 13                                                      db 0x13
1768   73FA 3A 72                                                   dw BYTE_ram_72c1 
1769   73FC F9 72                                                   dw BYTE_ram_7380 
1770   73FE 0D                                                      db COMMAND_GET
1771   73FF 15                                                      db 0x15
1772   7400 3D 72                                                   dw BYTE_ram_72c4 
1773   7402 FC 72                                                   dw BYTE_ram_7383 
1774   7404 0D                                                      db COMMAND_GET
1775   7405 16                                                      db 0x16
1776   7406 40 72                                                   dw BYTE_ram_72c7 
1777   7408 FF 72                                                   dw BYTE_ram_7386 
1778   740A 0D                                                      db COMMAND_GET
1779   740B 17                                                      db 0x17
1780   740C 43 72                                                   dw BYTE_ram_72ca 
1781   740E 02 73                                                   dw BYTE_ram_7389 
1782   7410 0D                                                      db COMMAND_GET
1783   7411 17                                                      db 0x17
1784   7412 48 72                                                   dw BYTE_ram_72cf 
1785   7414 05 73                                                   dw BYTE_ram_738c 
1786   7416 0D                                                      db COMMAND_GET
1787   7417 18                                                      db 0x18
1788   7418 48 72                                                   dw BYTE_ram_72cf 
1789   741A 05 73                                                   dw BYTE_ram_738c 
1790   741C 0D                                                      db COMMAND_GET
1791   741D 19                                                      db 0x19
1792   741E 4B 72                                                   dw BYTE_ram_72d2 
1793   7420 08 73                                                   dw BYTE_ram_738f 
1794   7422 0D                                                      db COMMAND_GET
1795   7423 1A                                                      db 0x1A
1796   7424 4E 72                                                   dw BYTE_ram_72d5 
1797   7426 0B 73                                                   dw BYTE_ram_7392 
1798   7428 0D                                                      db COMMAND_GET
1799   7429 1B                                                      db 0x1B
1800   742A 51 72                                                   dw BYTE_ram_72d8 
1801   742C 0E 73                                                   dw BYTE_ram_7395 
1802   742E 0D                                                      db COMMAND_GET
1803   742F 1B                                                      db 0x1B
1804   7430 54 72                                                   dw BYTE_ram_72db 
1805   7432 11 73                                                   dw BYTE_ram_7398 
1806   7434 0D                                                      db COMMAND_GET
1807   7435 18                                                      db 0x18
1808   7436 54 72                                                   dw BYTE_ram_72db 
1809   7438 11 73                                                   dw BYTE_ram_7398 
1810   743A 0D                                                      db COMMAND_GET
1811   743B 1C                                                      db 0x1C
1812   743C 57 72                                                   dw BYTE_ram_72de 
1813   743E 14 73                                                   dw BYTE_ram_739b 
1814   7440 0D                                                      db COMMAND_GET
1815   7441 1D                                                      db 0x1D
1816   7442 5A 72                                                   dw BYTE_ram_72e1 
1817   7444 17 73                                                   dw BYTE_ram_739e 
1818   7446 0D                                                      db COMMAND_GET
1819   7447 25                                                      db 0x25
1820   7448 5D 72                                                   dw BYTE_ram_72e4 
1821   744A 1D 73                                                   dw BYTE_ram_73a4 
1822   744C 0D                                                      db COMMAND_GET
1823   744D 26                                                      db 0x26
1824   744E 60 72                                                   dw BYTE_ram_72e7 
1825   7450 20 73                                                   dw BYTE_ram_73a7 
1826   7452 29                                                      db 0x29
1827   7453 FF                                                      db 0xFF
1828   7454 30 72                                                   dw BYTE_ram_72b7 
1829   7456 23 73                                                   dw BYTE_ram_73aa
1830   7458 2A                                                      db 0x2A
1831   7459 FF                                                      db 0xFF
1832   745A 30 72                                                   dw BYTE_ram_72b7 
1833   745C 25 73                                                   dw BYTE_ram_73ac 
1834   745E 0E                                                      db 0x0E
1835   745F 10                                                      db ITEM_BOOT
1836   7460 31 72                                                   dw VALID_GET_BOOT 
1837   7462 26 73                                                   dw BYTE_ram_73ad 
1838   7464 0E                                                      db 0x0E
1839   7465 11                                                      db 0x11
1840   7466 34 72                                                   dw BYTE_ram_72bb 
1841   7468 29 73                                                   dw BYTE_ram_73b0 
1842   746A 0E                                                      db 0x0E
1843   746B 12                                                      db 0x12
1844   746C 37 72                                                   dw BYTE_ram_72be 
1845   746E 2C 73                                                   dw BYTE_ram_73b3 
1846   7470 0E                                                      db 0x0E
1847   7471 13                                                      db 0x13
1848   7472 3A 72                                                   dw BYTE_ram_72c1 
1849   7474 2F 73                                                   dw BYTE_ram_73b6 
1850   7476 0E                                                      db 0x0E
1851   7477 15                                                      db 0x15
1852   7478 3D 72                                                   dw BYTE_ram_72c4 
1853   747A 32 73                                                   dw BYTE_ram_73b9 
1854   747C 0E                                                      db 0x0E
1855   747D 16                                                      db 0x16
1856   747E 40 72                                                   dw BYTE_ram_72c7 
1857   7480 35 73                                                   dw BYTE_ram_73bc 
1858   7482 0E                                                      db 0x0E
1859   7483 17                                                      db 0x17
1860   7484 63 72                                                   dw BYTE_ram_72ea 
1861   7486 38 73                                                   dw BYTE_ram_73bf 
1862   7488 0E                                                      db 0x0E
1863   7489 17                                                      db 0x17
1864   748A 48 72                                                   dw BYTE_ram_72cf 
1865   748C 3B 73                                                   dw BYTE_ram_73c2 
1866   748E 0E                                                      db 0x0E
1867   748F 18                                                      db 0x18
1868   7490 48 72                                                   dw BYTE_ram_72cf 
1869   7492 3B 73                                                   dw BYTE_ram_73c2 
1870   7494 0E                                                      db 0x0E
1871   7495 19                                                      db 0x19
1872   7496 4B 72                                                   dw BYTE_ram_72d2 
1873   7498 3E 73                                                   dw BYTE_ram_73c5 
1874   749A 0E                                                      db 0x0E
1875   749B 1A                                                      db 0x1A
1876   749C 4E 72                                                   dw BYTE_ram_72d5 
1877   749E 41 73                                                   dw BYTE_ram_73c8 
1878   74A0 0E                                                      db 0x0E
1879   74A1 1B                                                      db 0x1B
1880   74A2 51 72                                                   dw BYTE_ram_72d8 
1881   74A4 44 73                                                   dw BYTE_ram_73cb 
1882   74A6 0E                                                      db 0x0E
1883   74A7 1B                                                      db 0x1B
1884   74A8 54 72                                                   dw BYTE_ram_72db 
1885   74AA 47 73                                                   dw BYTE_ram_73ce 
1886   74AC 0F                                                      db 0x0F
1887   74AD 18                                                      db 0x18
1888   74AE 54 72                                                   dw BYTE_ram_72db 
1889   74B0 47 73                                                   dw BYTE_ram_73ce 
1890   74B2 0E                                                      db 0x0E
1891   74B3 1C                                                      db 0x1C
1892   74B4 57 72                                                   dw BYTE_ram_72de 
1893   74B6 4A 73                                                   dw BYTE_ram_73d1 
1894   74B8 0E                                                      db 0x0E
1895   74B9 1D                                                      db 0x1D
1896   74BA 5A 72                                                   dw BYTE_ram_72e1 
1897   74BC 4D 73                                                   dw BYTE_ram_73d4 
1898   74BE 0E                                                      db 0x0E
1899   74BF 25                                                      db 0x25
1900   74C0 5D 72                                                   dw BYTE_ram_72e4 
1901   74C2 50 73                                                   dw BYTE_ram_73d7 
1902   74C4 0E                                                      db 0x0E
1903   74C5 26                                                      db 0x26
1904   74C6 60 72                                                   dw BYTE_ram_72e7 
1905   74C8 53 73                                                   dw BYTE_ram_73da 
1906   74CA 3D                                                      db 0x3D
1907   74CB 27                                                      db 0x27
1908   74CC 66 72                                                   dw BYTE_ram_72ed
1909   74CE 56 73                                                   dw BYTE_ram_73dd 
1910   74D0 34                                                      db 0x34
1911   74D1 1C                                                      db 0x1C
1912   74D2 66 72                                                   dw BYTE_ram_72ed
1913   74D4 59 73                                                   dw BYTE_ram_73e0 
1914   74D6 36                                                      db 0x36
1915   74D7 1D                                                      db 0x1D
1916   74D8 69 72                                                   dw BYTE_ram_72f0
1917   74DA 5C 73                                                   dw BYTE_ram_73e3 
1918   74DC 40                                                      db 0x40
1919   74DD 1A                                                      db 0x1A
1920   74DE 6E 72                                                   dw BYTE_ram_72f5
1921   74E0 61 73                                                   dw BYTE_ram_73e8 
1922   74E2 36                                                      db 0x36
1923   74E3 25                                                      db 0x25
1924   74E4 71 72                                                   dw BYTE_ram_72f8
1925   74E6 64 73                                                   dw BYTE_ram_73eb 
1926   74E8 41                                                      db 0x41
1927   74E9 10                                                      db ITEM_BOOT
1928   74EA 30 72                                                   dw BYTE_ram_72b7 
1929   74EC 69 73                                                   dw BYTE_ram_73f0 
1930   74EE 33                                                      db 0x33
1931   74EF 10                                                      db ITEM_BOOT
1932   74F0 30 72                                                   dw BYTE_ram_72b7 
1933   74F2 6C 73                                                   dw BYTE_ram_73f3 
1934   74F4 42                                                      db 0x42
1935   74F5 44                                                      db 0x44
1936   74F6 76 72                                                   dw BYTE_ram_72fd
1937   74F8 6F 73                                                   dw BYTE_ram_73f6 
1938   74FA 42                                                      db 0x42
1939   74FB 44                                                      db 0x44
1940   74FC 79 72                                                   dw BYTE_ram_7300
1941   74FE 6F 73                                                   dw BYTE_ram_73f6 
1942   7500 36                                                      db 0x36
1943   7501 1B                                                      db 0x1B
1944   7502 7C 72                                                   dw BYTE_ram_7303
1945   7504 72 73                                                   dw BYTE_ram_73f9 
1946   7506 36                                                      db 0x36
1947   7507 1B                                                      db 0x1B
1948   7508 81 72                                                   dw BYTE_ram_7308
1949   750A 75 73                                                   dw BYTE_ram_73fc 
1950   750C 43                                                      db 0x43
1951   750D 44                                                      db 0x44
1952   750E 7C 72                                                   dw BYTE_ram_7303
1953   7510 7C 73                                                   dw BYTE_ram_7403 
1954   7512 43                                                      db 0x43
1955   7513 44                                                      db 0x44
1956   7514 79 72                                                   dw BYTE_ram_7300
1957   7516 7C 73                                                   dw BYTE_ram_7403 
1958   7518 01                                                      db 0x01
1959   7519 FF                                                      db 0xFF
1960   751A 86 72                                                   dw BYTE_ram_730d
1961   751C 6F 73                                                   dw BYTE_ram_73f6 
1962   751E 36                                                      db 0x36
1963   751F 1D                                                      db 0x1D
1964   7520 89 72                                                   dw BYTE_ram_7310
1965   7522 7F 73                                                   dw BYTE_ram_7406 
1966   7524 0D                                                      db COMMAND_GET
1967   7525 1F                                                      db 0x1F
1968   7526 8E 72                                                   dw BYTE_ram_7315 
1969   7528 89 73                                                   dw BYTE_ram_7410 
1970   752A 0D                                                      db COMMAND_GET
1971   752B 1F                                                      db 0x1F
1972   752C 95 72                                                   dw BYTE_ram_731c 
1973   752E 95 73                                                   dw BYTE_ram_741c 
1974   7530 0D                                                      db COMMAND_GET
1975   7531 1F                                                      db 0x1F
1976   7532 9A 72                                                   dw BYTE_ram_7321 
1977   7534 89 73                                                   dw BYTE_ram_7410 
1978   7536 0E                                                      db 0x0E
1979   7537 1F                                                      db 0x1F
1980   7538 9D 72                                                   dw BYTE_ram_7324 
1981   753A 9A 73                                                   dw BYTE_ram_7421 
1982   753C 0D                                                      db COMMAND_GET
1983   753D 17                                                      db 0x17
1984   753E A0 72                                                   dw BYTE_ram_7327 
1985   7540 9D 73                                                   dw BYTE_ram_7424 
1986   7542 0D                                                      db COMMAND_GET
1987   7543 18                                                      db 0x18
1988   7544 48 72                                                   dw BYTE_ram_72cf 
1989   7546 A0 73                                                   dw BYTE_ram_7427 
1990   7548 0E                                                      db 0x0E
1991   7549 17                                                      db 0x17
1992   754A 63 72                                                   dw BYTE_ram_72ea 
1993   754C A3 73                                                   dw BYTE_ram_742a 
1994   754E 0E                                                      db 0x0E
1995   754F 18                                                      db 0x18
1996   7550 48 72                                                   dw BYTE_ram_72cf 
1997   7552 A6 73                                                   dw BYTE_ram_742d 
1998   7554 31                                                      db 0x31
1999   7555 1F                                                      db 0x1F
2000   7556 A5 72                                                   dw BYTE_ram_732c 
2001   7558 A9 73                                                   dw BYTE_ram_7430 
2002   755A 31                                                      db 0x31
2003   755B 1F                                                      db 0x1F
2004   755C 9D 72                                                   dw BYTE_ram_7324 
2005   755E A9 73                                                   dw BYTE_ram_7430 
2006   7560 36                                                      db 0x36
2007   7561 13                                                      db 0x13
2008   7562 A8 72                                                   dw BYTE_ram_732f 
2009   7564 AC 73                                                   dw BYTE_ram_7433 
2010   7566 36                                                      db 0x36
2011   7567 13                                                      db 0x13
2012   7568 AD 72                                                   dw BYTE_ram_7334 
2013   756A B5 73                                                   dw BYTE_ram_743c 
2014   756C 36                                                      db 0x36
2015   756D 13                                                      db 0x13
2016   756E B4 72                                                   dw BYTE_ram_733b 
2017   7570 B8 73                                                   dw BYTE_ram_743f 
2018   7572 2E                                                      db 0x2E
2019   7573 28                                                      db 0x28
2020   7574 B9 72                                                   dw BYTE_ram_7340
2021   7576 BD 73                                                   dw BYTE_ram_7444 
2022   7578 0F                                                      db 0x0F
2023   7579 13                                                      db 0x13
2024   757A BC 72                                                   dw BYTE_ram_7343
2025   757C B5 73                                                   dw BYTE_ram_743c 
2026   757E 4A                                                      db 0x4A
2027   757F FF                                                      db 0xFF
2028   7580 BF 72                                                   dw BYTE_ram_7346
2029   7582 C0 73                                                   dw BYTE_ram_7447 
2030   7584 4A                                                      db 0x4A
2031   7585 FF                                                      db 0xFF
2032   7586 C6 72                                                   dw BYTE_ram_734d 
2033   7588 C5 73                                                   dw BYTE_ram_744c 
2034   758A 4A                                                      db 0x4A
2035   758B FF                                                      db 0xFF
2036   758C CF 72                                                   dw BYTE_ram_7356 
2037   758E CA 73                                                   dw BYTE_ram_7451 
2038   7590 32                                                      db 0x32
2039   7591 FF                                                      db 0xFF
2040   7592 D6 72                                                   dw BYTE_ram_735d
2041   7594 CD 73                                                   dw BYTE_ram_7454 
2042   7596 32                                                      db 0x32
2043   7597 FF                                                      db 0xFF
2044   7598 DD 72                                                   dw BYTE_ram_7364
2045   759A D3 73                                                   dw BYTE_ram_745a 
2046   759C 21                                                      db 0x21
2047   759D 20                                                      db 0x20
2048   759E E0 72                                                   dw BYTE_ram_7367
2049   75A0 A9 73                                                   dw BYTE_ram_7430 
2050   75A2 36                                                      db 0x36
2051   75A3 12                                                      db 0x12
2052   75A4 E3 72                                                   dw BYTE_ram_736a
2053   75A6 D8 73                                                   dw BYTE_ram_745f 
2054   75A8 31                                                      db 0x31
2055   75A9 24                                                      db 0x24
2056   75AA E8 72                                                   dw BYTE_ram_736f
2057   75AC DB 73                                                   dw BYTE_ram_7462 
2058   75AE 3D                                                      db 0x3D
2059   75AF 45                                                      db 0x45
2060   75B0 ED 72                                                   dw BYTE_ram_7374
2061   75B2 DE 73                                                   dw BYTE_ram_7465 
2062   75B4 34                                                      db 0x34
2063   75B5 15                                                      db 0x15
2064   75B6 ED 72                                                   dw BYTE_ram_7374
2065   75B8 E1 73                                                   dw BYTE_ram_7468 
2066   75BA 45                                                      db 0x45
2067   75BB FF                                                      db 0xFF
2068   75BC D5 76                                                   dw BYTE_ram_775c
2069   75BE 78 77                                                   dw BYTE_ram_77ff 
2070   75C0 35                                                      db 0x35
2071   75C1 24                                                      db 0x24
2072   75C2 DA 76                                                   dw BYTE_ram_7761
2073   75C4 7D 77                                                   dw BYTE_ram_7804 
2074   75C6 36                                                      db 0x36
2075   75C7 16                                                      db 0x16
2076   75C8 DD 76                                                   dw BYTE_ram_7764
2077   75CA 80 77                                                   dw BYTE_ram_7807 
2078   75CC 20                                                      db 0x20
2079   75CD FF                                                      db 0xFF
2080   75CE E2 76                                                   dw BYTE_ram_7769
2081   75D0 85 77                                                   dw BYTE_ram_780c 
2082   75D2 3D                                                      db 0x3D
2083   75D3 1E                                                      db 0x1E
2084   75D4 E7 76                                                   dw BYTE_ram_776e
2085   75D6 8A 77                                                   dw BYTE_ram_7811 
2086   75D8 0D                                                      db COMMAND_GET
2087   75D9 16                                                      db 0x16
2088   75DA E7 76                                                   dw BYTE_ram_776e
2089   75DC 8D 77                                                   dw BYTE_ram_7814 
2090   75DE 1E                                                      db 0x1E
2091   75DF FF                                                      db 0xFF
2092   75E0 EC 76                                                   dw BYTE_ram_7773
2093   75E2 93 77                                                   dw BYTE_ram_781a 
2094   75E4 1E                                                      db 0x1E
2095   75E5 FF                                                      db 0xFF
2096   75E6 F5 76                                                   dw BYTE_ram_777c
2097   75E8 90 77                                                   dw BYTE_ram_7817 
2098   75EA 1E                                                      db 0x1E
2099   75EB FF                                                      db 0xFF
2100   75EC E7 76                                                   dw BYTE_ram_776e
2101   75EE 98 77                                                   dw BYTE_ram_781f 
2102   75F0 21                                                      db 0x21
2103   75F1 20                                                      db 0x20
2104   75F2 FC 76                                                   dw BYTE_ram_7783
2105   75F4 9B 77                                                   dw BYTE_ram_7822 
2106   75F6 37                                                      db 0x37
2107   75F7 38                                                      db 0x38
2108   75F8 FF 76                                                   dw BYTE_ram_7786
2109   75FA 9E 77                                                   dw BYTE_ram_7825 
2110   75FC 37                                                      db 0x37
2111   75FD 38                                                      db 0x38
2112   75FE 06 77                                                   dw BYTE_ram_778d
2113   7600 A2 77                                                   dw BYTE_ram_7829 
2114   7602 37                                                      db 0x37
2115   7603 39                                                      db 0x39
2116   7604 0B 77                                                   dw BYTE_ram_7792
2117   7606 A9 77                                                   dw BYTE_ram_7830 
2118   7608 37                                                      db 0x37
2119   7609 39                                                      db 0x39
2120   760A 06 77                                                   dw BYTE_ram_778d
2121   760C A2 77                                                   dw BYTE_ram_7829 
2122   760E 37                                                      db 0x37
2123   760F 3A                                                      db 0x3A
2124   7610 13 77                                                   dw BYTE_ram_779a
2125   7612 AD 77                                                   dw BYTE_ram_7834 
2126   7614 37                                                      db 0x37
2127   7615 3A                                                      db 0x3A
2128   7616 06 77                                                   dw BYTE_ram_778d
2129   7618 A2 77                                                   dw BYTE_ram_7829 
2130   761A 3B                                                      db 0x3B
2131   761B 46                                                      db 0x46
2132   761C 1B 77                                                   dw BYTE_ram_77a2
2133   761E B3 77                                                   dw BYTE_ram_783a 
2134   7620 36                                                      db 0x36
2135   7621 15                                                      db 0x15
2136   7622 20 77                                                   dw BYTE_ram_77a7
2137   7624 B6 77                                                   dw BYTE_ram_783d 
2138   7626 3D                                                      db 0x3D
2139   7627 FF                                                      db 0xFF
2140   7628 27 77                                                   dw BYTE_ram_77ae
2141   762A BB 77                                                   dw BYTE_ram_7842 
2142   762C 28                                                      db 0x28
2143   762D FF                                                      db 0xFF
2144   762E 2A 77                                                   dw BYTE_ram_77b1
2145   7630 BE 77                                                   dw BYTE_ram_7845 
2146   7632 28                                                      db 0x28
2147   7633 FF                                                      db 0xFF
2148   7634 2D 77                                                   dw BYTE_ram_77b4
2149   7636 C1 77                                                   dw BYTE_ram_7848 
2150   7638 28                                                      db 0x28
2151   7639 FF                                                      db 0xFF
2152   763A 30 77                                                   dw BYTE_ram_77b7
2153   763C C4 77                                                   dw BYTE_ram_784b 
2154   763E 28                                                      db 0x28
2155   763F FF                                                      db 0xFF
2156   7640 33 77                                                   dw BYTE_ram_77ba
2157   7642 C7 77                                                   dw BYTE_ram_784e 
2158   7644 28                                                      db 0x28
2159   7645 FF                                                      db 0xFF
2160   7646 36 77                                                   dw BYTE_ram_77bd
2161   7648 C7 77                                                   dw BYTE_ram_784e 
2162   764A 28                                                      db 0x28
2163   764B FF                                                      db 0xFF
2164   764C 39 77                                                   dw BYTE_ram_77c0
2165   764E C7 77                                                   dw BYTE_ram_784e 
2166   7650 28                                                      db 0x28
2167   7651 FF                                                      db 0xFF
2168   7652 3C 77                                                   dw BYTE_ram_77c3
2169   7654 C7 77                                                   dw BYTE_ram_784e 
2170   7656 28                                                      db 0x28
2171   7657 FF                                                      db 0xFF
2172   7658 3F 77                                                   dw BYTE_ram_77c6
2173   765A BE 77                                                   dw BYTE_ram_7845 
2174   765C 3D                                                      db 0x3D
2175   765D 45                                                      db 0x45
2176   765E 44 77                                                   dw BYTE_ram_77cb 
2177   7660 CA 77                                                   dw BYTE_ram_7851 
2178   7662 05                                                      db 0x05
2179   7663 FF                                                      db 0xFF
2180   7664 49 77                                                   dw BYTE_ram_77d0
2181   7666 CD 77                                                   dw BYTE_ram_7854 
2182   7668 02                                                      db 0x02
2183   7669 FF                                                      db 0xFF
2184   766A 2D 77                                                   dw BYTE_ram_77b4
2185   766C CD 77                                                   dw BYTE_ram_7854 
2186   766E 41                                                      db 0x41
2187   766F 19                                                      db 0x19
2188   7670 30 72                                                   dw BYTE_ram_72b7 
2189   7672 D3 77                                                   dw BYTE_ram_785a 
2190   7674 33                                                      db 0x33
2191   7675 19                                                      db 0x19
2192   7676 30 72                                                   dw BYTE_ram_72b7 
2193   7678 D6 77                                                   dw BYTE_ram_785d 
2194   767A 47                                                      db 0x47
2195   767B FF                                                      db 0xFF
2196   767C 30 72                                                   dw BYTE_ram_72b7 
2197   767E D9 77                                                   dw BYTE_ram_7860 
2198   7680 01                                                      db 0x01
2199   7681 FF                                                      db 0xFF
2200   7682 4C 77                                                   dw BYTE_ram_77d3
2201   7684 DA 77                                                   dw BYTE_ram_7861 
2202   7686 36                                                      db 0x36
2203   7687 1A                                                      db 0x1A
2204   7688 4F 77                                                   dw BYTE_ram_77d6
2205   768A DD 77                                                   dw BYTE_ram_7864 
2206   768C 43                                                      db 0x43
2207   768D FF                                                      db 0xFF
2208   768E 4C 77                                                   dw BYTE_ram_77d3
2209   7690 E4 77                                                   dw BYTE_ram_786b 
2210   7692 45                                                      db 0x45
2211   7693 1A                                                      db 0x1A
2212   7694 54 77                                                   dw BYTE_ram_77db
2213   7696 E7 77                                                   dw BYTE_ram_786e 
2214   7698 23                                                      db 0x23
2215   7699 FF                                                      db 0xFF
2216   769A 59 77                                                   dw BYTE_ram_77e0 
2217   769C EA 77                                                   dw BYTE_ram_7871 
2218   769E 37                                                      db 0x37
2219   769F 48                                                      db 0x48
2220   76A0 5C 77                                                   dw BYTE_ram_77e3
2221   76A2 ED 77                                                   dw BYTE_ram_7874 
2222   76A4 37                                                      db 0x37
2223   76A5 49                                                      db 0x49
2224   76A6 5C 77                                                   dw BYTE_ram_77e3
2225   76A8 F0 77                                                   dw BYTE_ram_7877 
2226   76AA 37                                                      db 0x37
2227   76AB 38                                                      db 0x38
2228   76AC 61 77                                                   dw BYTE_ram_77e8
2229   76AE F5 77                                                   dw BYTE_ram_787c 
2230   76B0 37                                                      db 0x37
2231   76B1 39                                                      db 0x39
2232   76B2 61 77                                                   dw BYTE_ram_77e8
2233   76B4 F5 77                                                   dw BYTE_ram_787c 
2234   76B6 37                                                      db 0x37
2235   76B7 3C                                                      db 0x3C
2236   76B8 66 77                                                   dw BYTE_ram_77ed
2237   76BA F8 77                                                   dw BYTE_ram_787f 
2238   76BC 37                                                      db 0x37
2239   76BD 3A                                                      db 0x3A
2240   76BE 6E 77                                                   dw BYTE_ram_77f5
2241   76C0 00 78                                                   dw BYTE_ram_7887 
2242   76C2 37                                                      db 0x37
2243   76C3 3A                                                      db 0x3A
2244   76C4 66 77                                                   dw BYTE_ram_77ed
2245   76C6 FB 77                                                   dw BYTE_ram_7882 
2246   76C8 28                                                      db 0x28
2247   76C9 FF                                                      db 0xFF
2248   76CA 30 72                                                   dw BYTE_ram_72b7 
2249   76CC 07 78                                                   dw BYTE_ram_788e 
2250   76CE 3D                                                      db 0x3D
2251   76CF FF                                                      db 0xFF
2252   76D0 30 72                                                   dw BYTE_ram_72b7 
2253   76D2 0A 78                                                   dw BYTE_ram_7891 
2254   76D4 00                                                      db 0x00
2255   76D5 00          BYTE_ram_775c:                               db 0x00
2256   76D6 13                                                      db 0x13
2257   76D7 01                                                      db 0x01
2258   76D8 15                                                      db 0x15
2259   76D9 FF                                                      db 0xFF
2260   76DA 00          BYTE_ram_7761:                               db 0x00
2261   76DB 13                                                      db 0x13
2262   76DC FF                                                      db 0xFF
2263   76DD 00          BYTE_ram_7764:                               db 0x00
2264   76DE 13                                                      db 0x13
2265   76DF 01                                                      db 0x01
2266   76E0 06                                                      db 0x06
2267   76E1 FF                                                      db 0xFF
2268   76E2 00          BYTE_ram_7769:                               db 0x00
2269   76E3 13                                                      db 0x13
2270   76E4 01                                                      db 0x01
2271   76E5 13                                                      db 0x13
2272   76E6 FF                                                      db 0xFF
2273   76E7 00          BYTE_ram_776e:                               db 0x00
2274   76E8 04                                                      db 0x04
2275   76E9 03                                                      db 0x03
2276   76EA 06                                                      db 0x06
2277   76EB FF                                                      db 0xFF
2278   76EC 00          BYTE_ram_7773:                               db 0x00
2279   76ED 04                                                      db 0x04
2280   76EE 03                                                      db 0x03
2281   76EF 06                                                      db 0x06
2282   76F0 04                                                      db 0x04
2283   76F1 00                                                      db 0x00
2284   76F2 01                                                      db 0x01
2285   76F3 00                                                      db 0x00
2286   76F4 FF                                                      db 0xFF
2287   76F5 00          BYTE_ram_777c:                               db 0x00
2288   76F6 04                                                      db 0x04
2289   76F7 03                                                      db 0x03
2290   76F8 06                                                      db 0x06
2291   76F9 01                                                      db 0x01
2292   76FA 00                                                      db 0x00
2293   76FB FF                                                      db 0xFF
2294   76FC 00          BYTE_ram_7783:                               db 0x00
2295   76FD 0D                                                      db 0x0D
2296   76FE FF                                                      db 0xFF
2297   76FF 00          BYTE_ram_7786:                               db 0x00
2298   7700 12                                                      db 0x12
2299   7701 07                                                      db 0x07
2300   7702 09                                                      db 0x09
2301   7703 07                                                      db 0x07
2302   7704 0A                                                      db 0x0A
2303   7705 FF                                                      db 0xFF
2304   7706 00          BYTE_ram_778d:                               db 0x00
2305   7707 12                                                      db 0x12
2306   7708 07                                                      db 0x07
2307   7709 0A                                                      db 0x0A
2308   770A FF                                                      db 0xFF
2309   770B 00          BYTE_ram_7792:                               db 0x00
2310   770C 12                                                      db 0x12
2311   770D 06                                                      db 0x06
2312   770E 09                                                      db 0x09
2313   770F 01                                                      db 0x01
2314   7710 07                                                      db 0x07
2315   7711 0A                                                      db 0x0A
2316   7712 FF                                                      db 0xFF
2317   7713 00          BYTE_ram_779a:                               db 0x00
2318   7714 12                                                      db 0x12
2319   7715 06                                                      db 0x06
2320   7716 09                                                      db 0x09
2321   7717 02                                                      db 0x02
2322   7718 07                                                      db 0x07
2323   7719 0A                                                      db 0x0A
2324   771A FF                                                      db 0xFF
2325   771B 00          BYTE_ram_77a2:                               db 0x00
2326   771C 12                                                      db 0x12
2327   771D 05                                                      db 0x05
2328   771E 0A                                                      db 0x0A
2329   771F FF                                                      db 0xFF
2330   7720 00          BYTE_ram_77a7:                               db 0x00
2331   7721 12                                                      db 0x12
2332   7722 01                                                      db 0x01
2333   7723 05                                                      db 0x05
2334   7724 05                                                      db 0x05
2335   7725 0A                                                      db 0x0A
2336   7726 FF                                                      db 0xFF
2337   7727 00          BYTE_ram_77ae:                               db 0x00
2338   7728 0B                                                      db 0x0B
2339   7729 FF                                                      db 0xFF
2340   772A 00          BYTE_ram_77b1:                               db 0x00
2341   772B 11                                                      db 0x11
2342   772C FF                                                      db 0xFF
2343   772D 00          BYTE_ram_77b4:                               db 0x00
2344   772E 0F                                                      db 0x0F
2345   772F FF                                                      db 0xFF
2346   7730 00          BYTE_ram_77b7:                               db 0x00
2347   7731 0E                                                      db 0x0E
2348   7732 FF                                                      db 0xFF
2349   7733 00          BYTE_ram_77ba:                               db 0x00
2350   7734 07                                                      db 0x07
2351   7735 FF                                                      db 0xFF
2352   7736 00          BYTE_ram_77bd:                               db 0x00
2353   7737 08                                                      db 0x08
2354   7738 FF                                                      db 0xFF
2355   7739 00          BYTE_ram_77c0:                               db 0x00
2356   773A 09                                                      db 0x09
2357   773B FF                                                      db 0xFF
2358   773C 00          BYTE_ram_77c3:                               db 0x00
2359   773D 0A                                                      db 0x0A
2360   773E FF                                                      db 0xFF
2361   773F 00          BYTE_ram_77c6:                               db 0x00
2362   7740 14                                                      db 0x14
2363   7741 05                                                      db 0x05
2364   7742 0C                                                      db 0x0C
2365   7743 FF                                                      db 0xFF
2366   7744 05          BYTE_ram_77cb:                               db 0x05
2367   7745 0B                                                      db 0x0B
2368   7746 00                                                      db 0x00
2369   7747 0C                                                      db 0x0C
2370   7748 FF                                                      db 0xFF
2371   7749 00          BYTE_ram_77d0:                               db 0x00
2372   774A 0D                                                      db 0x0D
2373   774B FF                                                      db 0xFF
2374   774C 00          BYTE_ram_77d3:                               db 0x00
2375   774D 01                                                      db 0x01
2376   774E FF                                                      db 0xFF
2377   774F 00          BYTE_ram_77d6:                               db 0x00
2378   7750 01                                                      db 0x01
2379   7751 08                                                      db 0x08
2380   7752 0A                                                      db 0x0A
2381   7753 FF                                                      db 0xFF
2382   7754 00          BYTE_ram_77db:                               db 0x00
2383   7755 0C                                                      db 0x0C
2384   7756 05                                                      db 0x05
2385   7757 0B                                                      db 0x0B
2386   7758 FF                                                      db 0xFF
2387   7759 01          BYTE_ram_77e0:                               db 0x01
2388   775A 16                                                      db 0x16
2389   775B FF                                                      db 0xFF
2390   775C 00          BYTE_ram_77e3:                               db 0x00
2391   775D 14                                                      db 0x14
2392   775E 01                                                      db 0x01
2393   775F 01                                                      db 0x01
2394   7760 FF                                                      db 0xFF
2395   7761 00          BYTE_ram_77e8:                               db 0x00
2396   7762 14                                                      db 0x14
2397   7763 05                                                      db 0x05
2398   7764 0C                                                      db 0x0C
2399   7765 FF                                                      db 0xFF
2400   7766 00          BYTE_ram_77ed:                               db 0x00
2401   7767 14                                                      db 0x14
2402   7768 05                                                      db 0x05
2403   7769 0C                                                      db 0x0C
2404   776A 06                                                      db 0x06
2405   776B 09                                                      db 0x09
2406   776C 03                                                      db 0x03
2407   776D FF                                                      db 0xFF
2408   776E 00          BYTE_ram_77f5:                               db 0x00
2409   776F 14                                                      db 0x14
2410   7770 05                                                      db 0x05
2411   7771 0C                                                      db 0x0C
2412   7772 04                                                      db 0x04
2413   7773 00                                                      db 0x00
2414   7774 06                                                      db 0x06
2415   7775 09                                                      db 0x09
2416   7776 03                                                      db 0x03
2417   7777 FF                                                      db 0xFF
2418   7778 08          BYTE_ram_77ff:                               db 0x08
2419   7779 0C                                                      db 0x0C
2420   777A 0B                                                      db 0x0B
2421   777B 14                                                      db 0x14
2422   777C 06                                                      db 0x06
2423   777D 05          BYTE_ram_7804:                               db 0x05
2424   777E 0D                                                      db 0x0D
2425   777F 07                                                      db 0x07
2426   7780 0B          BYTE_ram_7807:                               db 0x0B
2427   7781 12                                                      db 0x12
2428   7782 11                                                      db 0x11
2429   7783 06                                                      db 0x06
2430   7784 06                                                      db 0x06
2431   7785 08          BYTE_ram_780c:                               db 0x08
2432   7786 0C                                                      db 0x0C
2433   7787 0B                                                      db 0x0B
2434   7788 12                                                      db 0x12
2435   7789 06                                                      db 0x06
2436   778A 05          BYTE_ram_7811:                               db 0x05
2437   778B 0E                                                      db 0x0E
2438   778C 07                                                      db 0x07
2439   778D 05          BYTE_ram_7814:                               db 0x05
2440   778E 01                                                      db 0x01
2441   778F 07                                                      db 0x07
2442   7790 05          BYTE_ram_7817:                               db 0x05
2443   7791 0F                                                      db 0x0F
2444   7792 07                                                      db 0x07
2445   7793 10          BYTE_ram_781a:                               db 0x10
2446   7794 06                                                      db 0x06
2447   7795 02                                                      db 0x02
2448   7796 06                                                      db 0x06
2449   7797 0D                                                      db 0x0D
2450   7798 05          BYTE_ram_781f:                               db 0x05
2451   7799 0F                                                      db 0x0F
2452   779A 07                                                      db 0x07
2453   779B 08          BYTE_ram_7822:                               db 0x08
2454   779C 0E                                                      db 0x0E
2455   779D 06                                                      db 0x06
2456   779E 0F          BYTE_ram_7825:                               db 0x0F
2457   779F 09                                                      db 0x09
2458   77A0 01                                                      db 0x01
2459   77A1 0D                                                      db 0x0D
2460   77A2 05          BYTE_ram_7829:                               db 0x05
2461   77A3 10                                                      db 0x10
2462   77A4 0A                                                      db 0x0A
2463   77A5 09                                                      db 0x09
2464   77A6 09                                                      db 0x09
2465   77A7 0A                                                      db 0x0A
2466   77A8 07                                                      db 0x07
2467   77A9 0F          BYTE_ram_7830:                               db 0x0F
2468   77AA 09                                                      db 0x09
2469   77AB 02                                                      db 0x02
2470   77AC 0D                                                      db 0x0D
2471   77AD 05          BYTE_ram_7834:                               db 0x05
2472   77AE 11                                                      db 0x11
2473   77AF 0F                                                      db 0x0F
2474   77B0 09                                                      db 0x09
2475   77B1 03                                                      db 0x03
2476   77B2 07                                                      db 0x07
2477   77B3 05          BYTE_ram_783a:                               db 0x05
2478   77B4 0D                                                      db 0x0D
2479   77B5 07                                                      db 0x07
2480   77B6 0A          BYTE_ram_783d:                               db 0x0A
2481   77B7 0A                                                      db 0x0A
2482   77B8 11                                                      db 0x11
2483   77B9 05                                                      db 0x05
2484   77BA 0D                                                      db 0x0D
2485   77BB 05          BYTE_ram_7842:                               db 0x05
2486   77BC 18                                                      db 0x18
2487   77BD 07                                                      db 0x07
2488   77BE 05          BYTE_ram_7845:                               db 0x05
2489   77BF 13                                                      db 0x13
2490   77C0 07                                                      db 0x07
2491   77C1 05          BYTE_ram_7848:                               db 0x05
2492   77C2 14                                                      db 0x14
2493   77C3 07                                                      db 0x07
2494   77C4 05          BYTE_ram_784b:                               db 0x05
2495   77C5 15                                                      db 0x15
2496   77C6 07                                                      db 0x07
2497   77C7 05          BYTE_ram_784e:                               db 0x05
2498   77C8 16                                                      db 0x16
2499   77C9 07                                                      db 0x07
2500   77CA 05          BYTE_ram_7851:                               db 0x05
2501   77CB 1A                                                      db 0x1A
2502   77CC 07                                                      db 0x07
2503   77CD 08          BYTE_ram_7854:                               db 0x08
2504   77CE 0C                                                      db 0x0C
2505   77CF 0F                                                      db 0x0F
2506   77D0 02                                                      db 0x02
2507   77D1 07                                                      db 0x07
2508   77D2 06                                                      db 0x06
2509   77D3 04          BYTE_ram_785a:                               db 0x04
2510   77D4 09                                                      db 0x09
2511   77D5 0D                                                      db 0x0D
2512   77D6 01          BYTE_ram_785d:                               db 0x01
2513   77D7 09                                                      db 0x09
2514   77D8 0D                                                      db 0x0D
2515   77D9 06          BYTE_ram_7860:                               db 0x06
2516   77DA 05          BYTE_ram_7861:                               db 0x05
2517   77DB 03                                                      db 0x03
2518   77DC 07                                                      db 0x07
2519   77DD 09          BYTE_ram_7864:                               db 0x09
2520   77DE 0B                                                      db 0x0B
2521   77DF 03                                                      db 0x03
2522   77E0 0A                                                      db 0x0A
2523   77E1 08                                                      db 0x08
2524   77E2 0C                                                      db 0x0C
2525   77E3 06                                                      db 0x06
2526   77E4 05          BYTE_ram_786b:                               db 0x05
2527   77E5 1B                                                      db 0x1B
2528   77E6 07                                                      db 0x07
2529   77E7 08          BYTE_ram_786e:                               db 0x08
2530   77E8 01                                                      db 0x01
2531   77E9 06                                                      db 0x06
2532   77EA 08          BYTE_ram_7871:                               db 0x08
2533   77EB 14                                                      db 0x14
2534   77EC 06                                                      db 0x06
2535   77ED 05          BYTE_ram_7874:                               db 0x05
2536   77EE 1C                                                      db 0x1C
2537   77EF 0C                                                      db 0x0C
2538   77F0 09          BYTE_ram_7877:                               db 0x09
2539   77F1 0C                                                      db 0x0C
2540   77F2 05                                                      db 0x05
2541   77F3 1D                                                      db 0x1D
2542   77F4 07                                                      db 0x07
2543   77F5 05          BYTE_ram_787c:                               db 0x05
2544   77F6 19                                                      db 0x19
2545   77F7 0C                                                      db 0x0C
2546   77F8 05          BYTE_ram_787f:                               db 0x05
2547   77F9 1E                                                      db 0x1E
2548   77FA 0E                                                      db 0x0E
2549   77FB 05          BYTE_ram_7882:                               db 0x05
2550   77FC 1F                                                      db 0x1F
2551   77FD 05                                                      db 0x05
2552   77FE 20                                                      db 0x20
2553   77FF 0C                                                      db 0x0C
2554   7800 05          BYTE_ram_7887:                               db 0x05
2555   7801 1F                                                      db 0x1F
2556   7802 05                                                      db 0x05
2557   7803 21                                                      db 0x21
2558   7804 05                                                      db 0x05
2559   7805 1E                                                      db 0x1E
2560   7806 0E                                                      db 0x0E
2561   7807 05          BYTE_ram_788e:                               db 0x05
2562   7808 17                                                      db 0x17
2563   7809 07                                                      db 0x07
2564   780A 05          BYTE_ram_7891:                               db 0x05
2565   780B 12                                                      db 0x12
2566   780C 07                                                      db 0x07
2567   780D 37 78       ROOM_NAV_POINTER:                            dw ROOM_00_NAV 
2568   780F 3E 78                                                   dw ROOM_01_NAV 
2569   7811 41 78                                                   dw ROOM_02_NAV 
2570   7813 46 78                                                   dw ROOM_03_NAV 
2571   7815 4B 78                                                   dw ROOM_04_NAV 
2572   7817 50 78                                                   dw ROOM_05_NAV 
2573   7819 53 78                                                   dw ROOM_06_NAV 
2574   781B 54 78                                                   dw ROOM_07_NAV 
2575   781D 5F 78                                                   dw ROOM_08_NAV 
2576   781F 6A 78                                                   dw ROOM_09_NAV 
2577   7821 75 78                                                   dw ROOM_10_NAV 
2578   7823 80 78                                                   dw ROOM_11_NAV 
2579   7825 83 78                                                   dw ROOM_12_NAV 
2580   7827 8A 78                                                   dw ROOM_13_NAV 
2581   7829 8B 78                                                   dw ROOM_14_NAV 
2582   782B 8E 78                                                   dw ROOM_15_NAV 
2583   782D 93 78                                                   dw ROOM_16_NAV 
2584   782F 9A 78                                                   dw ROOM_17_NAV 
2585   7831 9D 78                                                   dw ROOM_18_NAV 
2586   7833 A0 78                                                   dw ROOM_19_NAV 
2587   7835 A0 78                                                   dw ROOM_19_NAV 
2588   7837 01          ROOM_00_NAV:                               db 0x01 ; cmd "DOWN"
2589   7838 03                                                      db 0x03 ; to room 3
2590   7839 04                                                      db 0x04 ; cmd "EAST"
2591   783A 02                                                      db 0x02 ; to room 2
2592   783B 05                                                      db 0x05 ; "WEST"
2593   783C 01                                                      db 0x01 ; to room 1
2594   783D FF                                                      db 0xFF
2595   783E 04          ROOM_01_NAV:                               db 0x04 ; cmd "EAST"
2596   783F 00                                                      db 0x00 ;  to room 0
2597   7840 FF                                                      db 0xFF
2598   7841 02          ROOM_02_NAV:                               db 0x02
2599   7842 07                                                      db 0x07
2600   7843 05                                                      db 0x05
2601   7844 00                                                      db 0x00
2602   7845 FF                                                      db 0xFF
2603   7846 03          ROOM_03_NAV:                               db 0x03
2604   7847 04                                                      db 0x04
2605   7848 05                                                      db 0x05
2606   7849 00                                                      db 0x00
2607   784A FF                                                      db 0xFF
2608   784B 02          ROOM_04_NAV:                               db 0x02
2609   784C 03                                                      db 0x03
2610   784D 04                                                      db 0x04
2611   784E 05                                                      db 0x05
2612   784F FF                                                      db 0xFF
2613   7850 02          ROOM_05_NAV:                               db 0x02
2614   7851 04                                                      db 0x04
2615   7852 FF                                                      db 0xFF
2616   7853 FF          ROOM_06_NAV:                               db 0xFF
2617   7854 01          ROOM_07_NAV:                               db 0x01
2618   7855 07                                                      db 0x07
2619   7856 02                                                      db 0x02
2620   7857 08                                                      db 0x08
2621   7858 03                                                      db 0x03
2622   7859 07                                                      db 0x07
2623   785A 04                                                      db 0x04
2624   785B 07                                                      db 0x07
2625   785C 05                                                      db 0x05
2626   785D 07                                                      db 0x07
2627   785E FF                                                      db 0xFF
2628   785F 01          ROOM_08_NAV:                               db 0x01
2629   7860 07                                                      db 0x07
2630   7861 02                                                      db 0x02
2631   7862 07                                                      db 0x07
2632   7863 03                                                      db 0x03
2633   7864 09                                                      db 0x09
2634   7865 04                                                      db 0x04
2635   7866 07                                                      db 0x07
2636   7867 05                                                      db 0x05
2637   7868 07                                                      db 0x07
2638   7869 FF                                                      db 0xFF
2639   786A 01          ROOM_09_NAV:                               db 0x01
2640   786B 07                                                      db 0x07
2641   786C 02                                                      db 0x02
2642   786D 07                                                      db 0x07
2643   786E 03                                                      db 0x03
2644   786F 07                                                      db 0x07
2645   7870 04                                                      db 0x04
2646   7871 0A                                                      db 0x0A
2647   7872 05                                                      db 0x05
2648   7873 07                                                      db 0x07
2649   7874 FF                                                      db 0xFF
2650   7875 01          ROOM_10_NAV:                               db 0x01
2651   7876 07                                                      db 0x07
2652   7877 02                                                      db 0x02
2653   7878 02                                                      db 0x02
2654   7879 03                                                      db 0x03
2655   787A 07                                                      db 0x07
2656   787B 04                                                      db 0x04
2657   787C 07                                                      db 0x07
2658   787D 05                                                      db 0x05
2659   787E 0B                                                      db 0x0B
2660   787F FF                                                      db 0xFF
2661   7880 04          ROOM_11_NAV:                               db 0x04
2662   7881 07                                                      db 0x07
2663   7882 FF                                                      db 0xFF
2664   7883 03          ROOM_12_NAV:                               db 0x03
2665   7884 0F                                                      db 0x0F
2666   7885 04                                                      db 0x04
2667   7886 0D                                                      db 0x0D
2668   7887 05                                                      db 0x05
2669   7888 13                                                      db 0x13
2670   7889 FF                                                      db 0xFF
2671   788A FF          ROOM_13_NAV:                               db 0xFF
2672   788B 05          ROOM_14_NAV:                               db 0x05
2673   788C 0D                                                      db 0x0D
2674   788D FF                                                      db 0xFF
2675   788E 04          ROOM_15_NAV:                               db 0x04
2676   788F 13                                                      db 0x13
2677   7890 05                                                      db 0x05
2678   7891 13                                                      db 0x13
2679   7892 FF                                                      db 0xFF
2680   7893 02          ROOM_16_NAV:                               db 0x02
2681   7894 0F                                                      db 0x0F
2682   7895 03                                                      db 0x03
2683   7896 13                                                      db 0x13
2684   7897 04                                                      db 0x04
2685   7898 11                                                      db 0x11
2686   7899 FF                                                      db 0xFF
2687   789A 05          ROOM_17_NAV:                               db 0x05
2688   789B 10                                                      db 0x10
2689   789C FF                                                      db 0xFF
2690   789D 04          ROOM_18_NAV:                               db 0x04
2691   789E 10                                                      db 0x10
2692   789F FF                                                      db 0xFF
2693   78A0 FF          ROOM_19_NAV:                               db 0xFF
2694   78A1 F1 78       ACTION_POINTER:                              dw IT_SHOWS_A_MAN_CLIMBING 
2695   78A3 22 79                                                   dw HOW_I_CANT_REACH 
2696   78A5 35 79                                                   dw IT_HAS_FALLEN_TO_THE_FLOOR 
2697   78A7 51 79                                                   dw HOW 
2698   78A9 57 79                                                   dw ITS_TOO_WIDE.I_FELL_AND_BROKE 
2699   78AB 7E 79                                                   dw UGH!_HE_IS_ALL_SLIMY 
2700   78AD 94 79                                                   dw HE_VANISHED_IN_A_PUFF_OF_SMOKE 
2701   78AF B4 79                                                   dw YOU_ALSO_BROKE_THE_MIRROR 
2702   78B1 CF 79                                                   dw COMPUTER_SAYS 
2703   78B3 FF 79                                                   dw IT_HAS_WEAKENED_IT 
2704   78B5 13 7A                                                   dw IT_HAD_NO_EFFECT 
2705   78B7 25 7A                                                   dw I_FELL_AND_KNOCKED_MYSELF_OUT 
2706   78B9 45 7A                                                   dw THE_BARS_LOOK_LOOSE 
2707   78BB 5A 7A                                                   dw WHAT_WITH 
2708   78BD 66 7A                                                   dw I_SEE_A_GOLD_COIN 
2709   78BF 79 7A                                                   dw BRRR.THE_WATERS_TOO_COLD 
2710   78C1 93 7A                                                   dw THE_FUSE_HAS_JUST_BLOWN 
2711   78C3 AC 7A                                                   dw THE_LIFT_HAS_BEEN_ACTIVATED 
2712   78C5 C9 7A                                                   dw I_SEE_NOTHING_SPECIAL 
2713   78C7 E0 7A                                                   dw KEEP_OFF_THE_MIDDLE_MEN 
2714   78C9 0E 7B                                                   dw VANITY_WALTZ 
2715   78CB 1D 7B                                                   dw TRY_HELP 
2716   78CD 27 7B                                                   dw POINTS_OF_COMPASS 
2717   78CF 3A 7B                                                   dw TRY_LOOKING_AROUND 
2718   78D1 4E 7B                                                   dw I_CAN_SEE_A_STEEP_SLOPE 
2719   78D3 67 7B                                                   dw AN_ALARM_SOUNDS 
2720   78D5 A4 7B                                                   dw I_CAN_SEE_A_ROPE_HANGING_DOWN 
2721   78D7 D0 7B                                                   dw I_AM_NOT_THAT_DAFT 
2722   78D9 F4 7B                                                   dw THE_SPACE_SHIP_BLEW_UP 
2723   78DB 1B 7C                                                   dw THE_SHIP_HAS_FLOWN 
2724   78DD 97 7C                                                   dw THE_LIFT_HAS_TAKEN_ME_UP 
2725   78DF 14 7D                                                   dw THE_LIFT_HAS_BECOME_ELECTRIFIED 
2726   78E1 35 7D                                                   dw I_HAVE_BEEN_ELECTROCUTED 
2727   78E3 4F 7D                                                   dw IT_IS_A_GOOD_JOB_I_WAS_WEARING 
2728   78E5 83 7D                                                   dw I_WOULD_KILL_MYSELF_IF_I_DID 
2729   78E7 A2 7D                                                   dw I_HAVE_TURNED_GREEN_AND_DROPPED 
2730   78E9 C9 7D                                                   dw s_THE_GREEN_MAN_AWOKE_AND_THROTTLE_ram_7e50 
2731   78EB F0 7D                                                   dw s_THE_GUARD_WOKE_AND_SHOT_ME._ram_7e77 
2732   78ED 0D 7E                                                   dw s_WHAT_AT?_ram_7e94 
2733   78EF 00 00                                                   dw 0x0000
2734   78F1             IT_SHOWS_A_MAN_CLIMBING:                     db "IT SHOWS A MAN CLIMBING DOWN A PIT USING A ROPE\r",0
2734   78F1 49542053484F57532041204D414E20434C494D42494E4720444F574E20412050
2734   7911 4954205553494E47204120524F50450D00
2735   7922             HOW_I_CANT_REACH:                            db "HOW? I CANT REACH\r",0
2735   7922 484F573F20492043414E542052454143480D00
2736   7935             IT_HAS_FALLEN_TO_THE_FLOOR:                  db "IT HAS FALLEN TO THE FLOOR\r",0
2736   7935 4954204841532046414C4C454E20544F2054484520464C4F4F520D00
2737   7951             HOW:                                         db "HOW?\r",0
2737   7951 484F573F0D00
2738   7957             ITS_TOO_WIDE.I_FELL_AND_BROKE:               db "ITS TOO WIDE.I FELL AND BROKE MY NECK\r",0
2738   7957 49545320544F4F20574944452E492046454C4C20414E442042524F4B45204D59
2738   7977 204E45434B0D00
2739   797E             UGH!_HE_IS_ALL_SLIMY:                        db "UGH! HE IS ALL SLIMY\r",0
2739   797E 5547482120484520495320414C4C20534C494D590D00
2740   7994             HE_VANISHED_IN_A_PUFF_OF_SMOKE:              db "HE VANISHED IN A PUFF OF SMOKE\r",0
2740   7994 48452056414E495348454420494E20412050554646204F4620534D4F4B450D00
2741   79B4             YOU_ALSO_BROKE_THE_MIRROR:                   db "YOU ALSO BROKE THE MIRROR\r",0
2741   79B4 594F5520414C534F2042524F4B4520544845204D4952524F520D00
2742   79CF             COMPUTER_SAYS:                               db "COMPUTER SAYS: 2 WEST,2 SOUTH FOR SPACE FLIGHT\r",0
2742   79CF 434F4D505554455220534159533A203220574553542C3220534F55544820464F
2742   79EF 5220535041434520464C494748540D00
2743   79FF             IT_HAS_WEAKENED_IT:                          db "IT HAS WEAKENED IT\r",0
2743   79FF 495420484153205745414B454E45442049540D00
2744   7A13             IT_HAD_NO_EFFECT:                            db "IT HAD NO EFFECT\r",0
2744   7A13 495420484144204E4F204546464543540D00
2745   7A25             I_FELL_AND_KNOCKED_MYSELF_OUT:               db "I FELL AND KNOCKED MYSELF OUT.\r",0
2745   7A25 492046454C4C20414E44204B4E4F434B4544204D5953454C46204F55542E0D00
2746   7A45             THE_BARS_LOOK_LOOSE:                         db "THE BARS LOOK LOOSE\r",0
2746   7A45 5448452042415253204C4F4F4B204C4F4F53450D00
2747   7A5A             WHAT_WITH:                                   db "WHAT WITH?\r",0
2747   7A5A 5748415420574954483F0D00
2748   7A66             I_SEE_A_GOLD_COIN:                           db "I SEE A GOLD COIN\r",0
2748   7A66 4920534545204120474F4C4420434F494E0D00
2749   7A79             BRRR.THE_WATERS_TOO_COLD:                    db "BRRR.THE WATERS TOO COLD\r",0
2749   7A79 425252522E5448452057415445525320544F4F20434F4C440D00
2750   7A93             THE_FUSE_HAS_JUST_BLOWN:                     db "THE FUSE HAS JUST BLOWN\r",0
2750   7A93 544845204655534520484153204A55535420424C4F574E0D00
2751   7AAC             THE_LIFT_HAS_BEEN_ACTIVATED:                 db "THE LIFT HAS BEEN ACTIVATED\r",0
2751   7AAC 544845204C49465420484153204245454E204143544956415445440D00
2752   7AC9             I_SEE_NOTHING_SPECIAL:                       db "I SEE NOTHING SPECIAL\r",0
2752   7AC9 4920534545204E4F5448494E47205350454349414C0D00
2753   7AE0             KEEP_OFF_THE_MIDDLE_MEN:                     db "KEEP OFF THE MIDDLE MEN,ONE MAY BE SHOCKING!\r",0
2753   7AE0 4B454550204F464620544845204D4944444C45204D454E2C4F4E45204D415920
2753   7B00 42452053484F434B494E47210D00
2754   7B0E             VANITY_WALTZ:                                db "VANITY WALTZ!\r",0
2754   7B0E 56414E4954592057414C545A210D00
2755   7B1D             TRY_HELP:                                    db "TRY HELP\r",0
2755   7B1D 5452592048454C500D00
2756   7B27             POINTS_OF_COMPASS:                           db "POINTS OF COMPASS\r",0
2756   7B27 504F494E5453204F4620434F4D504153530D00
2757   7B3A             TRY_LOOKING_AROUND:                          db "TRY LOOKING AROUND\r",0
2757   7B3A 545259204C4F4F4B494E472041524F554E440D00
2758   7B4E             I_CAN_SEE_A_STEEP_SLOPE:                     db "I CAN SEE A STEEP SLOPE\r",0
2758   7B4E 492043414E20534545204120535445455020534C4F50450D00
2759   7B67             AN_ALARM_SOUNDS:                             db "AN ALARM SOUNDS.THE SECURITY GUARD SHOT ME FOR TRESPASSING.\r",0
2759   7B67 414E20414C41524D20534F554E44532E54484520534543555249545920475541
2759   7B87 52442053484F54204D4520464F52205452455350415353494E472E0D00
2760   7BA4             I_CAN_SEE_A_ROPE_HANGING_DOWN:               db "I CAN SEE A ROPE HANGING DOWN THE CHIMNEY.\r",0
2760   7BA4 492043414E20534545204120524F50452048414E47494E4720444F574E205448
2760   7BC4 45204348494D4E45592E0D00
2761   7BD0             I_AM_NOT_THAT_DAFT:                          db "I AM NOT THAT DAFT.IT IS TOO DEEP.\r",0
2761   7BD0 4920414D204E4F54205448415420444146542E495420495320544F4F20444545
2761   7BF0 502E0D00
2762   7BF4             THE_SPACE_SHIP_BLEW_UP:                      db "THE SPACE SHIP BLEW UP AND KILLED ME.\r",0
2762   7BF4 544845205350414345205348495020424C455720555020414E44204B494C4C45
2762   7C14 44204D452E0D00
2763   7C1B             THE_SHIP_HAS_FLOWN:                          db "THE SHIP HAS FLOWN INTO THE LARGE LIFT AND IS HOVERING THERE.\rTHERE ARE FOUR BU"
2763   7C1B 54484520534849502048415320464C4F574E20494E544F20544845204C415247
2763   7C3B 45204C49465420414E4420495320484F564552494E472054484552452E0D5448
2763   7C5B 4552452041524520464F5552204255
2764   7C6A                                                         db "TTONS OUTSIDE THE WINDOW MARKED 1,2,3 AND 4\r",0
2764   7C6A 54544F4E53204F555453494445205448452057494E444F57204D41524B454420
2764   7C8A 312C322C3320414E4420340D00
2765   7C97             THE_LIFT_HAS_TAKEN_ME_UP:                    db "THE LIFT HAS TAKEN ME UP TO A PLATEAU.\rCONGRATULATIONS, YOU HAVE MANAGED TO COM"
2765   7C97 544845204C494654204841532054414B454E204D4520555020544F204120504C
2765   7CB7 41544541552E0D434F4E47524154554C4154494F4E532C20594F552048415645
2765   7CD7 204D414E4147454420544F20434F4D
2766   7CE6                                                         db "PLETE THIS ADVENTURE\rWITHOUT GETTING KILLED.\r",0
2766   7CE6 504C455445205448495320414456454E545552450D574954484F555420474554
2766   7D06 54494E47204B494C4C45442E0D00
2767   7D14             THE_LIFT_HAS_BECOME_ELECTRIFIED:             db "THE LIFT HAS BECOME ELECTRIFIED\r",0
2767   7D14 544845204C49465420484153204245434F4D4520454C4543545249464945440D
2767   7D34 00
2768   7D35             I_HAVE_BEEN_ELECTROCUTED:                    db "I HAVE BEEN ELECTROCUTED\r",0
2768   7D35 492048415645204245454E20454C454354524F43555445440D00
2769   7D4F             IT_IS_A_GOOD_JOB_I_WAS_WEARING:              db "IT IS A GOOD JOB I WAS WEARING RUBBER SOLED BOOTS.\r",0
2769   7D4F 4954204953204120474F4F44204A4F422049205741532057454152494E472052
2769   7D6F 554242455220534F4C454420424F4F54532E0D00
2770   7D83             I_WOULD_KILL_MYSELF_IF_I_DID:                db "I WOULD KILL MYSELF IF I DID.\r",0
2770   7D83 4920574F554C44204B494C4C204D5953454C462049462049204449442E0D00
2771   7DA2             I_HAVE_TURNED_GREEN_AND_DROPPED:             db "I HAVE TURNED GREEN AND DROPPED DEAD.\r",0
2771   7DA2 492048415645205455524E454420475245454E20414E442044524F5050454420
2771   7DC2 444541442E0D00
2772   7DC9             s_THE_GREEN_MAN_AWOKE_AND_THROTTLE_ram_7e50: db "THE GREEN MAN AWOKE AND THROTTLED ME.\r",0
2772   7DC9 54484520475245454E204D414E2041574F4B4520414E44205448524F54544C45
2772   7DE9 44204D452E0D00
2773   7DF0             s_THE_GUARD_WOKE_AND_SHOT_ME._ram_7e77:      db "THE GUARD WOKE AND SHOT ME.\r",0
2773   7DF0 54484520475541524420574F4B4520414E442053484F54204D452E0D00
2774   7E0D             s_WHAT_AT?_ram_7e94:                         db "WHAT AT?\r",0
2774   7E0D 574841542041543F0D00
2775   7E17 06          VALIDATOR0:                                  db 0x06 ; PROC6(5,1)
2776   7E18 05                                                      db 0x05 ; point to item 5 "A METAL BAR"
2777   7E19 01                                                      db 0x01 ; compared with index (IX+1)
2778   7E1A 05                                                      db 0x05 ; PROC6(6)
2779   7E1B 06                                                      db 0x06 ; point to item 6 "A GOLD COIN"
2780   7E1C FF                                                      db 0xFF
2781   7E1D 06          VALIDATOR1:                                        db 0x06 ; PROC6(2,1)
2782   7E1E 02                                                      db 0x02 ; "A KEY"
2783   7E1F 01                                                      db 0x01 ; +1
2784   7E20 01                                                      db 0x01 ; PROC1(0x10) is atem available
2785   7E21 10                                                      db 0x10 ; OBJECT_A_SMALL_GREEN_MAN_SLEEPING
2786   7E22 FF                                                      db 0xFF
2787   7E23 06          VALIDATOR2:                                  db 0x06 ; PROC6(2,1)
2788   7E24 02                                                      db 0x02 ; "A KEY"
2789   7E25 01                                                      db 0x01 ; +1
2790   7E26 01                                                      db 0x01 ; PROC1(0x11)
2791   7E27 11                                                      db 0x11 ; OBJECT_A_SLEEPING_GREEN_MAN
2792   7E28 FF                                                      db 0xFF
2793   7E29 06          VALIDATOR3:                                  db 0x06 ; PROC6(2,1)
2794   7E2A 02                                                      db 0x02 ; "A KEY"
2795   7E2B 01                                                      db 0x01 ; +1
2796   7E2C 01                                                      db 0x01 ; PROC1(0x17)
2797   7E2D 17                                                      db 0x17 ; OBJECT_A_SLEEPING_SECURITY_MAN
2798   7E2E FF                                                      db 0xFF
2799   7E2F 06          VALIDATOR4:                                  db 0x06 ; PROC6(2,1)
2800   7E30 02                                                      db 0x02 ; "A KEY"
2801   7E31 01                                                      db 0x01 ; +1
2802   7E32 01                                                      db 0x01 ; PROC1(0x0e)
2803   7E33 0E                                                      db 0x0E ; OBJECT_A_BLOCK_OF_ICE
2804   7E34 FF                                                      db 0xFF
2805   7E35 FF          VALIDATOR5:                                  db 0xFF
2806   7E36 05          ACTION0:                                     db 0x05 ; CMD_DEATH
2807   7E37 23                                                      db 0x23 ; I_HAVE_TURNED_GREEN_AND_DROPPED
2808   7E38 0C                                                      db 0x0C ; CMD_END
2809   7E39 05          ACTION1:                                     db 0x05 ; CMD_DEATH
2810   7E3A 24                                                      db 0x24 ; s_THE_GREEN_MAN_AWOKE_AND_THROTTLE_ram_7e50
2811   7E3B 0C                                                      db 0x0C ; CMD_END
2812   7E3C 05          ACTION2:                                     db 0x05 ; CMD_DEATH
2813   7E3D 25                                                      db 0x25 ; s_THE_GUARD_WOKE_AND_SHOT_ME._ram_7e77
2814   7E3E 0C                                                      db 0x0C ; CMD_END
2815   7E3F 0B          ACTION3:                                     db 0x0B ; CMD_6388
2816   7E40 0E                                                      db 0x0E
2817   7E41 15          VALIDATOR10:                                 db 0x15 ; CMD_TELL_ME
2818   7E42 FF          DEFAULT_TABLE:                               db 0xFF 
2819   7E43 FF                                                      db 0xFF 
2820   7E44 17 7E                                                   dw VALIDATOR0 
2821   7E46 36 7E                                                   dw ACTION0 
2822   7E48 FF                                                      db 0xFF
2823   7E49 FF                                                      db 0xFF
2824   7E4A 1D 7E                                                   dw VALIDATOR1 
2825   7E4C 39 7E                                                   dw ACTION1 
2826   7E4E FF                                                      db 0xFF
2827   7E4F FF                                                      db 0xFF
2828   7E50 23 7E                                                   dw VALIDATOR2 
2829   7E52 39 7E                                                   dw ACTION1 
2830   7E54 FF                                                      db 0xFF
2831   7E55 FF                                                      db 0xFF
2832   7E56 29 7E                                                   dw VALIDATOR3 
2833   7E58 3C 7E                                                   dw ACTION2 
2834   7E5A FF                                                      db 0xFF
2835   7E5B FF                                                      db 0xFF
2836   7E5C 2F 7E                                                   dw VALIDATOR4 
2837   7E5E 3F 7E                                                   dw ACTION3 
2838   7E60 FF                                                      db 0xFF
2839   7E61 FF                                                      db 0xFF
2840   7E62 35 7E                                                   dw VALIDATOR5 
2841   7E64 41 7E                                                   dw VALIDATOR10 
2842   7E66 00                                                      db 0x00
2843   7E67 52                                                      db 0x52
2844   7E68 4F                                                      db 0x4F
2845   7E69 4C                                                      db 0x4C
2846   7E6A 20                                                      db 0x20
2847   7E6B 52                                                      db 0x52
2848   7E6C 4F                                                      db 0x4F
2849   7E6D 00          END_OF_DATA:                                 db 0x00
2850   7E6E                                                         endmodule
2851   7E6E             
2852   7E6E 3E 04       DEBUG_TEXT:                                  LD A, CLR_BLACK<<3 | CLR_GREEN 
2853   7E70 CD 13 BF                                                CALL SCREEN.CLEAR
2854   7E73                                          
2855   7E73 21 10 BF                                                LD HL,SCREEN.POS_Y
2856   7E76 36 17                                                   LD (HL),23
2857   7E78 23                                                      INC HL
2858   7E79 36 17                                                    LD (HL),23
2859   7E7B             
2860   7E7B 21 ED BB    KEY_LOOP:                                    LD HL,KEYBOARD.LASTK ;getting key in A - capitalized 
2861   7E7E 7E                                                      LD A,(HL)
2862   7E7F 36 00                                                   LD (HL),0x0
2863   7E81 FE 00                                                   CP 0
2864   7E83 28 F6                                                   JR Z,KEY_LOOP
2865   7E85 CD E7 BF                                                CALL SCREEN.PRINT_CHAR
2866   7E88             
2867   7E88 C3 7B 7E                                                JP KEY_LOOP
2868   7E8B             
2869   7E8B             
2870   7E8B 21 3B 5C    BASIC_RUNNER                                LD HL,0x5C3b
2871   7E8E 36 CC                                                   LD (HL),0xCC
2872   7E90                                                         ; im2
2873   7E90 F3                                                      DI  
2874   7E91 3E BA                                                   LD A,0xBA
2875   7E93 ED 47                                                   LD I,A
2876   7E95 ED 5E                                                   IM 2
2877   7E97 FB                                                      EI
2878   7E98 C3 6C 5D                                                JP GAME.ENTRY_POINT
2879   7E9B                                                         ;JP DEBUG_TEXT
2880   7E9B             
2881   7E9B                                                         ORG  0xBA00
2882   BA00 BB                                                      DEFS 257,0xBB
2883   BB01             
2884   BB01                                                         ORG 0xBBBB
2885   BBBB F3                                                      DI
2886   BBBC F5                                                      PUSH AF                
2887   BBBD C5                                                      PUSH BC                                               
2888   BBBE D5                                                      PUSH DE                                               
2889   BBBF DD E5                                                   PUSH IX                                               
2890   BBC1 FD E5                                                   PUSH IY                                              
2891   BBC3 E5                                                      PUSH HL  
2892   BBC4             
2893   BBC4 CD 21 BC                                                call KEYBOARD.KEYBOARD
2894   BBC7             
2895   BBC7                                                         ;XOR A
2896   BBC7                                                         ;LD (23560),A
2897   BBC7                                                         ;LD IY,#5C3A
2898   BBC7                                                         ;RST 56
2899   BBC7 3A 08 5C                                                LD a,(23560) 
2900   BBCA 32 01 40                                                LD (16385),A
2901   BBCD 3A ED BB                                                LD a,(KEYBOARD.LASTK) 
2902   BBD0 32 66 06                                                LD (1638),A
2903   BBD3             
2904   BBD3 3A 00 40                                                LD a,(16384)
2905   BBD6 EE FF                                                   xor 255
2906   BBD8 32 00 40                                                ld (16384),a
2907   BBDB             
2908   BBDB E1                                                      POP HL 
2909   BBDC FD E1                                                   POP IY
2910   BBDE DD E1                                                   POP IX     
2911   BBE0 D1                                                      POP DE
2912   BBE1 C1                                                      POP BC                                                                                                                                        
2913   BBE2 F1                                                      POP AF                                                                                                                                                                                                   
2914   BBE3 FB                                                      EI
2915   BBE4 C9                                                      RET
2916   BBE5             
2917   BBE5                                                         include keyboard.asm
0001+  BBE5             	module KEYBOARD
0002+  BBE5             	
0003+  BBE5             	; + FF if the set is unused, or a main code from the main key table otherwise
0004+  BBE5             	;Call counter; initially + 05, and decremented on each call to KEYBOARD
0005+  BBE5             	;Repeat delay counter; initially REPDEL, decremented on each call to KEYBOARD, reset to REPPER whenever it reaches zero
0006+  BBE5             	;Final code from the key tables (as computed by K_DECODE)
0007+  BBE5 FF 00 00 00 KSTATE_0:  db $FF, $00, $00, $00
0008+  BBE9 FF 00 00 00 KSTATE_4:  db $FF, $00, $00, $00
0009+  BBED             	;Read by the routine at KEY_INPUT, and updated by the routine at KEYBOARD.
0010+  BBED 00          LASTK:  db $00
0011+  BBEE             	;REPDEL - Time that a key must be held down before it repeats
0012+  BBEE 23          REPDEL:  db $23
0013+  BBEF             	;Delay between successive repeats of a key held down
0014+  BBEF             	;Initialised by the routine at NEW, and read by the routine at KEYBOARD.
0015+  BBEF 05          REPPER:  db $05
0016+  BBF0             	
0017+  BBF0             	
0018+  BBF0             	; * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
0019+  BBF0             	; * * Part 2. KEYBOARD ROUTINES * * 
0020+  BBF0             	; * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
0021+  BBF0             	
0022+  BBF0             	; Using shift keys and a combination of modes the Spectrum 40 - key keyboard
0023+  BBF0             	; can be mapped to 256 input characters
0024+  BBF0             	
0025+  BBF0             	; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
0026+  BBF0             	;
0027+  BBF0             	; 0 1 2 3 4 - Bits - 4 3 2 1 0
0028+  BBF0             	; PORT PORT
0029+  BBF0             	;
0030+  BBF0             	; F7FE [ 1 ] [ 2 ] [ 3 ] [ 4 ] [ 5 ] | [ 6 ] [ 7 ] [ 8 ] [ 9 ] [ 0 ] EFFE
0031+  BBF0             	; ^ | v
0032+  BBF0             	; FBFE [ Q ] [ W ] [ E ] [ R ] [ T ] | [ Y ] [ U ] [ I ] [ O ] [ P ] DFFE
0033+  BBF0             	; ^ | v
0034+  BBF0             	; FDFE [ A ] [ S ] [ D ] [ F ] [ G ] | [ H ] [ J ] [ K ] [ L ] [ ENT ] BFFE
0035+  BBF0             	; ^ | v
0036+  BBF0             	; FEFE [SHI] [ Z ] [ X ] [ C ] [ V ] | [ B ] [ N ] [ M ] [sym] [ SPC ] 7FFE
0037+  BBF0             	; ^ $27 $18 v
0038+  BBF0             	; Start End
0039+  BBF0             	; 00100111 00011000
0040+  BBF0             	;
0041+  BBF0             	; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
0042+  BBF0             	; The above map may help in reading.
0043+  BBF0             	; The neat arrangement of ports means that the B register need only be
0044+  BBF0             	; rotated left to work up the left hand side and then down the right
0045+  BBF0             	; hand side of the keyboard. When the reset bit drops into the carry
0046+  BBF0             	; then all 8 half - rows have been read. Shift is the first key to be
0047+  BBF0             	; read. The lower six bits of the shifts are unambiguous.
0048+  BBF0             	
0049+  BBF0             	; - - - - - - - - - - - - - - - - - - 
0050+  BBF0             	; Keyboard scanning
0051+  BBF0             	; - - - - - - - - - - - - - - - - - - 
0052+  BBF0             	; from keyboard and S_INKEY
0053+  BBF0             	; returns 1 or 2 keys in DE, most significant shift first if any
0054+  BBF0             	; key values 0 - 39 else 255P
0055+  BBF0             	
0056+  BBF0             	;;;$028E
0057+  BBF0 2E 2F       KEY_SCAN:  LD L, $2F           ; initial key value
0058+  BBF2             	; valid values are obtained by subtracting
0059+  BBF2             	; eight five times.
0060+  BBF2 11 FF FF    	LD DE, $FFFF                 ; a buffer to receive 2 keys.
0061+  BBF5 01 FE FE    	LD BC, $FEFE                 ; the commencing port address
0062+  BBF8             	; B holds 11111110 initially and is also
0063+  BBF8             	; used to count the 8 half - rows
0064+  BBF8             	;;;$0296
0065+  BBF8 ED 78       KEY_LINE:  IN A, (C)           ; read the port to A - bits will be reset
0066+  BBFA             	; if a key is pressed else set.
0067+  BBFA 2F          	CPL                          ; complement - pressed key - bits are now set
0068+  BBFB E6 1F       	AND $1F                      ; apply 00011111 mask to pick up the
0069+  BBFD             	; relevant set bits.
0070+  BBFD 28 0E       	JR Z, KEY_DONE               ; forward to KEY_DONE if zero and therefore
0071+  BBFF             	; no keys pressed in row at all.
0072+  BBFF 67          	LD H, A                      ; transfer row bits to H
0073+  BC00 7D          	LD A, L                      ; load the initial key value to A
0074+  BC01             	
0075+  BC01             	;;;$029F
0076+  BC01 14          KEY_3KEYS:  INC D              ; now test the key buffer
0077+  BC02 C0          	RET NZ                       ; if we have collected 2 keys already
0078+  BC03             	; then too many so quit.
0079+  BC03             	
0080+  BC03             	;;;$02A1
0081+  BC03 D6 08       KEY_BITS:  SUB $08             ; subtract 8 from the key value
0082+  BC05             	; cycling through key values (top = $27)
0083+  BC05             	; e.g. 2F> 27>1F>17>0F>07
0084+  BC05             	; 2E> 26>1E>16>0E>06
0085+  BC05 CB 3C       	SRL H                        ; shift key bits right into carry.
0086+  BC07 30 FA       	JR NC, KEY_BITS              ; back to KEY_BITS if not pressed
0087+  BC09             	; but if pressed we have a value (0 - 39d)
0088+  BC09 53          	LD D, E                      ; transfer a possible previous key to D
0089+  BC0A 5F          	LD E, A                      ; transfer the new key to E
0090+  BC0B 20 F4       	JR NZ, KEY_3KEYS             ; back to KEY_3KEYS if there were more
0091+  BC0D             	; set bits - H was not yet zero.
0092+  BC0D             	
0093+  BC0D             	;;;$02AB
0094+  BC0D 2D          KEY_DONE:  DEC L               ; cycles 2F>2E>2D>2C>2B>2A>29>28 for
0095+  BC0E             	; each half - row.
0096+  BC0E CB 00       	RLC B                        ; form next port address e.g. FEFE > FDFE
0097+  BC10 38 E6       	JR C, KEY_LINE               ; back to KEY_LINE if still more rows to do.
0098+  BC12             	
0099+  BC12 7A          	LD A, D                      ; now test if D is still FF ?
0100+  BC13 3C          	INC A                        ; if it is zero we have at most 1 key
0101+  BC14             	; range now $01 - $28 (1 - 40d)
0102+  BC14 C8          	RET Z                        ; return if one key or no key.
0103+  BC15             	
0104+  BC15 FE 28       	CP $28                       ; is it capsshift (was $27) ?
0105+  BC17 C8          	RET Z                        ; return if so.
0106+  BC18             	
0107+  BC18 FE 19       	CP $19                       ; is it symbol shift (was $18) ?
0108+  BC1A C8          	RET Z                        ; return also
0109+  BC1B             	
0110+  BC1B 7B          	LD A, E                      ; now test E
0111+  BC1C 5A          	LD E, D                      ; but first switch
0112+  BC1D 57          	LD D, A                      ; the two keys.
0113+  BC1E FE 18       	CP $18                       ; is it symbol shift ?
0114+  BC20 C9          	RET                          ; return (with zero set if it was).
0115+  BC21             	; but with symbol shift now in D
0116+  BC21             	
0117+  BC21             	; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
0118+  BC21             	; Scan keyboard and decode value
0119+  BC21             	; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
0120+  BC21             	; from interrupt 50 times a second
0121+  BC21             	
0122+  BC21             	;;;$02BF
0123+  BC21 CD F0 BB    KEYBOARD:  CALL KEY_SCAN       ; routine KEY_SCAN
0124+  BC24 C0          	RET NZ                       ; return if invalid combinations
0125+  BC25             	
0126+  BC25             	; then decrease the counters within the two key - state maps
0127+  BC25             	; as this could cause one to become free.
0128+  BC25             	; if the keyboard has not been pressed during the last five interrupts
0129+  BC25             	; then both sets will be free.
0130+  BC25             	
0131+  BC25             	
0132+  BC25 21 E5 BB    	LD HL, KSTATE_0              ; point to KSTATE_0
0133+  BC28             	
0134+  BC28             	;;;$02C6
0135+  BC28 CB 7E       K_ST_LOOP:  BIT 7, (HL)        ; is it free ? ($FF)
0136+  BC2A 20 07       	JR NZ, K_CH_SET              ; forward to K_CH_SET if so
0137+  BC2C             	
0138+  BC2C 23          	INC HL                       ; address 5 - counter
0139+  BC2D 35          	DEC (HL)                     ; decrease counter
0140+  BC2E 2B          	DEC HL                       ; step back
0141+  BC2F 20 02       	JR NZ, K_CH_SET              ; forward to K_CH_SET if not at end of count
0142+  BC31             	
0143+  BC31 36 FF       	LD (HL), $FF                 ; else mark it free.
0144+  BC33             	
0145+  BC33             	;;;$02D1
0146+  BC33 7D          K_CH_SET:  LD A, L             ; store low address byte.
0147+  BC34 21 E9 BB    	LD HL, KSTATE_4              ; point to KSTATE_4
0148+  BC37             	; (ld l, $04)
0149+  BC37 BD          	CP L                         ; have 2 been done ?
0150+  BC38 20 EE       	JR NZ, K_ST_LOOP             ; back to K_ST_LOOP to consider this 2nd set
0151+  BC3A             	
0152+  BC3A             	; now the raw key (0 - 38) is converted to a main key (uppercase).
0153+  BC3A             	
0154+  BC3A CD 80 BC    	CALL K_TEST                  ; routine K_TEST to get main key in A
0155+  BC3D D0          	RET NC                       ; return if single shift
0156+  BC3E             	
0157+  BC3E 21 E5 BB    	LD HL, KSTATE_0              ; point to KSTATE_0
0158+  BC41 BE          	CP (HL)                      ; does it match ?
0159+  BC42 28 2E       	JR Z, K_REPEAT               ; forward to K_REPEAT if so
0160+  BC44             	
0161+  BC44             	; if not consider the second key map.
0162+  BC44             	
0163+  BC44 EB          	EX DE, HL                    ; save KSTATE_0 in DE
0164+  BC45 21 E9 BB    	LD HL, KSTATE_4              ; point to KSTATE_4
0165+  BC48 BE          	CP (HL)                      ; does it match ?
0166+  BC49 28 27       	JR Z, K_REPEAT               ; forward to K_REPEAT if so
0167+  BC4B             	
0168+  BC4B             	; having excluded a repeating key we can now consider a new key.
0169+  BC4B             	; the second set is always examined before the first.
0170+  BC4B             	
0171+  BC4B CB 7E       	BIT 7, (HL)                  ; is it free ?
0172+  BC4D 20 04       	JR NZ, K_NEW                 ; forward to K_NEW if so.
0173+  BC4F             	
0174+  BC4F EB          	EX DE, HL                    ; bring back KSTATE_0
0175+  BC50 CB 7E       	BIT 7, (HL)                  ; is it free ?
0176+  BC52 C8          	RET Z                        ; return if not.
0177+  BC53             	; as we have a key but nowhere to put it yet.
0178+  BC53             	
0179+  BC53             	; continue or jump to here if one of the buffers was free.
0180+  BC53             	
0181+  BC53             	;;;$02F1
0182+  BC53 5F          K_NEW:  LD E, A                ; store key in E
0183+  BC54 77          	LD (HL), A                   ; place in free location
0184+  BC55 23          	INC HL                       ; advance to interrupt counter
0185+  BC56 36 05       	LD (HL), $05                 ; and initialize to 5
0186+  BC58 23          	INC HL                       ; advance to delay
0187+  BC59 3A EE BB    	LD A, (REPDEL)               ; pick up system variable REPDEL
0188+  BC5C 77          	LD (HL), A                   ; and insert that for first repeat delay.
0189+  BC5D 23          	INC HL                       ; advance to last location of state map.
0190+  BC5E FD 4E 07    	LD C, (IY + $07)             ; pick up MODE (3 bytes)
0191+  BC61 FD 56 01    	LD D, (IY + $01)             ; pick up FLAGS (3 bytes)
0192+  BC64 E5          	PUSH HL                      ; save state map location
0193+  BC65             	; Note. could now have used.
0194+  BC65             	; ld l, $41; ld c, (hl); ld l, $3B; ld d, (hl).
0195+  BC65             	; six and two threes of course.
0196+  BC65 CD 95 BC    	CALL K_DECODE                ; routine K_DECODE
0197+  BC68 E1          	POP HL                       ; restore map pointer
0198+  BC69 77          	LD (HL), A                   ; put decoded key in last location of map.
0199+  BC6A             	
0200+  BC6A             	;;;$0308
0201+  BC6A 32 ED BB    K_END:  LD (LASTK), A          ; update LASTK system variable.
0202+  BC6D FD CB 01 EE 	SET 5, (IY + $01)            ; update FLAGS - signal new key.
0203+  BC71 C9          	RET                          ; done
0204+  BC72             	
0205+  BC72             	; - - - - - - - - - - - - - - - - - - - 
0206+  BC72             	; Repeat key routine
0207+  BC72             	; - - - - - - - - - - - - - - - - - - - 
0208+  BC72             	; A possible repeat has been identified. HL addresses the raw (main) key.
0209+  BC72             	; The last location holds the decoded key (from the first context).
0210+  BC72             	
0211+  BC72             	;;;$0310
0212+  BC72 23          K_REPEAT:  INC HL              ; advance
0213+  BC73 36 05       	LD (HL), $05                 ; maintain interrupt counter at 5
0214+  BC75 23          	INC HL                       ; advance
0215+  BC76 35          	DEC (HL)                     ; decrease REPDEL value.
0216+  BC77 C0          	RET NZ                       ; return if not yet zero.
0217+  BC78             	
0218+  BC78 3A EF BB    	LD A, (REPPER)               ; REPPER
0219+  BC7B 77          	LD (HL), A                   ; but for subsequent repeats REPPER will be used.
0220+  BC7C 23          	INC HL                       ; advance
0221+  BC7D 7E          	LD A, (HL)                   ; pick up the key decoded possibly in another context.
0222+  BC7E 18 EA       	JR K_END                     ; back to K_END
0223+  BC80             	
0224+  BC80             	; - - - - - - - - - - - - - - - 
0225+  BC80             	; Test key value
0226+  BC80             	; - - - - - - - - - - - - - - - 
0227+  BC80             	; also called from S_INKEY
0228+  BC80             	; begin by testing for a shift with no other.
0229+  BC80             	
0230+  BC80             	;;;$031E
0231+  BC80 42          K_TEST:  LD B, D               ; load most significant key to B
0232+  BC81             	; will be $FF if not shift.
0233+  BC81 16 00       	LD D, $00                    ; and reset D to index into main table
0234+  BC83 7B          	LD A, E                      ; load least significant key from E
0235+  BC84 FE 27       	CP $27                       ; is it higher than 39d i.e. FF
0236+  BC86 D0          	RET NC                       ; return with just a shift (in B now)
0237+  BC87             	
0238+  BC87 FE 18       	CP $18                       ; is it symbol shift ?
0239+  BC89 20 03       	JR NZ, K_MAIN                ; forward to K_MAIN if not
0240+  BC8B             	
0241+  BC8B             	; but we could have just symbol shift and no other
0242+  BC8B             	
0243+  BC8B CB 78       	BIT 7, B                     ; is other key $FF (ie not shift)
0244+  BC8D C0          	RET NZ                       ; return with solitary symbol shift
0245+  BC8E             	
0246+  BC8E             	;;;$032C
0247+  BC8E 21 87 BE    K_MAIN:  LD HL, MAIN_KEYS      ; address: MAIN_KEYS
0248+  BC91 19          	ADD HL, DE                   ; add offset 0 - 38
0249+  BC92 7E          	LD A, (HL)                   ; pick up main key value
0250+  BC93 37          	SCF                          ; set carry flag
0251+  BC94 C9          	RET                          ; return (B has other key still)
0252+  BC95             	
0253+  BC95             	; - - - - - - - - - - - - - - - - - - 
0254+  BC95             	; Keyboard decoding
0255+  BC95             	; - - - - - - - - - - - - - - - - - - 
0256+  BC95             	; also called from S_INKEY
0257+  BC95             	
0258+  BC95             	;;;$0333
0259+  BC95 7B          K_DECODE:  LD A, E             ; pick up the stored main key
0260+  BC96 FE 3A       	CP $3A                       ; an arbitrary point between digits and letters
0261+  BC98 38 2F       	JR C, K_DIGIT                ; forward to K_DIGIT with digits, space, enter
0262+  BC9A             	
0263+  BC9A 0D          	DEC C                        ; decrease MODE ( 0='KLC', 1='E', 2='G')
0264+  BC9B FA B1 BC    	JP M, K_KLC_LET              ; to K_KLC_LET if was zero
0265+  BC9E             	
0266+  BC9E 28 03       	JR Z, K_E_LET                ; to K_E_LET if was 1 for extended letters.
0267+  BCA0             	
0268+  BCA0             	; proceed with graphic codes.
0269+  BCA0             	; Note. should selectively drop return address if code > 'U' ($55).
0270+  BCA0             	; i.e. abort the KEYBOARD call.
0271+  BCA0             	; e.g. cp 'V'; jr c addit; pop af; ;;addit etc. (5 bytes of instruction).
0272+  BCA0             	; (S_INKEY never gets into graphics mode.)
0273+  BCA0             	
0274+  BCA0             	;; addit
0275+  BCA0 C6 4F       	ADD A, $4F                   ; add offset to augment 'A' to graphics A say.
0276+  BCA2 C9          	RET                          ; return.
0277+  BCA3             	; Note. ( but [GRAPH] V gives RND, etc ).
0278+  BCA3             	
0279+  BCA3             	; the jump was to here with extended mode with uppercase A - Z.
0280+  BCA3             	
0281+  BCA3             	;;;$0341
0282+  BCA3 21 6D BE    K_E_LET:  LD HL, E_UNSHIFT - $41; base address of E_UNSHIFT - $41
0283+  BCA6             	; ( $01EB in standard ROM )
0284+  BCA6 04          	INC B                        ; test B is it empty i.e. not a shift
0285+  BCA7 28 03       	JR Z, K_LOOK_UP              ; forward to K_LOOK_UP if neither shift
0286+  BCA9             	
0287+  BCA9 21 87 BE    	LD HL, EXT_SHIFT - $41       ; Address: $0205 EXT_SHIFT - $41 base
0288+  BCAC             	
0289+  BCAC             	;;;$034A
0290+  BCAC 16 00       K_LOOK_UP:  LD D, $00          ; prepare to index
0291+  BCAE 19          	ADD HL, DE                   ; add the main key value
0292+  BCAF 7E          	LD A, (HL)                   ; pick up other mode value
0293+  BCB0 C9          	RET                          ; return
0294+  BCB1             	
0295+  BCB1             	; the jump was here with mode = 0
0296+  BCB1             	
0297+  BCB1             	;;;$034F
0298+  BCB1 21 AB BE    K_KLC_LET:  LD HL, SYM_CODES - $41; prepare base of SYM_CODES
0299+  BCB4 CB 40       	BIT 0, B                     ; shift=$27 sym - shift=$18
0300+  BCB6 28 F4       	JR Z, K_LOOK_UP              ; back to K_LOOK_UP with symbol - shift
0301+  BCB8             	
0302+  BCB8 CB 5A       	BIT 3, D                     ; test FLAGS is it 'K' mode (from OUT_CURS)
0303+  BCBA 28 0A       	JR Z, K_TOKENS               ; skip to K_TOKENS if so
0304+  BCBC             	
0305+  BCBC FD CB 30 5E 	BIT 3, (IY + $30)            ; test FLAGS2 - consider CAPS LOCK ?
0306+  BCC0 C0          	RET NZ                       ; return if so with main code.
0307+  BCC1             	
0308+  BCC1 04          	INC B                        ; is shift being pressed ?
0309+  BCC2             	; result zero if not
0310+  BCC2 C0          	RET NZ                       ; return if shift pressed.
0311+  BCC3             	
0312+  BCC3 C6 20       	ADD A, $20                   ; else convert the code to lower case.
0313+  BCC5 C9          	RET                          ; return.
0314+  BCC6             	
0315+  BCC6             	; the jump was here for tokens
0316+  BCC6             	
0317+  BCC6             	;;;$0364
0318+  BCC6 C6 A5       K_TOKENS:  ADD A, $A5          ; add offset to main code so that 'A'
0319+  BCC8             	; becomes 'NEW' etc.
0320+  BCC8 C9          	RET                          ; return
0321+  BCC9             	
0322+  BCC9             	; the jump was here with digits, space, enter and symbol shift (< $xx)
0323+  BCC9             	
0324+  BCC9             	;;;$0367
0325+  BCC9 FE 30       K_DIGIT:  CP $30               ; is it '0' or higher ?
0326+  BCCB D8          	RET C                        ; return with space, enter and symbol - shift
0327+  BCCC             	
0328+  BCCC 0D          	DEC C                        ; test MODE (was 0='KLC', 1='E', 2='G')
0329+  BCCD FA FF BC    	JP M, K_KLC_DGT              ; jump to K_KLC_DGT if was 0.
0330+  BCD0             	
0331+  BCD0 20 19       	JR NZ, K_GRA_DGT             ; forward to K_GRA_DGT if mode was 2.
0332+  BCD2             	
0333+  BCD2             	; continue with extended digits 0 - 9.
0334+  BCD2             	
0335+  BCD2 21 D6 BE    	LD HL, E_DIGITS - $30        ; $0254 - base of E_DIGITS
0336+  BCD5 CB 68       	BIT 5, B                     ; test - shift=$27 sym - shift=$18
0337+  BCD7 28 D3       	JR Z, K_LOOK_UP              ; to K_LOOK_UP if sym - shift
0338+  BCD9             	
0339+  BCD9 FE 38       	CP $38                       ; is character '8' ?
0340+  BCDB 30 07       	JR NC, K_8_AND_9             ; to K_8_AND_9 if greater than '7'
0341+  BCDD             	
0342+  BCDD D6 20       	SUB $20                      ; reduce to ink range $10 - $17
0343+  BCDF 04          	INC B                        ; shift ?
0344+  BCE0 C8          	RET Z                        ; return if not.
0345+  BCE1             	
0346+  BCE1 C6 08       	ADD A, $08                   ; add 8 to give paper range $18 - $1F
0347+  BCE3 C9          	RET                          ; return
0348+  BCE4             	
0349+  BCE4             	; 89
0350+  BCE4             	
0351+  BCE4             	;;;$0382
0352+  BCE4 D6 36       K_8_AND_9:  SUB $36            ; reduce to 02 and 03 bright codes
0353+  BCE6 04          	INC B                        ; test if shift pressed.
0354+  BCE7 C8          	RET Z                        ; return if not.
0355+  BCE8             	
0356+  BCE8 C6 FE       	ADD A, $FE                   ; subtract 2 setting carry
0357+  BCEA C9          	RET                          ; to give 0 and 1 flash codes.
0358+  BCEB             	
0359+  BCEB             	; graphics mode with digits
0360+  BCEB             	
0361+  BCEB             	;;;$0389
0362+  BCEB 21 B2 BE    K_GRA_DGT:  LD HL, CTL_CODES - $30; $0230 base address of CTL_CODES
0363+  BCEE             	
0364+  BCEE FE 39       	CP $39                       ; is key '9' ?
0365+  BCF0 28 BA       	JR Z, K_LOOK_UP              ; back to K_LOOK_UP - changed to $0F, GRAPHICS.
0366+  BCF2             	
0367+  BCF2 FE 30       	CP $30                       ; is key '0' ?
0368+  BCF4 28 B6       	JR Z, K_LOOK_UP              ; back to K_LOOK_UP - changed to $0C, delete.
0369+  BCF6             	
0370+  BCF6             	; for keys '0' - '7' we assign a mosaic character depending on shift.
0371+  BCF6             	
0372+  BCF6 E6 07       	AND $07                      ; convert character to number. 0 - 7.
0373+  BCF8 C6 80       	ADD A, $80                   ; add offset - they start at $80
0374+  BCFA 04          	INC B                        ; destructively test for shift
0375+  BCFB C8          	RET Z                        ; and return if not pressed.
0376+  BCFC             	
0377+  BCFC EE 0F       	XOR $0F                      ; toggle bits becomes range $88 - $8F
0378+  BCFE C9          	RET                          ; return.
0379+  BCFF             	
0380+  BCFF             	; now digits in 'KLC' mode
0381+  BCFF             	
0382+  BCFF             	;;;$039D
0383+  BCFF 04          K_KLC_DGT:  INC B              ; return with digit codes if neither
0384+  BD00 C8          	RET Z                        ; shift key pressed.
0385+  BD01             	
0386+  BD01 CB 68       	BIT 5, B                     ; test for caps shift.
0387+  BD03 21 B2 BE    	LD HL, CTL_CODES - $30       ; prepare base of table CTL_CODES.
0388+  BD06 20 A4       	JR NZ, K_LOOK_UP             ; back to K_LOOK_UP if shift pressed.
0389+  BD08             	
0390+  BD08             	; must have been symbol shift
0391+  BD08             	
0392+  BD08 D6 10       	SUB $10                      ; for ascii most will now be correct
0393+  BD0A             	; on a standard typewriter.
0394+  BD0A FE 22       	CP $22                       ; but '@' is not - see below.
0395+  BD0C 28 06       	JR Z, K_AT_CHAR              ; forward to to K_AT_CHAR if so
0396+  BD0E             	
0397+  BD0E FE 20       	CP $20                       ; '_' is the other one that fails
0398+  BD10 C0          	RET NZ                       ; return if not.
0399+  BD11             	
0400+  BD11 3E 5F       	LD A, $5F                    ; substitute ascii '_'
0401+  BD13 C9          	RET                          ; return.
0402+  BD14             	
0403+  BD14             	;;;$03B2
0404+  BD14 3E 40       K_AT_CHAR:  LD A, $40          ; substitute ascii '@'
0405+  BD16 C9          	RET                          ; return.
0406+  BD17             	
0407+  BD17             	
0408+  BD17             	; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
0409+  BD17             	; The Spectrum Input character keys. One or two are abbreviated.
0410+  BD17             	; From $00 Flash 0 to $FF COPY. The routine above has decoded all these.
0411+  BD17             	
0412+  BD17             	; | 00 Fl0| 01 Fl1| 02 Br0| 03 Br1| 04 In0| 05 In1| 06 CAP| 07 EDT|
0413+  BD17             	; | 08 LFT| 09 RIG| 0A DWN| 0B UP | 0C DEL| 0D ENT| 0E SYM| 0F GRA|
0414+  BD17             	; | 10 Ik0| 11 Ik1| 12 Ik2| 13 Ik3| 14 Ik4| 15 Ik5| 16 Ik6| 17 Ik7|
0415+  BD17             	; | 18 Pa0| 19 Pa1| 1A Pa2| 1B Pa3| 1C Pa4| 1D Pa5| 1E Pa6| 1F Pa7|
0416+  BD17             	; | 20 SP | 21 ! | 22 " | 23 # | 24 $ | 25 % | 26 & | 27 ' |
0417+  BD17             	; | 28 ( | 29 ) | 2A * | 2B + | 2C, | 2D - | 2E . | 2F / |
0418+  BD17             	; | 30 0 | 31 1 | 32 2 | 33 3 | 34 4 | 35 5 | 36 6 | 37 7 |
0419+  BD17             	; | 38 8 | 39 9 | 3A : | 3B ; | 3C < | 3D = | 3E > | 3F ? |
0420+  BD17             	; | 40 @ | 41 A | 42 B | 43 C | 44 D | 45 E | 46 F | 47 G |
0421+  BD17             	; | 48 H | 49 I | 4A J | 4B K | 4C L | 4D M | 4E N | 4F O |
0422+  BD17             	; | 50 P | 51 Q | 52 R | 53 S | 54 T | 55 U | 56 V | 57 W |
0423+  BD17             	; | 58 X | 59 Y | 5A Z | 5B [ | 5C \ | 5D ] | 5E ^ | 5F _ |
0424+  BD17             	; | 60 ukp| 61 a | 62 b | 63 c | 64 d | 65 e | 66 f | 67 g |
0425+  BD17             	; | 68 h | 69 i | 6A j | 6B k | 6C l | 6D m | 6E n | 6F o |
0426+  BD17             	; | 70 p | 71 q | 72 r | 73 s | 74 t | 75 u | 76 v | 77 w |
0427+  BD17             	; | 78 x | 79 y | 7A z | 7B { | 7C | | 7D } | 7E ~ | 7F (c)|
0428+  BD17             	; | 80 128| 81 129| 82 130| 83 131| 84 132| 85 133| 86 134| 87 135|
0429+  BD17             	; | 88 136| 89 137| 8A 138| 8B 139| 8C 140| 8D 141| 8E 142| 8F 143|
0430+  BD17             	; | 90 [A]| 91 [B]| 92 [C]| 93 [D]| 94 [E]| 95 [F]| 96 [G]| 97 [H]|
0431+  BD17             	; | 98 [I]| 99 [J]| 9A [K]| 9B [L]| 9C [M]| 9D [N]| 9E [O]| 9F [P]|
0432+  BD17             	; | A0 [Q]| A1 [R]| A2 [S]| A3 [T]| A4 [U]| A5 RND| A6 IK$| A7 PI |
0433+  BD17             	; | A8 FN | A9 PNT| AA SC$| AB ATT| AC AT | AD TAB| AE VL$| AF COD|
0434+  BD17             	; | B0 VAL| B1 LEN| B2 SIN| B3 COS| B4 TAN| B5 ASN| B6 ACS| B7 ATN|
0435+  BD17             	; | B8 LN | B9 EXP| BA INT| BB SQR| BC SGN| BD ABS| BE PEK| BF IN |
0436+  BD17             	; | C0 USR| C1 ST$| C2 CH$| C3 NOT| C4 BIN| C5 OR | C6 AND| C7 <= |
0437+  BD17             	; | C8 >= | C9 <> | CA LIN| CB THN| CC TO | CD STP| CE DEF| CF CAT|
0438+  BD17             	; | D0 FMT| D1 MOV| D2 ERS| D3 OPN| D4 CLO| D5 MRG| D6 VFY| D7 BEP|
0439+  BD17             	; | D8 CIR| D9 INK| DA PAP| DB FLA| DC BRI| DD INV| DE OVR| DF OUT|
0440+  BD17             	; | E0 LPR| E1 LLI| E2 STP| E3 REA| E4 DAT| E5 RES| E6 NEW| E7 BDR|
0441+  BD17             	; | E8 CON| E9 DIM| EA REM| EB FOR| EC GTO| ED GSB| EE INP| EF LOA|
0442+  BD17             	; | F0 LIS| F1 LET| F2 PAU| F3 NXT| F4 POK| F5 PRI| F6 PLO| F7 RUN|
0443+  BD17             	; | F8 SAV| F9 RAN| FA IF | FB CLS| FC DRW| FD CLR| FE RET| FF CPY|
0444+  BD17             	
0445+  BD17             	; Note that for simplicity, Sinclair have located all the control codes
0446+  BD17             	; below the space character.
0447+  BD17             	; ascii DEL, $7F, has been made a copyright symbol.
0448+  BD17             	; Also $60, '`', not used in Basic but used in other languages, has been
0449+  BD17             	; allocated the local currency symbol for the relevant country - 
0450+  BD17             	; ukp in most Spectrums.
0451+  BD17             	
0452+  BD17             	; - - - - - - - - - - - - - 
0453+  BD17             	; Token tables
0454+  BD17             	; - - - - - - - - - - - - - 
0455+  BD17             	; The tokenized characters 134d (RND) to 255d (COPY) are expanded using
0456+  BD17             	; this table. The last byte of a token is inverted to denote the end of
0457+  BD17             	; the word. The first is an inverted step - over byte.
0458+  BD17             	
0459+  BD17             	;;;$0095
0460+  BD17 BF          TKN_TABLE:  DEFB '?' + $80
0461+  BD18 52 4E C4    	DEFB "RN", 'D' + $80
0462+  BD1B             	DEFB "INKEY", '$' + $80
0462+  BD1B 494E4B4559A4
0463+  BD21 50 C9       	DEFB "P", 'I' + $80
0464+  BD23 46 CE       	DEFB "F", 'N' + $80
0465+  BD25 504F494ED4  	DEFB "POIN", 'T' + $80
0466+  BD2A             	DEFB "SCREEN", '$' + $80
0466+  BD2A 53435245454EA4
0467+  BD31 41 54 54 D2 	DEFB "ATT", 'R' + $80
0468+  BD35 41 D4       	DEFB "A", 'T' + $80
0469+  BD37 54 41 C2    	DEFB "TA", 'B' + $80
0470+  BD3A 56 41 4C A4 	DEFB "VAL", '$' + $80
0471+  BD3E 43 4F 44 C5 	DEFB "COD", 'E' + $80
0472+  BD42 56 41 CC    	DEFB "VA", 'L' + $80
0473+  BD45 4C 45 CE    	DEFB "LE", 'N' + $80
0474+  BD48 53 49 CE    	DEFB "SI", 'N' + $80
0475+  BD4B 43 4F D3    	DEFB "CO", 'S' + $80
0476+  BD4E 54 41 CE    	DEFB "TA", 'N' + $80
0477+  BD51 41 53 CE    	DEFB "AS", 'N' + $80
0478+  BD54 41 43 D3    	DEFB "AC", 'S' + $80
0479+  BD57 41 54 CE    	DEFB "AT", 'N' + $80
0480+  BD5A 4C CE       	DEFB "L", 'N' + $80
0481+  BD5C 45 58 D0    	DEFB "EX", 'P' + $80
0482+  BD5F 49 4E D4    	DEFB "IN", 'T' + $80
0483+  BD62 53 51 D2    	DEFB "SQ", 'R' + $80
0484+  BD65 53 47 CE    	DEFB "SG", 'N' + $80
0485+  BD68 41 42 D3    	DEFB "AB", 'S' + $80
0486+  BD6B 50 45 45 CB 	DEFB "PEE", 'K' + $80
0487+  BD6F 49 CE       	DEFB "I", 'N' + $80
0488+  BD71 55 53 D2    	DEFB "US", 'R' + $80
0489+  BD74 53 54 52 A4 	DEFB "STR", '$' + $80
0490+  BD78 43 48 52 A4 	DEFB "CHR", '$' + $80
0491+  BD7C 4E 4F D4    	DEFB "NO", 'T' + $80
0492+  BD7F 42 49 CE    	DEFB "BI", 'N' + $80
0493+  BD82             	
0494+  BD82             	; The previous 32 function - type words are printed without a leading space
0495+  BD82             	; The following have a leading space if they begin with a letter
0496+  BD82             	
0497+  BD82 4F D2       	DEFB "O", 'R' + $80
0498+  BD84 41 4E C4    	DEFB "AN", 'D' + $80
0499+  BD87 3C BD       	DEFB $3C, '=' + $80          ; <=
0500+  BD89 3E BD       	DEFB $3E, '=' + $80          ; >=
0501+  BD8B 3C BE       	DEFB $3C, $3E + $80          ; <>
0502+  BD8D 4C 49 4E C5 	DEFB "LIN", 'E' + $80
0503+  BD91 54 48 45 CE 	DEFB "THE", 'N' + $80
0504+  BD95 54 CF       	DEFB "T", 'O' + $80
0505+  BD97 53 54 45 D0 	DEFB "STE", 'P' + $80
0506+  BD9B             	DEFB "DEF F", 'N' + $80
0506+  BD9B 4445462046CE
0507+  BDA1 43 41 D4    	DEFB "CA", 'T' + $80
0508+  BDA4             	DEFB "FORMA", 'T' + $80
0508+  BDA4 464F524D41D4
0509+  BDAA 4D 4F 56 C5 	DEFB "MOV", 'E' + $80
0510+  BDAE 45524153C5  	DEFB "ERAS", 'E' + $80
0511+  BDB3             	DEFB "OPEN ", '#' + $80
0511+  BDB3 4F50454E20A3
0512+  BDB9             	DEFB "CLOSE ", '#' + $80
0512+  BDB9 434C4F534520A3
0513+  BDC0 4D455247C5  	DEFB "MERG", 'E' + $80
0514+  BDC5             	DEFB "VERIF", 'Y' + $80
0514+  BDC5 5645524946D9
0515+  BDCB 42 45 45 D0 	DEFB "BEE", 'P' + $80
0516+  BDCF             	DEFB "CIRCL", 'E' + $80
0516+  BDCF 434952434CC5
0517+  BDD5 49 4E CB    	DEFB "IN", 'K' + $80
0518+  BDD8 50415045D2  	DEFB "PAPE", 'R' + $80
0519+  BDDD 464C4153C8  	DEFB "FLAS", 'H' + $80
0520+  BDE2             	DEFB "BRIGH", 'T' + $80
0520+  BDE2 4252494748D4
0521+  BDE8             	DEFB "INVERS", 'E' + $80
0521+  BDE8 494E56455253C5
0522+  BDEF 4F 56 45 D2 	DEFB "OVE", 'R' + $80
0523+  BDF3 4F 55 D4    	DEFB "OU", 'T' + $80
0524+  BDF6             	DEFB "LPRIN", 'T' + $80
0524+  BDF6 4C5052494ED4
0525+  BDFC 4C4C4953D4  	DEFB "LLIS", 'T' + $80
0526+  BE01 53 54 4F D0 	DEFB "STO", 'P' + $80
0527+  BE05 52 45 41 C4 	DEFB "REA", 'D' + $80
0528+  BE09 44 41 54 C1 	DEFB "DAT", 'A' + $80
0529+  BE0D             	DEFB "RESTOR", 'E' + $80
0529+  BE0D 524553544F52C5
0530+  BE14 4E 45 D7    	DEFB "NE", 'W' + $80
0531+  BE17             	DEFB "BORDE", 'R' + $80
0531+  BE17 424F524445D2
0532+  BE1D             	DEFB "CONTINU", 'E' + $80
0532+  BE1D 434F4E54494E55C5
0533+  BE25 44 49 CD    	DEFB "DI", 'M' + $80
0534+  BE28 52 45 CD    	DEFB "RE", 'M' + $80
0535+  BE2B 46 4F D2    	DEFB "FO", 'R' + $80
0536+  BE2E 474F2054CF  	DEFB "GO T", 'O' + $80
0537+  BE33             	DEFB "GO SU", 'B' + $80
0537+  BE33 474F205355C2
0538+  BE39 494E5055D4  	DEFB "INPU", 'T' + $80
0539+  BE3E 4C 4F 41 C4 	DEFB "LOA", 'D' + $80
0540+  BE42 4C 49 53 D4 	DEFB "LIS", 'T' + $80
0541+  BE46 4C 45 D4    	DEFB "LE", 'T' + $80
0542+  BE49 50415553C5  	DEFB "PAUS", 'E' + $80
0543+  BE4E 4E 45 58 D4 	DEFB "NEX", 'T' + $80
0544+  BE52 50 4F 4B C5 	DEFB "POK", 'E' + $80
0545+  BE56 5052494ED4  	DEFB "PRIN", 'T' + $80
0546+  BE5B 50 4C 4F D4 	DEFB "PLO", 'T' + $80
0547+  BE5F 52 55 CE    	DEFB "RU", 'N' + $80
0548+  BE62 53 41 56 C5 	DEFB "SAV", 'E' + $80
0549+  BE66             	DEFB "RANDOMIZ", 'E' + $80
0549+  BE66 52414E444F4D495AC5
0550+  BE6F 49 C6       	DEFB "I", 'F' + $80
0551+  BE71 43 4C D3    	DEFB "CL", 'S' + $80
0552+  BE74 44 52 41 D7 	DEFB "DRA", 'W' + $80
0553+  BE78 434C4541D2  	DEFB "CLEA", 'R' + $80
0554+  BE7D             	DEFB "RETUR", 'N' + $80
0554+  BE7D 5245545552CE
0555+  BE83 43 4F 50 D9 	DEFB "COP", 'Y' + $80
0556+  BE87             	
0557+  BE87             	; - - - - - - - - - - - 
0558+  BE87             	; Key tables
0559+  BE87             	; - - - - - - - - - - - 
0560+  BE87             	; These six look - up tables are used by the keyboard reading routine
0561+  BE87             	; to decode the key values.
0562+  BE87             	
0563+  BE87             	; The first table contains the maps for the 39 keys of the standard
0564+  BE87             	; 40 - key Spectrum keyboard. The remaining key [SHIFT $27] is read directly.
0565+  BE87             	; The keys consist of the 26 upper - case alphabetic characters, the 10 digit
0566+  BE87             	; keys and the space, ENTER and symbol shift key.
0567+  BE87             	; Unshifted alphabetic keys have $20 added to the value.
0568+  BE87             	; The keywords for the main alphabetic keys are obtained by adding $A5 to
0569+  BE87             	; the values obtained from this table.
0570+  BE87             	
0571+  BE87             	;;;$0205
0572+  BE87 42          MAIN_KEYS:  DEFB $42           ; B
0573+  BE88 48          	DEFB $48                     ; H
0574+  BE89 59          	DEFB $59                     ; Y
0575+  BE8A 36          	DEFB $36                     ; 6
0576+  BE8B 35          	DEFB $35                     ; 5
0577+  BE8C 54          	DEFB $54                     ; T
0578+  BE8D 47          	DEFB $47                     ; G
0579+  BE8E 56          	DEFB $56                     ; V
0580+  BE8F 4E          	DEFB $4E                     ; N
0581+  BE90 4A          	DEFB $4A                     ; J
0582+  BE91 55          	DEFB $55                     ; U
0583+  BE92 37          	DEFB $37                     ; 7
0584+  BE93 34          	DEFB $34                     ; 4
0585+  BE94 52          	DEFB $52                     ; R
0586+  BE95 46          	DEFB $46                     ; F
0587+  BE96 43          	DEFB $43                     ; C
0588+  BE97 4D          	DEFB $4D                     ; M
0589+  BE98 4B          	DEFB $4B                     ; K
0590+  BE99 49          	DEFB $49                     ; I
0591+  BE9A 38          	DEFB $38                     ; 8
0592+  BE9B 33          	DEFB $33                     ; 3
0593+  BE9C 45          	DEFB $45                     ; E
0594+  BE9D 44          	DEFB $44                     ; D
0595+  BE9E 58          	DEFB $58                     ; X
0596+  BE9F 0E          	DEFB $0E                     ; SYMBOL SHIFT
0597+  BEA0 4C          	DEFB $4C                     ; L
0598+  BEA1 4F          	DEFB $4F                     ; O
0599+  BEA2 39          	DEFB $39                     ; 9
0600+  BEA3 32          	DEFB $32                     ; 2
0601+  BEA4 57          	DEFB $57                     ; W
0602+  BEA5 53          	DEFB $53                     ; S
0603+  BEA6 5A          	DEFB $5A                     ; Z
0604+  BEA7 20          	DEFB $20                     ; SPACE
0605+  BEA8 0D          	DEFB $0D                     ; ENTER
0606+  BEA9 50          	DEFB $50                     ; P
0607+  BEAA 30          	DEFB $30                     ; 0
0608+  BEAB 31          	DEFB $31                     ; 1
0609+  BEAC 51          	DEFB $51                     ; Q
0610+  BEAD 41          	DEFB $41                     ; A
0611+  BEAE             	
0612+  BEAE             	;;;$022C
0613+  BEAE             	; The 26 unshifted extended mode keys for the alphabetic characters.
0614+  BEAE             	; The green keywords on the original keyboard.
0615+  BEAE E3          E_UNSHIFT:  DEFB $E3           ; READ
0616+  BEAF C4          	DEFB $C4                     ; BIN
0617+  BEB0 E0          	DEFB $E0                     ; LPRINT
0618+  BEB1 E4          	DEFB $E4                     ; DATA
0619+  BEB2 B4          	DEFB $B4                     ; TAN
0620+  BEB3 BC          	DEFB $BC                     ; SGN
0621+  BEB4 BD          	DEFB $BD                     ; ABS
0622+  BEB5 BB          	DEFB $BB                     ; SQR
0623+  BEB6 AF          	DEFB $AF                     ; CODE
0624+  BEB7 B0          	DEFB $B0                     ; VAL
0625+  BEB8 B1          	DEFB $B1                     ; LEN
0626+  BEB9 C0          	DEFB $C0                     ; USR
0627+  BEBA A7          	DEFB $A7                     ; PI
0628+  BEBB A6          	DEFB $A6                     ; INKEY$
0629+  BEBC BE          	DEFB $BE                     ; PEEK
0630+  BEBD AD          	DEFB $AD                     ; TAB
0631+  BEBE B2          	DEFB $B2                     ; SIN
0632+  BEBF BA          	DEFB $BA                     ; INT
0633+  BEC0 E5          	DEFB $E5                     ; RESTORE
0634+  BEC1 A5          	DEFB $A5                     ; RND
0635+  BEC2 C2          	DEFB $C2                     ; CHR$
0636+  BEC3 E1          	DEFB $E1                     ; LLIST
0637+  BEC4 B3          	DEFB $B3                     ; COS
0638+  BEC5 B9          	DEFB $B9                     ; EXP
0639+  BEC6 C1          	DEFB $C1                     ; STR$
0640+  BEC7 B8          	DEFB $B8                     ; LN
0641+  BEC8             	
0642+  BEC8             	;;;$0246
0643+  BEC8             	; The 26 shifted extended mode keys for the alphabetic characters.
0644+  BEC8             	; The red keywords below keys on the original keyboard.
0645+  BEC8 7E          EXT_SHIFT:  DEFB $7E           ; ~
0646+  BEC9 DC          	DEFB $DC                     ; BRIGHT
0647+  BECA DA          	DEFB $DA                     ; PAPER
0648+  BECB 5C          	DEFB $5C                     ; \ ;
0649+  BECC B7          	DEFB $B7                     ; ATN
0650+  BECD 7B          	DEFB $7B                     ; {
0651+  BECE 7D          	DEFB $7D                     ; }
0652+  BECF D8          	DEFB $D8                     ; CIRCLE
0653+  BED0 BF          	DEFB $BF                     ; IN
0654+  BED1 AE          	DEFB $AE                     ; VAL$
0655+  BED2 AA          	DEFB $AA                     ; SCREEN$
0656+  BED3 AB          	DEFB $AB                     ; ATTR
0657+  BED4 DD          	DEFB $DD                     ; INVERSE
0658+  BED5 DE          	DEFB $DE                     ; OVER
0659+  BED6 DF          	DEFB $DF                     ; OUT
0660+  BED7 7F          	DEFB $7F                     ; (Copyright character)
0661+  BED8 B5          	DEFB $B5                     ; ASN
0662+  BED9 D6          	DEFB $D6                     ; VERIFY
0663+  BEDA 7C          	DEFB $7C                     ; |
0664+  BEDB D5          	DEFB $D5                     ; MERGE
0665+  BEDC 5D          	DEFB $5D                     ; ]
0666+  BEDD DB          	DEFB $DB                     ; FLASH
0667+  BEDE B6          	DEFB $B6                     ; ACS
0668+  BEDF D9          	DEFB $D9                     ; INK
0669+  BEE0 5B          	DEFB $5B                     ; [
0670+  BEE1 D7          	DEFB $D7                     ; BEEP
0671+  BEE2             	
0672+  BEE2             	;;;$0260
0673+  BEE2             	; The ten control codes assigned to the top line of digits when the shift
0674+  BEE2             	; key is pressed.
0675+  BEE2 0C          CTL_CODES:  DEFB $0C           ; DELETE
0676+  BEE3 07          	DEFB $07                     ; EDIT
0677+  BEE4 06          	DEFB $06                     ; CAPS LOCK
0678+  BEE5 04          	DEFB $04                     ; TRUE VIDEO
0679+  BEE6 05          	DEFB $05                     ; INVERSE VIDEO
0680+  BEE7 08          	DEFB $08                     ; CURSOR LEFT
0681+  BEE8 0A          	DEFB $0A                     ; CURSOR DOWN
0682+  BEE9 0B          	DEFB $0B                     ; CURSOR UP
0683+  BEEA 09          	DEFB $09                     ; CURSOR RIGHT
0684+  BEEB 0F          	DEFB $0F                     ; GRAPHICS
0685+  BEEC             	
0686+  BEEC             	;;;$026A
0687+  BEEC             	; The 26 red symbols assigned to the alphabetic characters of the keyboard.
0688+  BEEC             	; The ten single - character digit symbols are converted without the aid of
0689+  BEEC             	; a table using subtraction and minor manipulation.
0690+  BEEC E2          SYM_CODES:  DEFB $E2           ; STOP
0691+  BEED 2A          	DEFB $2A                     ; * 
0692+  BEEE 3F          	DEFB $3F                     ; ?
0693+  BEEF CD          	DEFB $CD                     ; STEP
0694+  BEF0 C8          	DEFB $C8                     ; >=
0695+  BEF1 CC          	DEFB $CC                     ; TO
0696+  BEF2 CB          	DEFB $CB                     ; THEN
0697+  BEF3 5E          	DEFB $5E                     ; ^
0698+  BEF4 AC          	DEFB $AC                     ; AT
0699+  BEF5 2D          	DEFB $2D                     ; - 
0700+  BEF6 2B          	DEFB $2B                     ; + 
0701+  BEF7 3D          	DEFB $3D                     ; =
0702+  BEF8 2E          	DEFB $2E                     ; .
0703+  BEF9 2C          	DEFB $2C                     ;, 
0704+  BEFA 3B          	DEFB $3B                     ; ;
0705+  BEFB 22          	DEFB $22                     ; "
0706+  BEFC C7          	DEFB $C7                     ; <=
0707+  BEFD 3C          	DEFB $3C                     ; <
0708+  BEFE C3          	DEFB $C3                     ; NOT
0709+  BEFF 3E          	DEFB $3E                     ; >
0710+  BF00 C5          	DEFB $C5                     ; OR
0711+  BF01 2F          	DEFB $2F                     ; / 
0712+  BF02 C9          	DEFB $C9                     ; <>
0713+  BF03 60          	DEFB $60                     ; pound
0714+  BF04 C6          	DEFB $C6                     ; AND
0715+  BF05 3A          	DEFB $3A                     ; :
0716+  BF06             	
0717+  BF06             	;;;$0284
0718+  BF06             	; The ten keywords assigned to the digits in extended mode.
0719+  BF06             	; The remaining red keywords below the keys.
0720+  BF06 D0          E_DIGITS:  DEFB $D0            ; FORMAT
0721+  BF07 CE          	DEFB $CE                     ; DEF FN
0722+  BF08 A8          	DEFB $A8                     ; FN
0723+  BF09 CA          	DEFB $CA                     ; LINE
0724+  BF0A D3          	DEFB $D3                     ; OPEN#
0725+  BF0B D4          	DEFB $D4                     ; CLOSE#
0726+  BF0C D1          	DEFB $D1                     ; MOVE
0727+  BF0D D2          	DEFB $D2                     ; ERASE
0728+  BF0E A9          	DEFB $A9                     ; POINT
0729+  BF0F CF          	DEFB $CF                     ; CAT
0730+  BF10             	
0731+  BF10             	endmodule
0732+  BF10             
2918   BF10                                                         include screen.asm
0001+  BF10             	module SCREEN
0002+  BF10             	
0003+  BF10 00          POS_Y:  db 0
0004+  BF11 00          POS_X:  db 0
0005+  BF12 00          WRAP:  db 0
0006+  BF13             	
0007+  BF13             	; clear screen with border
0008+  BF13             	; A - color
0009+  BF13 21 00 40    CLEAR:  LD HL, 16384           ; Start address of screen bitmap
0010+  BF16 11 01 40    	LD DE, 16385                 ; Address + 1
0011+  BF19 01 00 18    	LD BC, 6144                  ; Length of bitmap memory to clear
0012+  BF1C 36 00       	LD (HL), 0                   ; Set the first byte to 0
0013+  BF1E ED B0       	LDIR                         ; Copy this byte to the second, and so on
0014+  BF20 01 FF 02    	LD BC, 767                   ; Length of attribute memory, less one to clear
0015+  BF23 77          	LD (HL), A                   ; Set the first byte to A
0016+  BF24 ED B0       	LDIR                         ; Copy this byte to the second, and so on
0017+  BF26 1F          	RRA
0018+  BF27 1F          	RRA
0019+  BF28 1F          	RRA
0020+  BF29 D3 FE       	OUT (254), A
0021+  BF2B 21 10 BF    	LD HL, POS_Y
0022+  BF2E 36 00       	ld (HL), 0
0023+  BF30 23          	INC HL
0024+  BF31 36 00       	ld (HL), 0
0025+  BF33 C9          	RET
0026+  BF34             	
0027+  BF34             PRINT_TEXT_WRAP: 
0028+  BF34 AF          	XOR A
0029+  BF35 32 12 BF    	LD (WRAP),A
0030+  BF38 C5          	PUSH BC
0031+  BF39             PRINT_TEXT_WRAP_LOOP: 
0032+  BF39 E5          	PUSH HL
0033+  BF3A 06 00       	LD B, 0
0034+  BF3C 7E          SEARCH_13_LOOP:  LD A, (HL)
0035+  BF3D FE 0D       	CP '\r'
0036+  BF3F 28 0B       	JR Z, DELIM_CHAR_FOUND
0037+  BF41 FE 20       	CP ' '
0038+  BF43 28 07       	JR Z, DELIM_CHAR_FOUND
0039+  BF45 B7          	OR A
0040+  BF46 28 04       	JR Z, DELIM_CHAR_FOUND
0041+  BF48 23          	INC HL
0042+  BF49 04          	INC B
0043+  BF4A 18 F0       	JR SEARCH_13_LOOP
0044+  BF4C             DELIM_CHAR_FOUND: 
0045+  BF4C F5          	PUSH AF
0046+  BF4D 3A 11 BF    	LD A, (POS_X)
0047+  BF50 80          	ADD B
0048+  BF51 FE 21       	CP 33                        ; screen width + 1
0049+  BF53 38 0A       	JR C, PRINT_WORD_WRAP
0050+  BF55 3E 0D       	LD A, '\r'
0051+  BF57 CD E7 BF    	CALL PRINT_CHAR
0052+  BF5A 3E 01       	LD A,1
0053+  BF5C 32 12 BF    	LD (WRAP),A
0054+  BF5F F1          PRINT_WORD_WRAP:  POP AF
0055+  BF60 E1          	POP HL
0056+  BF61 4F          	LD C, A
0057+  BF62             PRINT_WORD_LOOP:  
0058+  BF62 7E          	LD A, (HL)
0059+  BF63 B9          	CP C
0060+  BF64 28 06       	JR Z, PRINT_WORD_END
0061+  BF66 CD E7 BF    	CALL PRINT_CHAR
0062+  BF69 23          	INC HL
0063+  BF6A 18 F6       	JR PRINT_WORD_LOOP
0064+  BF6C             PRINT_WORD_END: 
0065+  BF6C B7          	OR A
0066+  BF6D 28 1D       	JR Z, PRINT_ZERO_EXIT
0067+  BF6F E5          	PUSH HL
0068+  BF70 F5          	PUSH AF
0069+  BF71 3A 12 BF    	LD A,(WRAP)
0070+  BF74 B7          	OR A
0071+  BF75 28 0C       	JR Z,WRAP_NOT_COLUMN
0072+  BF77 3A 11 BF    	LD A,(POS_X)
0073+  BF7A B7          	OR A
0074+  BF7B 20 06       	JR NZ,WRAP_NOT_COLUMN
0075+  BF7D F1          	POP AF
0076+  BF7E FE 20       	CP 32
0077+  BF80 28 05       	JR Z, WRAP_SKIP_SPACE
0078+  BF82 F5          	PUSH AF
0079+  BF83 F1          WRAP_NOT_COLUMN: 	POP AF
0080+  BF84 CD E7 BF    	CALL PRINT_CHAR
0081+  BF87 E1          WRAP_SKIP_SPACE: 	POP HL
0082+  BF88 23          	INC HL
0083+  BF89 18 AE       	JR PRINT_TEXT_WRAP_LOOP
0084+  BF8B             END_CHAR_FOUND: 
0085+  BF8B E1          	POP HL
0086+  BF8C             PRINT_ZERO_EXIT: 	
0087+  BF8C C1          	POP BC
0088+  BF8D C9          	RET
0089+  BF8E             	
0090+  BF8E             	
0091+  BF8E 06 00       LENGTH255:  LD B, 0
0092+  BF90 E5          	PUSH HL
0093+  BF91 7E          LENGTH255_GET:  LD A, (HL)
0094+  BF92 B7          	OR A
0095+  BF93 28 09       	JR Z, LENGTH255_RET
0096+  BF95 23          	INC HL
0097+  BF96 04          	INC B
0098+  BF97 3E FF       	LD A, 255
0099+  BF99 B8          	CP B
0100+  BF9A 28 02       	JR Z, LENGTH255_RET
0101+  BF9C 18 F3       	JR LENGTH255_GET
0102+  BF9E E1          LENGTH255_RET:  POP HL
0103+  BF9F C9          	RET
0104+  BFA0             	
0105+  BFA0 01 00 00    LENGTH:  LD BC, 0
0106+  BFA3 E5          	PUSH HL
0107+  BFA4 7E          LENGTH_GET:  LD A, (HL)
0108+  BFA5 B7          	OR A
0109+  BFA6 28 04       	JR Z, LENGTH_RET
0110+  BFA8 23          	INC HL
0111+  BFA9 03          	INC BC
0112+  BFAA 18 F8       	JR LENGTH_GET
0113+  BFAC E1          LENGTH_RET:  POP HL
0114+  BFAD C9          	RET
0115+  BFAE             	
0116+  BFAE             	;==================================
0117+  BFAE             	; - =  = - 
0118+  BFAE             	; HL -   
0119+  BFAE             	;0 -  
0120+  BFAE             	
0121+  BFAE 7E          PRINT_TEXT:  LD A, (HL)        ;  
0122+  BFAF A7          	AND A                        ;  
0123+  BFB0 C8          	RET Z                        ; - 
0124+  BFB1 E5          	PUSH HL
0125+  BFB2 CD E7 BF    	CALL PRINT_CHAR              ;   
0126+  BFB5 E1          	POP HL
0127+  BFB6 23          	INC HL
0128+  BFB7 18 F5       	JR PRINT_TEXT
0129+  BFB9             	
0130+  BFB9             	;==================================
0131+  BFB9             	; - =  = - 
0132+  BFB9             	;: DE - 
0133+  BFB9             	; HL -   
0134+  BFB9             	; :
0135+  BFB9             	;0 -  
0136+  BFB9             	;17, X, Y -   
0137+  BFB9             	;==================================
0138+  BFB9 7E          PRINT_TEXT_AT:  LD A, (HL)     ;  
0139+  BFBA A7          	AND A                        ;  
0140+  BFBB C8          	RET Z                        ; - 
0141+  BFBC FE 11       	CP 17                        ;  
0142+  BFBE C2 C9 BF    	JP NZ, Pr_Cont
0143+  BFC1 23          	INC HL                       ;  
0144+  BFC2 5E          	LD E, (HL)
0145+  BFC3 23          	INC HL
0146+  BFC4 56          	LD D, (HL)
0147+  BFC5 23          	INC HL
0148+  BFC6 C3 B9 BF    	JP PRINT_TEXT_AT
0149+  BFC9 E5          Pr_Cont:  PUSH HL
0150+  BFCA D5          	PUSH DE
0151+  BFCB CD E7 BF    	CALL PRINT_CHAR              ;   
0152+  BFCE D1          	POP DE
0153+  BFCF E1          	POP HL
0154+  BFD0 1C          	INC E
0155+  BFD1 23          	INC HL
0156+  BFD2 C3 B9 BF    	JP PRINT_TEXT_AT
0157+  BFD5             	
0158+  BFD5             	; print one digit
0159+  BFD5 F5          PRINT_DIGIT:  PUSH AF
0160+  BFD6 E6 0F       	AND 0xf
0161+  BFD8 C6 30       	ADD A, 0x30
0162+  BFDA CD E7 BF    	CALL PRINT_CHAR
0163+  BFDD F1          	POP AF
0164+  BFDE C9          	RET
0165+  BFDF             	
0166+  BFDF F5          PRINT_CR:  PUSH AF
0167+  BFE0 3E 0D       	LD A, '\r'
0168+  BFE2 CD E7 BF    	CALL PRINT_CHAR
0169+  BFE5 F1          	POP AF
0170+  BFE6 C9          	RET
0171+  BFE7             	;=====  88 (fast) =====
0172+  BFE7             	;A -  
0173+  BFE7             PRINT_CHAR: 
0174+  BFE7 E5          	PUSH HL
0175+  BFE8 D5          	PUSH DE
0176+  BFE9 C5          	PUSH BC
0177+  BFEA F5          	PUSH AF
0178+  BFEB FE 0D       	CP '\r'
0179+  BFED 28 06       	JR Z, PRINT_13
0180+  BFEF FE 08       	CP 8
0181+  BFF1 28 07       	JR Z, PRINT_8
0182+  BFF3 18 18       	JR PRINT_SYM
0183+  BFF5 21 11 BF    PRINT_13:  LD HL, POS_X
0184+  BFF8 18 28       	JR LINE_END
0185+  BFFA 21 11 BF    PRINT_8:  LD HL, POS_X
0186+  BFFD 7E          	LD A, (HL)
0187+  BFFE 3D          	DEC A
0188+  BFFF 77          	LD (HL), A
0189+  C000 FE FF       	CP 255
0190+  C002 20 32       	JR NZ, PRINT_RET
0191+  C004 36 00       	LD (HL), 0
0192+  C006 23          	INC HL
0193+  C007 7E          	LD A, (HL)
0194+  C008 3D          	DEC A
0195+  C009 FE FF       	CP 255
0196+  C00B 18 29       	JR PRINT_RET
0197+  C00D 21 10 BF    PRINT_SYM:  LD HL, POS_Y
0198+  C010 56          	LD D, (HL)
0199+  C011 23          	INC HL
0200+  C012 5E          	LD E, (HL)
0201+  C013 CD 3B C0    	CALL PRINT_CHAR_ADDR
0202+  C016 21 11 BF    	LD HL, POS_X
0203+  C019 7E          	LD A, (HL)
0204+  C01A 3C          	INC A
0205+  C01B FE 20       	CP ' '
0206+  C01D 30 03       	JR NC, LINE_END
0207+  C01F 77          	LD (HL), A
0208+  C020 18 14       	JR PRINT_RET
0209+  C022             LINE_END: 
0210+  C022 AF          	XOR A
0211+  C023 77          	LD (HL), A
0212+  C024 2B          	DEC HL
0213+  C025 7E          	LD A, (HL)
0214+  C026 3C          	INC A
0215+  C027 FE 18       	CP 24
0216+  C029 30 03       	JR NC, SCREEN_END
0217+  C02B 77          	LD (HL), A
0218+  C02C 18 08       	JR PRINT_RET
0219+  C02E             SCREEN_END: 
0220+  C02E 3D          	DEC A
0221+  C02F 77          	LD (HL), A
0222+  C030 CD 72 C0    	CALL SCROLL_ALL
0223+  C033 CD 96 C1    	CALL CL_LINE
0224+  C036 F1          PRINT_RET:  POP AF
0225+  C037 C1          	POP BC
0226+  C038 D1          	POP DE
0227+  C039 E1          	POP HL
0228+  C03A C9          	RET
0229+  C03B             	
0230+  C03B             	;=====  88 (fast) =====
0231+  C03B             	;in: DE - , A -  
0232+  C03B             PRINT_CHAR_ADDR: 
0233+  C03B 6F          	LD L, A                      ; HL -   - 
0234+  C03C 26 00       	LD H, 0                      ;,  
0235+  C03E 29          	ADD HL, HL
0236+  C03F 29          	ADD HL, HL
0237+  C040 29          	ADD HL, HL
0238+  C041 01 00 3C    	LD BC, 0x3C00                ; 
0239+  C044 09          	ADD HL, BC                   ;  
0240+  C045 7A          	LD A, D                      ;  
0241+  C046 E6 07       	AND 7                        ; ;)
0242+  C048 0F          	RRCA
0243+  C049 0F          	RRCA
0244+  C04A 0F          	RRCA
0245+  C04B B3          	OR E
0246+  C04C 5F          	LD E, A
0247+  C04D 7A          	LD A, D
0248+  C04E E6 18       	AND 24
0249+  C050 F6 40       	OR 64
0250+  C052 57          	LD D, A
0251+  C053             	DUP 7                        ; ALASM!!!
0252+  C053 7E          >	LD A, (HL)                   ;   
0253+  C054 12          >	LD (DE), A                   ;   
0254+  C055 23          >	INC HL                       ; fnt adr
0255+  C056 14          >	INC D                        ; scr adr
0252+  C057 7E          >	LD A, (HL)                   ;   
0253+  C058 12          >	LD (DE), A                   ;   
0254+  C059 23          >	INC HL                       ; fnt adr
0255+  C05A 14          >	INC D                        ; scr adr
0252+  C05B 7E          >	LD A, (HL)                   ;   
0253+  C05C 12          >	LD (DE), A                   ;   
0254+  C05D 23          >	INC HL                       ; fnt adr
0255+  C05E 14          >	INC D                        ; scr adr
0252+  C05F 7E          >	LD A, (HL)                   ;   
0253+  C060 12          >	LD (DE), A                   ;   
0254+  C061 23          >	INC HL                       ; fnt adr
0255+  C062 14          >	INC D                        ; scr adr
0252+  C063 7E          >	LD A, (HL)                   ;   
0253+  C064 12          >	LD (DE), A                   ;   
0254+  C065 23          >	INC HL                       ; fnt adr
0255+  C066 14          >	INC D                        ; scr adr
0252+  C067 7E          >	LD A, (HL)                   ;   
0253+  C068 12          >	LD (DE), A                   ;   
0254+  C069 23          >	INC HL                       ; fnt adr
0255+  C06A 14          >	INC D                        ; scr adr
0252+  C06B 7E          >	LD A, (HL)                   ;   
0253+  C06C 12          >	LD (DE), A                   ;   
0254+  C06D 23          >	INC HL                       ; fnt adr
0255+  C06E 14          >	INC D                        ; scr adr
0257+  C06F 7E          	LD A, (HL)
0258+  C070 12          	LD (DE), A
0259+  C071 C9          	RET
0260+  C072             	
0261+  C072             	;(c) cooper / RSM / P7S ;...
0262+  C072             	
0263+  C072 11 00 40    SCROLL_ALL:  LD DE, #4000      ;
0264+  C075 21 20 40    	LD HL, #4020                 ;
0265+  C078 06 17       	LD B, #17                    ; -  
0266+  C07A             	
0267+  C07A C5          MAIN:  PUSH BC
0268+  C07B CD B2 C0    	CALL SCROLL                  ; .
0269+  C07E CD 9C C0    	CALL LL693E                  ;  ( . )
0270+  C081 CD A7 C0    	CALL LL6949                  ;  ( . )
0271+  C084 C1          	POP BC
0272+  C085 10 F3       	DJNZ MAIN
0273+  C087 C9          	RET
0274+  C088             	
0275+  C088             	;      
0276+  C088             	; ,  , ok?
0277+  C088 7D          LL692A:  LD A, L
0278+  C089 D6 20       	SUB #20
0279+  C08B 6F          	LD L, A
0280+  C08C D0          	RET NC
0281+  C08D 7C          	LD A, H
0282+  C08E D6 08       	SUB #08
0283+  C090 67          	LD H, A
0284+  C091 C9          	RET
0285+  C092             	
0286+  C092 7B          LL6934:  LD A, E
0287+  C093 D6 20       	SUB #20
0288+  C095 5F          	LD E, A
0289+  C096 D0          	RET NC
0290+  C097 7A          	LD A, D
0291+  C098 D6 08       	SUB #08
0292+  C09A 57          	LD D, A
0293+  C09B C9          	RET
0294+  C09C             	
0295+  C09C 24          LL693E:  INC H
0296+  C09D 7D          	LD A, L
0297+  C09E D6 E0       	SUB #E0
0298+  C0A0 6F          	LD L, A
0299+  C0A1 D0          	RET NC
0300+  C0A2 7C          	LD A, H
0301+  C0A3 D6 08       	SUB #08
0302+  C0A5 67          	LD H, A
0303+  C0A6 C9          	RET
0304+  C0A7             	
0305+  C0A7 14          LL6949:  INC D
0306+  C0A8 7B          	LD A, E
0307+  C0A9 D6 E0       	SUB #E0
0308+  C0AB 5F          	LD E, A
0309+  C0AC D0          	RET NC
0310+  C0AD 7A          	LD A, D
0311+  C0AE D6 08       	SUB #08
0312+  C0B0 57          	LD D, A
0313+  C0B1 C9          	RET
0314+  C0B2             	
0315+  C0B2             	; scroll screen
0316+  C0B2 E5          SCROLL:  PUSH HL
0317+  C0B3 D5          	PUSH DE
0318+  C0B4 7A          	LD A, D
0319+  C0B5 0F          	RRCA
0320+  C0B6 0F          	RRCA
0321+  C0B7 0F          	RRCA
0322+  C0B8 E6 03       	AND #03
0323+  C0BA F6 58       	OR #58
0324+  C0BC 57          	LD D, A
0325+  C0BD 7C          	LD A, H
0326+  C0BE 0F          	RRCA
0327+  C0BF 0F          	RRCA
0328+  C0C0 0F          	RRCA
0329+  C0C1 E6 03       	AND #03
0330+  C0C3 F6 58       	OR #58
0331+  C0C5 67          	LD H, A
0332+  C0C6             	DUP 32
0333+  C0C6 ED A0       >	LDI
0333+  C0C8 ED A0       >	LDI
0333+  C0CA ED A0       >	LDI
0333+  C0CC ED A0       >	LDI
0333+  C0CE ED A0       >	LDI
0333+  C0D0 ED A0       >	LDI
0333+  C0D2 ED A0       >	LDI
0333+  C0D4 ED A0       >	LDI
0333+  C0D6 ED A0       >	LDI
0333+  C0D8 ED A0       >	LDI
0333+  C0DA ED A0       >	LDI
0333+  C0DC ED A0       >	LDI
0333+  C0DE ED A0       >	LDI
0333+  C0E0 ED A0       >	LDI
0333+  C0E2 ED A0       >	LDI
0333+  C0E4 ED A0       >	LDI
0333+  C0E6 ED A0       >	LDI
0333+  C0E8 ED A0       >	LDI
0333+  C0EA ED A0       >	LDI
0333+  C0EC ED A0       >	LDI
0333+  C0EE ED A0       >	LDI
0333+  C0F0 ED A0       >	LDI
0333+  C0F2 ED A0       >	LDI
0333+  C0F4 ED A0       >	LDI
0333+  C0F6 ED A0       >	LDI
0333+  C0F8 ED A0       >	LDI
0333+  C0FA ED A0       >	LDI
0333+  C0FC ED A0       >	LDI
0333+  C0FE ED A0       >	LDI
0333+  C100 ED A0       >	LDI
0333+  C102 ED A0       >	LDI
0333+  C104 ED A0       >	LDI
0335+  C106 D1          	POP DE
0336+  C107 E1          	POP HL
0337+  C108 01 F8 00    	LD BC, #00F8
0338+  C10B C3 10 C1    	JP LOOP2
0339+  C10E 24          LOOP1:  INC H
0340+  C10F 14          	INC D
0341+  C110             LOOP2:  DUP 31
0342+  C110 ED A0       >	LDI
0342+  C112 ED A0       >	LDI
0342+  C114 ED A0       >	LDI
0342+  C116 ED A0       >	LDI
0342+  C118 ED A0       >	LDI
0342+  C11A ED A0       >	LDI
0342+  C11C ED A0       >	LDI
0342+  C11E ED A0       >	LDI
0342+  C120 ED A0       >	LDI
0342+  C122 ED A0       >	LDI
0342+  C124 ED A0       >	LDI
0342+  C126 ED A0       >	LDI
0342+  C128 ED A0       >	LDI
0342+  C12A ED A0       >	LDI
0342+  C12C ED A0       >	LDI
0342+  C12E ED A0       >	LDI
0342+  C130 ED A0       >	LDI
0342+  C132 ED A0       >	LDI
0342+  C134 ED A0       >	LDI
0342+  C136 ED A0       >	LDI
0342+  C138 ED A0       >	LDI
0342+  C13A ED A0       >	LDI
0342+  C13C ED A0       >	LDI
0342+  C13E ED A0       >	LDI
0342+  C140 ED A0       >	LDI
0342+  C142 ED A0       >	LDI
0342+  C144 ED A0       >	LDI
0342+  C146 ED A0       >	LDI
0342+  C148 ED A0       >	LDI
0342+  C14A ED A0       >	LDI
0342+  C14C ED A0       >	LDI
0344+  C14E 7E          	LD A, (HL)
0345+  C14F 12          	LD (DE), A
0346+  C150 24          	INC H
0347+  C151 14          	INC D
0348+  C152             	DUP 31
0349+  C152 ED A8       >	LDD
0349+  C154 ED A8       >	LDD
0349+  C156 ED A8       >	LDD
0349+  C158 ED A8       >	LDD
0349+  C15A ED A8       >	LDD
0349+  C15C ED A8       >	LDD
0349+  C15E ED A8       >	LDD
0349+  C160 ED A8       >	LDD
0349+  C162 ED A8       >	LDD
0349+  C164 ED A8       >	LDD
0349+  C166 ED A8       >	LDD
0349+  C168 ED A8       >	LDD
0349+  C16A ED A8       >	LDD
0349+  C16C ED A8       >	LDD
0349+  C16E ED A8       >	LDD
0349+  C170 ED A8       >	LDD
0349+  C172 ED A8       >	LDD
0349+  C174 ED A8       >	LDD
0349+  C176 ED A8       >	LDD
0349+  C178 ED A8       >	LDD
0349+  C17A ED A8       >	LDD
0349+  C17C ED A8       >	LDD
0349+  C17E ED A8       >	LDD
0349+  C180 ED A8       >	LDD
0349+  C182 ED A8       >	LDD
0349+  C184 ED A8       >	LDD
0349+  C186 ED A8       >	LDD
0349+  C188 ED A8       >	LDD
0349+  C18A ED A8       >	LDD
0349+  C18C ED A8       >	LDD
0349+  C18E ED A8       >	LDD
0351+  C190 7E          	LD A, (HL)
0352+  C191 12          	LD (DE), A
0353+  C192 EA 0E C1    	JP PE, LOOP1
0354+  C195 C9          	RET
0355+  C196             	
0356+  C196             CL_LINE: 
0357+  C196 21 E0 50    	LD HL, 16384 + 2048 * 2 + 32 * 7 ; Start address of screen bitmap
0358+  C199 54 5D       	LD DE, HL                    ; Address + 1
0359+  C19B 13          	INC DE
0360+  C19C 06 08       	LD B, 8
0361+  C19E C5          CL_LINE_LOOP:  PUSH BC
0362+  C19F 01 1F 00    	LD BC, 31                    ; Length of bitmap memory to clear
0363+  C1A2 36 00       	LD (HL), 0                   ; Set the first byte to 0
0364+  C1A4 ED B0       	LDIR
0365+  C1A6 01 E1 00    	LD BC, 256 + 1 - 32
0366+  C1A9 09          	ADD HL, BC
0367+  C1AA 54 5D       	LD DE, HL                    ; Address + 1
0368+  C1AC 13          	INC DE
0369+  C1AD C1          	POP BC
0370+  C1AE 10 EE       	DJNZ CL_LINE_LOOP
0371+  C1B0 C9          	RET
0372+  C1B1             	
0373+  C1B1             	endmodule
0374+  C1B1             
2919   C1B1                                                         include output.asm
0001+  C1B1             	module OUTPUT
0002+  C1B1             
0003+  C1B1             ;
0004+  C1B1             ; Title:	ZX Spectrum Standard Output Routines
0005+  C1B1             ; Author:	Dean Belfield
0006+  C1B1             ; Created:	29/07/2011
0007+  C1B1             ; Last Updated:	08/02/2020
0008+  C1B1             ;
0009+  C1B1             ; Requires:
0010+  C1B1             ;
0011+  C1B1             ; Modinfo:
0012+  C1B1             ;
0013+  C1B1             ; 02/07/2012:	Added Pixel_Address_Down and Pixel_Address_Up routines
0014+  C1B1             ; 04/07/2012:	Moved Clear_Screen to Screen_Buffer
0015+  C1B1             ; 08/02/2010:	Added Print_BC
0016+  C1B1             ;		Moved Clear_Screen into here (originally in screen_buffer.z80)
0017+  C1B1             ;		All output routines refactored to use HL for screen address
0018+  C1B1             ;		Added Fill_Attr routine
0019+  C1B1             ;
0020+  C1B1             
0021+  C1B1             Set_Border: 
0022+  C1B1 D3 FE            			out (254),a
0023+  C1B3 C9          				ret
0024+  C1B4             
0025+  C1B4             ; Simple clear-screen routine
0026+  C1B4             ; Uses LDIR to block clear memory
0027+  C1B4             ; A:  Colour to clear attribute block of memory with
0028+  C1B4             ;
0029+  C1B4 21 00 40    Clear_Screen: 		LD HL,16384			; Start address of screen bitmap
0030+  C1B7 11 01 40    			LD DE,16385			; Address + 1
0031+  C1BA 01 00 18    			LD BC,6144			; Length of bitmap memory to clear
0032+  C1BD 36 00       			LD (HL),0			; Set the first byte to 0
0033+  C1BF ED B0       			LDIR				; Copy this byte to the second, and so on
0034+  C1C1 01 FF 02    			LD BC,767			; Length of attribute memory, less one to clear
0035+  C1C4 77          			LD (HL),A			; Set the first byte to A
0036+  C1C5 ED B0       			LDIR				; Copy this byte to the second, and so on
0037+  C1C7 C9          			RET
0038+  C1C8             
0039+  C1C8             ; Fill a box of the screen with a solid colour
0040+  C1C8             ;  A: The colour
0041+  C1C8             ; HL: Address in the attribute map
0042+  C1C8             ;  C: Width
0043+  C1C8             ;  B: Height
0044+  C1C8             ;
0045+  C1C8 11 20 00    Fill_Attr: 		LD DE,32
0046+  C1CB E5          1: 			PUSH HL	
0047+  C1CC C5          			PUSH BC
0048+  C1CD 77          2: 			LD (HL), A
0049+  C1CE 2C          			INC L
0050+  C1CF 0D          			DEC C
0051+  C1D0 20 FB       			JR NZ, 2B
0052+  C1D2 C1          			POP BC
0053+  C1D3 E1          			POP HL
0054+  C1D4 19          			ADD HL,DE
0055+  C1D5 10 F4       			DJNZ 1B
0056+  C1D7 C9          			RET
0057+  C1D8             
0058+  C1D8             ; Print String Data
0059+  C1D8             ; First two bytes of string contain X and Y char position, then the string
0060+  C1D8             ; Individual strings are terminated with 0xFE
0061+  C1D8             ; End of data is terminated with 0xFF
0062+  C1D8             ; IX: Address of string
0063+  C1D8             ;
0064+  C1D8 DD 6E 00    Print_String: 		LD L,(IX+0)			; Fetch the X coordinate
0065+  C1DB DD 23       			INC IX				; Increase HL to the next memory location
0066+  C1DD DD 66 00    			LD H,(IX+0)			; Fetch the Y coordinate
0067+  C1E0 DD 23       			INC IX				; Increase HL to the next memory location
0068+  C1E2 CD F6 C1    			CALL Get_Char_Address		; Calculate the screen address (in DE)
0069+  C1E5 DD 7E 00    Print_String_0: 		LD A,(IX)			; Fetch the character to print
0070+  C1E8 DD 23       			INC IX				; Increase HL to the next character
0071+  C1EA FE FE       			CP 0xFE				; Compare with 0xFE
0072+  C1EC 28 EA       			JR Z,Print_String		; If it is equal to 0xFE then loop back to print next string
0073+  C1EE D0          			RET NC				; If it is greater or equal to (carry bit set) then
0074+  C1EF CD 89 C2    			CALL Print_Char			; Print the character
0075+  C1F2 2C          			INC L				; Go to the next screen address
0076+  C1F3 18 F0       			JR Print_String_0		; Loop back to print next character
0077+  C1F5 C9          			RET
0078+  C1F6             
0079+  C1F6             ; Get screen address
0080+  C1F6             ; H = Y character position
0081+  C1F6             ; L = X character position
0082+  C1F6             ; Returns address in HL
0083+  C1F6             ;
0084+  C1F6 7C          Get_Char_Address: 	LD A,H
0085+  C1F7 E6 07       			AND %00000111
0086+  C1F9 1F          			RRA
0087+  C1FA 1F          			RRA
0088+  C1FB 1F          			RRA
0089+  C1FC 1F          			RRA
0090+  C1FD B5          			OR L
0091+  C1FE 6F          			LD L,A
0092+  C1FF 7C          			LD A,H
0093+  C200 E6 18       			AND %00011000
0094+  C202 F6 40       			OR %01000000
0095+  C204 67          			LD H,A
0096+  C205 C9          			RET				; Returns screen address in HL
0097+  C206             
0098+  C206             ; Move HL down one character line
0099+  C206             ;
0100+  C206 7D          Char_Address_Down: 	LD A, L
0101+  C207 C6 20       			ADD A, 32
0102+  C209 6F          			LD L, A
0103+  C20A D0          			RET NC 
0104+  C20B 7C          			LD A, H 
0105+  C20C C6 08       			ADD A, 8 
0106+  C20E 67          			LD H, A
0107+  C20F C9          			RET 
0108+  C210             
0109+  C210             ; Get screen address
0110+  C210             ; B = Y pixel position
0111+  C210             ; C = X pixel position
0112+  C210             ; Returns address in HL and pixel position within character in A
0113+  C210             ;
0114+  C210 78          Get_Pixel_Address: 	LD A,B				; Calculate Y2,Y1,Y0
0115+  C211 E6 07       			AND %00000111			; Mask out unwanted bits
0116+  C213 F6 40       			OR %01000000			; Set base address of screen
0117+  C215 67          			LD H,A				; Store in H
0118+  C216 78          			LD A,B				; Calculate Y7,Y6
0119+  C217 1F          			RRA				; Shift to position
0120+  C218 1F          			RRA
0121+  C219 1F          			RRA
0122+  C21A E6 18       			AND %00011000			; Mask out unwanted bits
0123+  C21C B4          			OR H				; OR with Y2,Y1,Y0
0124+  C21D 67          			LD H,A				; Store in H
0125+  C21E 78          			LD A,B				; Calculate Y5,Y4,Y3
0126+  C21F 17          			RLA				; Shift to position
0127+  C220 17          			RLA
0128+  C221 E6 E0       			AND %11100000			; Mask out unwanted bits
0129+  C223 6F          			LD L,A				; Store in L
0130+  C224 79          			LD A,C				; Calculate X4,X3,X2,X1,X0
0131+  C225 1F          			RRA				; Shift into position
0132+  C226 1F          			RRA
0133+  C227 1F          			RRA
0134+  C228 E6 1F       			AND %00011111			; Mask out unwanted bits
0135+  C22A B5          			OR L				; OR with Y5,Y4,Y3
0136+  C22B 6F          			LD L,A				; Store in L
0137+  C22C 79          			LD A,C
0138+  C22D E6 07       			AND 7
0139+  C22F C9          			RET
0140+  C230             
0141+  C230             ; Move HL down one pixel line
0142+  C230             ;
0143+  C230 24          Pixel_Address_Down: 	INC H				; Go down onto the next pixel line
0144+  C231 7C          			LD A,H				; Check if we have gone onto next character boundary
0145+  C232 E6 07       			AND 7
0146+  C234 C0          			RET NZ				; No, so skip the next bit
0147+  C235 7D          			LD A,L				; Go onto the next character line
0148+  C236 C6 20       			ADD A,32
0149+  C238 6F          			LD L,A
0150+  C239 D8          			RET C				; Check if we have gone onto next third of screen
0151+  C23A 7C          			LD A,H				; Yes, so go onto next third
0152+  C23B D6 08       			SUB 8
0153+  C23D 67          			LD H,A
0154+  C23E C9          			RET
0155+  C23F             
0156+  C23F             ; Move HL up one pixel line
0157+  C23F             ;
0158+  C23F 25          Pixel_Address_Up: 	DEC H				; Go up onto the next pixel line
0159+  C240 7C          			LD A,H				; Check if we have gone onto the next character boundary
0160+  C241 E6 07       			AND 7
0161+  C243 FE 07       			CP 7
0162+  C245 C0          			RET NZ
0163+  C246 7D          			LD A,L
0164+  C247 D6 20       			SUB 32
0165+  C249 6F          			LD L,A
0166+  C24A D8          			RET C
0167+  C24B 7C          			LD A,H
0168+  C24C C6 08       			ADD A,8
0169+  C24E 67          			LD H,A
0170+  C24F C9          			RET
0171+  C250             
0172+  C250             ; Print a single BCD value
0173+  C250             ;  A: Character to print
0174+  C250             ; HL: Screen address to print character at
0175+  C250             ;
0175+  C250 DD 7E 00    Print_BCD_8		LD A, (IX) 
0175+  C253 DD 23         INC IX
0176+  C255 CD 6D C2      CALL Print_BCD
0176+  C258 DD 7E 00    Print_BCD_6		LD A, (IX) 
0176+  C25B DD 23         INC IX
0177+  C25D CD 6D C2      CALL Print_BCD
0177+  C260 DD 7E 00    Print_BCD_4		LD A, (IX) 
0177+  C263 DD 23         INC IX
0178+  C265 CD 6D C2      CALL Print_BCD
0178+  C268 DD 7E 00    Print_BCD_2		LD A, (IX) 
0179+  C26B DD 23         INC IX
0180+  C26D F5          Print_BCD: 		PUSH AF				; Store the value
0181+  C26E E6 F0       			AND 0xF0			; Get the top nibble
0182+  C270 1F          			RRA				; Shift into bottom nibble
0183+  C271 1F          			RRA
0184+  C272 1F          			RRA
0185+  C273 1F          			RRA
0186+  C274 C6 30       			ADD A, '0'			; Add to ASCII '0'
0187+  C276 CD 89 C2    			CALL Print_Char			; Print the character
0188+  C279 2C          			INC L				; Move right one space
0189+  C27A F1          			POP AF
0190+  C27B E6 0F       			AND 0x0F			; Get the bottom nibble
0191+  C27D C6 30       			ADD A, '0'			; Add to ASCII '0'
0192+  C27F CD 89 C2    			CALL Print_Char			; Print
0193+  C282 2C          			INC L				; Move right one space
0194+  C283 C9          			RET
0195+  C284             
0196+  C284             ; Print a single character out to an X/Y position
0197+  C284             ;  A: Character to print
0198+  C284             ;  C: X Coordinate
0199+  C284             ;  B: Y Coordinate
0200+  C284             ; DE: Address of character set
0201+  C284             ;
0202+  C284 F5          Print_Char_At: 		PUSH AF
0203+  C285 CD F6 C1    			CALL Get_Char_Address
0204+  C288 F1          			POP AF				; Fall through to Print_Char
0205+  C289             ;
0206+  C289             ; Print a single character out to a screen address
0207+  C289             ;  A:  Character to print
0208+  C289             ;  HL: Screen address to print character at
0209+  C289             ;  DE: Address of character set (if entering at Print_Char_UDG)
0210+  C289             ; No SM code here - needs to be re-enterent if called on interrupt
0211+  C289             ;
0212+  C289 11 00 3C    Print_Char: 		LD DE, 0x3C00			; Address of character set in ROM
0213+  C28C E5          			PUSH HL
0214+  C28D 06 00       			LD B, 0				; Get index into character set
0215+  C28F 4F          			LD C, A
0216+  C290             			DUP 3
0217+  C290 CB 21       >			SLA C
0218+  C292 CB 10       >			RL B
0217+  C294 CB 21       >			SLA C
0218+  C296 CB 10       >			RL B
0217+  C298 CB 21       >			SLA C
0218+  C29A CB 10       >			RL B
0220+  C29C EB          			EX DE, HL
0221+  C29D 09          			ADD HL, BC 
0222+  C29E EB          			EX DE, HL	
0223+  C29F CD A4 C2    			CALL Print_UDG8
0224+  C2A2 E1          			POP HL
0225+  C2A3 C9          			RET 	
0226+  C2A4             
0227+  C2A4             ; Print a UDG (Single Height)
0228+  C2A4             ; DE - Character data
0229+  C2A4             ; HL - Screen address
0230+  C2A4             ;
0231+  C2A4 06 08       Print_UDG8: 		LD B,8				; Loop counter
0232+  C2A6 1A          2: 			LD A,(DE)			; Get the byte from the ROM into A
0233+  C2A7 77          			LD (HL),A			; Stick A onto the screen
0234+  C2A8 13          			INC DE				; Goto next byte of character
0235+  C2A9 24          			INC H				; Goto next line on screen
0236+  C2AA 10 FA       			DJNZ 2B				; Loop around whilst it is Not Zero (NZ)
0237+  C2AC C9          			RET
0238+  C2AD             
0239+  C2AD             			endmodule
2920   C2AD             
2921   C2AD                                                         SAVESNA "adventurea.sna",BASIC_RUNNER
2922   C2AD                                                         SAVEBIN "adventurea.bin",23500, 9000
